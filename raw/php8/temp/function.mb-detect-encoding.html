<div id="function.mb-detect-encoding" class="refentry"> <div class="refnamediv">  <h1 class="refname">mb_detect_encoding</h1>  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mb_detect_encoding</span> &mdash; <span class="dc-title">检测字符的编码</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.mb-detect-encoding-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>mb_detect_encoding</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$string</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766">null</span></span> <span class="parameter" style="color:#3A95FF">$encodings</span><span class="initializer"> = <strong><span>null</span></strong></span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">bool</span> <span class="parameter" style="color:#3A95FF">$strict</span><span class="initializer"> = <strong><span>false</span></strong></span></span>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   从有序的候选列表中检测 <span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">string</span> 最可能的字符编码。  </p>  <p class="para">   对预期（intended）字符编码的自动检测不可能永远完全可靠；没有额外的信息，就类似于在没有密钥的情况下解码已编码的字符串。最好使用与数据一起存储或传输的字符编码表示，例如“Content-Type” HTTP 头。  </p>  <p class="para">   此函数适用于多字节编码，但并非所有字节顺序都构成有效字符串。如果输入字符串包含这样的顺序，则将会拒绝该编码，并检查下一个编码。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.mb-detect-encoding-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">string</span></dt>     <dd>      <p class="para">       要检测的 <span class="type" style="color:#EAB766">string</span>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">encodings</span></dt>     <dd>      <p class="para">       按顺序尝试的字符编码列表。该列表可以指定为字符串数组，或以逗号分隔的单个字符串。      </p>      <p class="para">       如果省略 <span class="parameter" style="color:#3A95FF">encodings</span> 被或为 <strong><span>null</span></strong>，则将使用当前的 detect_order（使用       <a href="https://www.php.net/manual/zh/mbstring.configuration.php#ini.mbstring.detect-order" class="link">mbstring.detect_order</a> 配置选项或       <span class="function">{@link mb_detect_order()}</span> 函数设置）。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">strict</span></dt>     <dd>      <p class="para">       控制 <span class="parameter" style="color:#3A95FF">string</span> 在列出的所有 <span class="parameter" style="color:#3A95FF">encodings</span> 中无效时的行为。如果       <span class="parameter" style="color:#3A95FF">strict</span> 设置为 <strong><span>false</span></strong>，将返回最接近的匹配编码；如果 <span class="parameter" style="color:#3A95FF">strict</span>       设置为 <strong><span>true</span></strong>，将返回 <strong><span>false</span></strong>。      </p>      <p class="para">       可以使用 <a href="https://www.php.net/manual/zh/mbstring.configuration.php#ini.mbstring.strict-detection" class="link">mbstring.strict_detection</a> 配置选项设置 <span class="parameter" style="color:#3A95FF">strict</span> 的默认值。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.mb-detect-encoding-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   检测到的字符编码，如果字符串在任何列出的编码中均无效，则返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.mb-detect-encoding-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">mb_detect_encoding()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// 使用当前的 detect_order 来检测字符编码<br /></span><span style="color: #007700">echo </span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// "auto" 将根据 mbstring.language 来扩展<br /></span><span style="color: #007700">echo </span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, </span><span style="color: #DD0000">"auto"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 通过以逗号分隔的列表指定“encodings”参数<br /></span><span style="color: #007700">echo </span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, </span><span style="color: #DD0000">"JIS, eucjp-win, sjis-win"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 使用数组指定“encodings”参数<br /></span><span style="color: #9876AA">$encodings </span><span style="color: #007700">= [<br />  </span><span style="color: #DD0000">"ASCII"</span><span style="color: #007700">,<br />  </span><span style="color: #DD0000">"JIS"</span><span style="color: #007700">,<br />  </span><span style="color: #DD0000">"EUC-JP"<br /></span><span style="color: #007700">];<br />echo </span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, </span><span style="color: #9876AA">$encodings</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 <span class="parameter" style="color:#3A95FF">strict</span> 参数的影响</strong></p>    <div class="example-contents">     <div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// 'áéóú' 在 ISO-8859-1 中的编码<br /></span><span style="color: #9876AA">$str </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xE1\xE9\xF3\xFA"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 该字符串不是有效的 ASCII 或 UTF-8，但 UTF-8 被认为是更接近的匹配<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'ASCII'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">], </span><span style="color: #9876AA">false</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'ASCII'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">], </span><span style="color: #9876AA">true</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">// 如果找到有效编码，则严格参数不会更改结果<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'ASCII'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">], </span><span style="color: #9876AA">false</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'ASCII'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">], </span><span style="color: #9876AA">true</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>string(5) &quot;UTF-8&quot;<br>bool(false)<br>string(10) &quot;ISO-8859-1&quot;<br>string(10) &quot;ISO-8859-1&quot;<br></span></div>    </div>   </div>  </p>  <p class="para">   在某些情况下，相同的字节顺序可能会在多种字符编码中形成有效的字符串，并且无法知道其意图是哪种解释。例如，在众多字符编码中，字节序列“\xC4\xA2”可能是：  </p>  <p class="para">   <ul class="simplelist">    <li class="member">     &quot;Ä¢&quot; (U+00C4 LATIN CAPITAL LETTER A WITH DIAERESIS followed by U+00A2 CENT SIGN)     encoded in any of ISO-8859-1, ISO-8859-15, or Windows-1252    </li>    <li class="member">     &quot;ФЂ&quot; (U+0424 CYRILLIC CAPITAL LETTER EF followed by U+0402 CYRILLIC CAPITAL LETTER     DJE) encoded in ISO-8859-5    </li>    <li class="member">     &quot;Ģ&quot; (U+0122 LATIN CAPITAL LETTER G WITH CEDILLA) encoded in UTF-8    </li>   </ul>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #3 匹配多个编码时顺序的影响</strong></p>    <div class="example-contents">     <div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$str </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xC4\xA2"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 该字符串在所有三种编码中均有效，因此将返回列出的第一个<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-5'</span><span style="color: #007700">]));<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-5'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">]));<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">mb_detect_encoding</span><span style="color: #007700">(</span><span style="color: #9876AA">$str</span><span style="color: #007700">, [</span><span style="color: #DD0000">'ISO-8859-5'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">]));<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>string(5) &quot;UTF-8&quot;<br>string(10) &quot;ISO-8859-1&quot;<br>string(10) &quot;ISO-8859-5&quot;<br></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.mb-detect-encoding-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link mb_detect_order()} - 设置/获取 字符编码的检测顺序</span></li>   </ul>  </span> </div></div>
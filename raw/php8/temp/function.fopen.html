<div id="function.fopen" class="refentry"> <div class="refnamediv">  <h1 class="refname">fopen</h1>  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">fopen</span> &mdash; <span class="dc-title">打开文件或者 URL</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.fopen-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>fopen</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$filename</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$mode</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">bool</span> <span class="parameter" style="color:#3A95FF">$use_include_path</span><span class="initializer"> = <strong><span>false</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$context</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">fopen()</strong></span> 将   <span class="parameter" style="color:#3A95FF">filename</span>   指定的名字资源绑定到一个流上。  </p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.fopen-parameters">  <h3 class="title">参数</h3>   <span>    <dl>           <dt><span class="parameter" style="color:#3A95FF">filename</span></dt>      <dd>       <p class="para">        如果        <span class="parameter" style="color:#3A95FF">filename</span>        是 &quot;scheme://...&quot; 的格式，则被当成一个        URL，PHP 将搜索协议处理器（也被称为封装协议）来处理此模式。如果该协议尚未注册封装协议，PHP        将发出一条消息来帮助检查脚本中潜在的问题并将        <span class="parameter" style="color:#3A95FF">filename</span>        当成一个普通的文件名继续执行下去。       </p>       <p class="para">        如果 PHP 认为        <span class="parameter" style="color:#3A95FF">filename</span>        指定的是一个本地文件，将尝试在该文件上打开一个流。该文件必须是        PHP 可以访问的，因此需要确认文件访问权限允许该访问。如果激活了        <a href="https://www.php.net/manual/zh/ini.core.php#ini.open-basedir" class="link">open_basedir</a>        则会应用进一步的限制。       </p>       <p class="para">        如果 PHP 认为        <span class="parameter" style="color:#3A95FF">filename</span>        指定的是一个已注册的协议，而该协议被注册为一个网络        URL，PHP 将检查并确认        <a href="https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen" class="link">allow_url_fopen</a>        已被激活。如果关闭了，PHP 将发出一个警告，而 fopen 的调用则失败。       </p>       <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:         <p class="para">         所支持的协议列表见<a href="https://www.php.net/manual/zh/wrappers.php" class="xref">支持的协议和封装协议</a>。某些协议（也被称为         <span>wrappers</span>）支持         <span>context</span> 和／或 <var class="filename">php.ini</var>         选项。参见相应的页面哪些选项可以被设定（例如 <var class="filename">php.ini</var> 中用于         <span>http</span> wrapper 的 <span>user_agent</span> 值）。        </p>       </p></blockquote>       <p class="para">        On the Windows platform, be careful to escape any backslashes        used in the path to the file, or use forward slashes.        <div class="informalexample">         <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$handle </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"c:\\folder\\resource.txt"</span><span style="color: #007700">, </span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>        </div>       </div>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">mode</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">mode</span>       参数指定了所要求到该流的访问类型。可以是以下：       <table class="doctable table">        <caption><strong>         <span class="function"><strong style="color:#CC7832">fopen()</strong></span> 中 <span class="parameter" style="color:#3A95FF">mode</span> 的可能值列表        </strong></caption>                 <thead>          <tr>           <th><span class="parameter" style="color:#3A95FF">mode</span></th>           <th>说明</th>          </tr>         </thead>         <tbody class="tbody">          <tr>           <td><span>&#039;r&#039;</span></td>           <td>            只读方式打开，将文件指针指向文件头。           </td>          </tr>          <tr>           <td><span>&#039;r+&#039;</span></td>           <td>            读写方式打开，将文件指针指向文件头。           </td>          </tr>          <tr>           <td><span>&#039;w&#039;</span></td>           <td>            写入方式打开，将文件指针指向文件头并将文件大小截为零。如果文件不存在则尝试创建之。           </td>          </tr>          <tr>           <td><span>&#039;w+&#039;</span></td>           <td>            读写方式打开，否则行为同 <span>&#039;w&#039;</span>。           </td>          </tr>          <tr>           <td><span>&#039;a&#039;</span></td>           <td>            写入方式打开，将文件指针指向文件末尾。如果文件不存在则尝试创建之。在这种情况下，<span class="function">{@link fseek()}</span>            没有效果，写入总是追加。           </td>          </tr>          <tr>           <td><span>&#039;a+&#039;</span></td>           <td>            读写方式打开，将文件指针指向文件末尾。如果文件不存在则尝试创建之。在这种情况下，<span class="function">{@link fseek()}</span>            只相应读取位置，写入总是追加。           </td>          </tr>          <tr>           <td><span>&#039;x&#039;</span></td>           <td>            创建并以写入方式打开，将文件指针指向文件头。如果文件已存在，则            <span class="function"><strong style="color:#CC7832">fopen()</strong></span> 调用失败并返回 <strong><span>false</span></strong>，并生成一条            <strong><span>E_WARNING</span></strong> 级别的错误信息。如果文件不存在则尝试创建之。这和给            底层的 <span>open(2)</span> 系统调用指定            <span>O_EXCL|O_CREAT</span> 标记是等价的。           </td>          </tr>          <tr>           <td><span>&#039;x+&#039;</span></td>           <td>            创建并以读写方式打开，其他的行为和 <span>&#039;x&#039;</span> 一样。           </td>          </tr>          <tr>           <td><span>&#039;c&#039;</span></td>           <td>            Open the file for writing only. If the file does not exist, it is            created. If it exists, it is neither truncated (as opposed to            <span>&#039;w&#039;</span>), nor the call to this function fails (as is            the case with <span>&#039;x&#039;</span>). The file pointer is            positioned on the beginning of the file. This may be useful if it&#039;s            desired to get an advisory lock (see <span class="function">{@link flock()}</span>)            before attempting to modify the file, as using            <span>&#039;w&#039;</span> could truncate the file before the lock            was obtained (if truncation is desired,            <span class="function">{@link ftruncate()}</span> can be used after the lock is            requested).           </td>          </tr>          <tr>           <td><span>&#039;c+&#039;</span></td>           <td>            Open the file for reading and writing; otherwise it has the same            behavior as <span>&#039;c&#039;</span>.           </td>          </tr>          <tr>           <td><span>&#039;e&#039;</span></td>           <td>            Set close-on-exec flag on the opened file descriptor. Only            available in PHP compiled on POSIX.1-2008 conform systems.           </td>          </tr>         </tbody>               </table>      </p>      <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:        <p class="para">        不同的操作系统家族具有不同的行结束习惯。当写入一个文本文件并想插入一个新行时，需要使用符合操作系统的行结束符号。基于        Unix 的系统使用 <span>\n</span>        作为行结束字符，基于 Windows 的系统使用 <span>\r\n</span>        作为行结束字符，基于 Macintosh 的系统（传统 Mac OS）使用 <span>\r</span>        作为行结束字符。       </p>       <p class="para">        如果写入文件时使用了错误的行结束符号，则其它应用程序打开这些文件时可能会表现得很怪异。               </p>       <p class="para">        Windows 下提供了一个文本转换标记（<span>&#039;t&#039;</span>）可以透明地将        <span>\n</span> 转换为 <span>\r\n</span>。与此对应还可以使用        <span>&#039;b&#039;</span> 来强制使用二进制模式，这样就不会转换数据。要使用这些标记，要么用        <span>&#039;b&#039;</span> 或者用 <span>&#039;t&#039;</span> 作为        <span class="parameter" style="color:#3A95FF">mode</span> 参数的最后一个字符。       </p>       <p class="para">        默认的转换模式是 <span>&#039;b&#039;</span>。如果是操作纯文本文件并在脚本中使用了        <span>\n</span> 作为行结束符，但还要期望这些文件可以被其它应用程序例如        旧版本的 Notepad 读取，则在 mode 中使用        <span>&#039;t&#039;</span>。在所有其它情况下使用 <span>&#039;b&#039;</span>。       </p>       <p class="para">        在操作二进制文件时如果指定 <span>&#039;t&#039;</span>        标记，可能会碰到一些奇怪的问题，包括坏掉的图片文件以及关于        <span>\r\n</span> 字符的奇怪问题。       </p>      </p></blockquote>      <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:        <p class="para">        为移植性考虑，强烈建议重写那些依赖于        <span>&#039;t&#039;</span> 模式的代码使其使用正确的行结束符并改成        <span>&#039;b&#039;</span> 模式。       </p>      </p></blockquote>      <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:        <span class="simpara">        对于 <var class="filename">php://output</var>、<var class="filename">php://input</var>、<var class="filename">php://stdin</var>、<var class="filename">php://stdout</var>、<var class="filename">php://stderr</var>        和 <var class="filename">php://fd</var> 流封装协议，会忽略 <span class="parameter" style="color:#3A95FF">mode</span>。       </span>      </p></blockquote>     </dd>             <dt><span class="parameter" style="color:#3A95FF">use_include_path</span></dt>     <dd>      <p class="para">       如果也需要在       <a href="https://www.php.net/manual/zh/ini.core.php#ini.include-path" class="link">include_path</a>       中搜寻文件的话，可以将可选的第三个参数       <span class="parameter" style="color:#3A95FF">use_include_path</span>       设为 &#039;1&#039; 或 <strong><span>true</span></strong>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">context</span></dt>     <dd>      <p class="para"><a href="https://www.php.net/manual/zh/stream.contexts.php" class="link">上下文流（context stream）</a><span class="type" style="color:#EAB766">resource</span>。</p>     </dd>       </dl>   </span> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.fopen-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回文件指针资源， 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-function.fopen-errors">  <h3 class="title">错误／异常</h3>  <p class="para">失败时抛出 <strong><span>E_WARNING</span></strong> 警告。</p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.fopen-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>7.0.16, 7.1.2</td>       <td>        新增 <span>&#039;e&#039;</span> 选项。       </td>      </tr>     </tbody>       </table>  </span> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.fopen-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">fopen()</strong></span> 例子</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$handle </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"/home/rasmus/file.txt"</span><span style="color: #007700">, </span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$handle </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"/home/rasmus/file.gif"</span><span style="color: #007700">, </span><span style="color: #DD0000">"wb"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$handle </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">, </span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$handle </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"ftp://user:password@example.com/somefile.txt"</span><span style="color: #007700">, </span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.fopen-notes">  <h3 class="title">注释</h3>  <div class="warning"><strong class="warning">警告</strong><p class="para">使用 SSL 时，Microsoft IIS会违反协议不发送 <span>close_notify</span> 标记就关闭连接。PHP 会在到达数据尾端时报告“SSL: Fatal Protocol Error”。要解决此问题，<a href="https://www.php.net/manual/zh/errorfunc.configuration.php#ini.error-reporting" class="link">error_reporting</a> 应设定为降低级别至不包含警告。PHP4.3.7 及更高版本可以在使用 <span>https://</span> 包装器打开流时检测出有问题的 IIS 服务器软件 并抑制警告。在使用<span class="function">{@link fsockopen()}</span> 创建 <span>ssl://</span> 套接字时，开发者需检测并抑制此警告。</p></div>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    如果在用服务器模块版本的 PHP    时在打开和写入文件上遇到问题，记住要确保所使用的文件和目录是服务器进程所能够访问的。   </p>  </p></blockquote>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    This function may also succeed when <span class="parameter" style="color:#3A95FF">filename</span> is a    directory. If you are unsure whether <span class="parameter" style="color:#3A95FF">filename</span> is a    file or a directory, you may need to use the <span class="function">{@link is_dir()}</span>    function before calling <span class="function"><strong style="color:#CC7832">fopen()</strong></span>.     </p>  </p></blockquote> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.fopen-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><a href="https://www.php.net/manual/zh/wrappers.php" class="xref">支持的协议和封装协议</a></li>    <li class="member"><span class="function">{@link fclose()} - 关闭一个已打开的文件指针</span></li>    <li class="member"><span class="function">{@link fgets()} - 从文件指针中读取一行</span></li>    <li class="member"><span class="function">{@link fread()} - 读取文件（可安全用于二进制文件）</span></li>    <li class="member"><span class="function">{@link fwrite()} - 写入文件（可安全用于二进制文件）</span></li>    <li class="member"><span class="function">{@link fsockopen()} - 打开 Internet 或者 Unix 套接字连接</span></li>    <li class="member"><span class="function">{@link file()} - 把整个文件读入一个数组中</span></li>    <li class="member"><span class="function">{@link file_exists()} - 检查文件或目录是否存在</span></li>    <li class="member"><span class="function">{@link is_readable()} - 判断给定文件名是否可读</span></li>    <li class="member"><span class="function">{@link stream_set_timeout()} - Set timeout period on a stream</span></li>    <li class="member"><span class="function">{@link popen()} - 打开进程文件指针</span></li>    <li class="member"><span class="function">{@link stream_context_create()} - 创建资源流上下文</span></li>    <li class="member"><span class="function">{@link umask()} - 改变当前的 umask</span></li>    <li class="member"><span class="classname"><a href="https://www.php.net/manual/zh/class.splfileobject.php" class="classname">SplFileObject</a></span></li>   </ul>  </span> </div></div>
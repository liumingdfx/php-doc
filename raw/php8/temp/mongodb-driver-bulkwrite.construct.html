<div id="mongodb-driver-bulkwrite.construct" class="refentry"> <div class="refnamediv">  <h1 class="refname">MongoDB\Driver\BulkWrite::__construct</h1>  <p class="verinfo">(mongodb &gt;=1.0.0)</p><p class="refpurpose"><span class="refname">MongoDB\Driver\BulkWrite::__construct</span> &mdash; <span class="dc-title">Create a new BulkWrite</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-mongodb-driver-bulkwrite.construct-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>MongoDB\Driver\BulkWrite::__construct</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$options</span><span class="initializer"> = <strong><span>null</span></strong></span></span>)</div>  <p class="para rdfs-comment">   Constructs a new <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-bulkwrite.php" class="classname">MongoDB\Driver\BulkWrite</a></span>, which is a   mutable object to which one or more write operations may be added. The   write(s) may then be executed with   <span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeBulkWrite()}</span>.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-mongodb-driver-bulkwrite.construct-parameters">  <h3 class="title">参数</h3>  <dl>       <dt><span class="parameter" style="color:#3A95FF">options</span> (<span class="type" style="color:#EAB766">array</span>)</dt>    <dd>     <span>      <table class="doctable table">       <caption><strong>options</strong></caption>               <thead>         <tr>          <th>Option</th>          <th>Type</th>          <th>Description</th>          <th>Default</th>         </tr>        </thead>        <tbody class="tbody">         <tr>          <td>bypassDocumentValidation</td>          <td><span class="type" style="color:#EAB766">bool</span></td>          <td>           <p class="para">            If <strong><span>true</span></strong>, allows insert and update operations to circumvent            document level validation.           </p>           <p class="para">            This option is available in MongoDB 3.2+ and is ignored for older            server versions, which do not support document level validation.           </p>          </td>          <td><strong><span>false</span></strong></td>         </tr>         <tr>          <td>comment</td>          <td><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed" class="type mixed" style="color:#EAB766">mixed</a></span></td>          <td>           <p class="para">            An arbitrary comment to help trace the operation through the            database profiler, currentOp output, and logs.           </p>           <p class="para">            This option is available in MongoDB 4.4+ and will result in an            exception at execution time if specified for an older server            version.           </p>          </td>         </tr>                  <tr>          <td>let</td>          <td><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span></td>          <td>           <p class="para">            Map of parameter names and values. Values must be constant or closed expressions that do not reference document fields. Parameters can then be accessed as variables in an aggregate expression context (e.g. <span>$$var</span>).           </p>           <p class="para">            This option is available in MongoDB 5.0+ and will result in an exception at execution time if specified for an older server version.           </p>          </td>         </tr>         <tr>          <td>ordered</td>          <td><span class="type" style="color:#EAB766">bool</span></td>          <td>           Ordered operations (<strong><span>true</span></strong>) are executed serially on the MongoDB           server, while unordered operations (<strong><span>false</span></strong>) are sent to the server           in an arbitrary order and may be executed in parallel.          </td>          <td><strong><span>true</span></strong></td>         </tr>        </tbody>             </table>     </span>    </dd>     </dl> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-mongodb-driver-bulkwrite.construct-errors">  <h3 class="title">错误／异常</h3>  <ul class="simplelist">   <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-invalidargumentexception.php" class="classname">MongoDB\Driver\Exception\InvalidArgumentException</a></span> on argument parsing errors.</li>  </ul> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-mongodb-driver-bulkwrite.construct-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>PECL mongodb 1.14.0</td>       <td>        Added the <span>&quot;comment&quot;</span> and <span>&quot;let&quot;</span>        options.       </td>      </tr>      <tr>       <td>PECL mongodb 1.1.0</td>       <td>        Added the <span>&quot;bypassDocumentValidation&quot;</span> option.       </td>      </tr>     </tbody>       </table>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-mongodb-driver-bulkwrite.construct-examples">  <h3 class="title">示例</h3>  <div class="example" id="example-3947">   <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">MongoDB\Driver\BulkWrite::__construct()</strong></span> example</strong></p>   <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />$bulk </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\BulkWrite</span><span style="color: #007700">([</span><span style="color: #DD0000">'ordered' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">delete</span><span style="color: #007700">([]);<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">insert</span><span style="color: #007700">([</span><span style="color: #DD0000">'_id' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">insert</span><span style="color: #007700">([</span><span style="color: #DD0000">'_id' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2</span><span style="color: #007700">, </span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">update</span><span style="color: #007700">(<br />    [</span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'$set' </span><span style="color: #007700">=&gt; [</span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">]],<br />    [</span><span style="color: #DD0000">'limit' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'upsert' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">false</span><span style="color: #007700">]<br />);<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">delete</span><span style="color: #007700">([</span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">], [</span><span style="color: #DD0000">'limit' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">update</span><span style="color: #007700">(<br />    [</span><span style="color: #DD0000">'_id' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">3</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'$set' </span><span style="color: #007700">=&gt; [</span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">3</span><span style="color: #007700">]],<br />    [</span><span style="color: #DD0000">'limit' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'upsert' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true</span><span style="color: #007700">]<br />);<br /><br /></span><span style="color: #9876AA">$manager </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Manager</span><span style="color: #007700">(</span><span style="color: #DD0000">'mongodb://localhost:27017'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$writeConcern </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\WriteConcern</span><span style="color: #007700">(</span><span style="color: #9876AA">1</span><span style="color: #007700">);<br /><br />try {<br />    </span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeBulkWrite</span><span style="color: #007700">(</span><span style="color: #DD0000">'db.collection'</span><span style="color: #007700">, </span><span style="color: #9876AA">$bulk</span><span style="color: #007700">, </span><span style="color: #9876AA">$writeConcern</span><span style="color: #007700">);<br />} catch (</span><span style="color: #9876AA">MongoDB\Driver\Exception\BulkWriteException $e</span><span style="color: #007700">) {<br />    </span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$e</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getWriteResult</span><span style="color: #007700">();<br /><br />    </span><span style="color: #FF8000">// Check if the write concern could not be fulfilled<br />    </span><span style="color: #007700">if (</span><span style="color: #9876AA">$writeConcernError </span><span style="color: #007700">= </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getWriteConcernError</span><span style="color: #007700">()) {<br />        </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s (%d): %s\n"</span><span style="color: #007700">,<br />            </span><span style="color: #9876AA">$writeConcernError</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getMessage</span><span style="color: #007700">(),<br />            </span><span style="color: #9876AA">$writeConcernError</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getCode</span><span style="color: #007700">(),<br />            </span><span style="color: #9876AA">var_export</span><span style="color: #007700">(</span><span style="color: #9876AA">$writeConcernError</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getInfo</span><span style="color: #007700">(), </span><span style="color: #9876AA">true</span><span style="color: #007700">)<br />        );<br />    }<br /><br />    </span><span style="color: #FF8000">// Check if any write operations did not complete at all<br />    </span><span style="color: #007700">foreach (</span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getWriteErrors</span><span style="color: #007700">() as </span><span style="color: #9876AA">$writeError</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Operation#%d: %s (%d)\n"</span><span style="color: #007700">,<br />            </span><span style="color: #9876AA">$writeError</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getIndex</span><span style="color: #007700">(),<br />            </span><span style="color: #9876AA">$writeError</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getMessage</span><span style="color: #007700">(),<br />            </span><span style="color: #9876AA">$writeError</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getCode</span><span style="color: #007700">()<br />        );<br />    }<br />} catch (</span><span style="color: #9876AA">MongoDB\Driver\Exception\Exception $e</span><span style="color: #007700">) {<br />    </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Other error: %s\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$e</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getMessage</span><span style="color: #007700">());<br />    exit;<br />}<br /><br /></span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Inserted %d document(s)\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getInsertedCount</span><span style="color: #007700">());<br /></span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Updated  %d document(s)\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getModifiedCount</span><span style="color: #007700">());<br /></span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Upserted %d document(s)\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getUpsertedCount</span><span style="color: #007700">());<br /></span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Deleted  %d document(s)\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getDeletedCount</span><span style="color: #007700">());<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>   </div>   <div class="example-contents"><p>以上示例会输出：</p></div>   <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Inserted 2 document(s)<br>Updated  1 document(s)<br>Upserted 1 document(s)<br>Deleted  1 document(s)<br></span></div>   </div>  </div> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-mongodb-driver-bulkwrite.construct-seealso">  <h3 class="title">参见</h3>  <ul class="simplelist">   <li class="member"><span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeBulkWrite()} - Execute one or more write operations</span></li>   <li class="member"><span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-writeresult.php" class="classname">MongoDB\Driver\WriteResult</a></span></li>  </ul> </div></div>
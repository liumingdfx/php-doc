<div id="mysqli.poll" class="refentry"> <div class="refnamediv">  <h1 class="refname">mysqli::poll</h1>  <h1 class="refname">mysqli_poll</h1>  <p class="verinfo">(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mysqli::poll</span> -- <span class="refname">mysqli_poll</span> &mdash; <span class="dc-title">轮询连接</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-mysqli.poll-description">  <h3 class="title">说明</h3>  <p class="para">面向对象风格</p>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span> <span class="modifier">static</span> <span class="methodname" style="color:#CC7832"><strong>mysqli::poll</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$read</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$error</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">&$reject</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$seconds</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$microseconds</span><span class="initializer"> = 0</span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">int</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">过程化风格</p>  <div class="methodsynopsis dc-description"><span class="methodname" style="color:#CC7832"><strong>mysqli_poll</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$read</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$error</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">&$reject</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$seconds</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$microseconds</span><span class="initializer"> = 0</span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">int</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   轮询连接。此方法是 <a href="https://www.php.net/manual/zh/language.oop5.static.php" class="link">static</a> 的。  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    仅可用于 <a href="https://www.php.net/manual/zh/book.mysqlnd.php" class="link">mysqlnd</a>。   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-mysqli.poll-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">read</span></dt>     <dd>      <p class="para">       要检测是否存在可以读取的结果集的连接的数组。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error</span></dt>     <dd>      <p class="para">       发生错误的，例如：SQL 语句执行失败或者已经断开的       连接的数组。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">reject</span></dt>     <dd>      <p class="para">       没有可以读取的结果集的连接       的数组。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">seconds</span></dt>     <dd>      <p class="para">       秒为单位的最大等待时间，不可以为负数。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">microseconds</span></dt>     <dd>      <p class="para">       微秒为单位的最大等待时间，不可以为负数。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-mysqli.poll-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功执行则返回存在可以读取结果集的连接数量，   否则 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-mysqli.poll-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="example-4433">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">mysqli_poll()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$link1 </span><span style="color: #007700">= </span><span style="color: #9876AA">mysqli_connect</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">$link1</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT 'test'"</span><span style="color: #007700">, </span><span style="color: #9876AA">MYSQLI_ASYNC</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$all_links </span><span style="color: #007700">= array(</span><span style="color: #9876AA">$link1</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$processed </span><span style="color: #007700">= </span><span style="color: #9876AA">0</span><span style="color: #007700">;<br />do {<br />    </span><span style="color: #9876AA">$links </span><span style="color: #007700">= </span><span style="color: #9876AA">$errors </span><span style="color: #007700">= </span><span style="color: #9876AA">$reject </span><span style="color: #007700">= array();<br />    foreach (</span><span style="color: #9876AA">$all_links </span><span style="color: #007700">as </span><span style="color: #9876AA">$link</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$links</span><span style="color: #007700">[] = </span><span style="color: #9876AA">$errors</span><span style="color: #007700">[] = </span><span style="color: #9876AA">$reject</span><span style="color: #007700">[] = </span><span style="color: #9876AA">$link</span><span style="color: #007700">;<br />    }<br />    if (!</span><span style="color: #9876AA">mysqli_poll</span><span style="color: #007700">(</span><span style="color: #9876AA">$links</span><span style="color: #007700">, </span><span style="color: #9876AA">$errors</span><span style="color: #007700">, </span><span style="color: #9876AA">$reject</span><span style="color: #007700">, </span><span style="color: #9876AA">1</span><span style="color: #007700">)) {<br />        continue;<br />    }<br />    foreach (</span><span style="color: #9876AA">$links </span><span style="color: #007700">as </span><span style="color: #9876AA">$link</span><span style="color: #007700">) {<br />        if (</span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$link</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">reap_async_query</span><span style="color: #007700">()) {<br />            </span><span style="color: #9876AA">print_r</span><span style="color: #007700">(</span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">fetch_row</span><span style="color: #007700">());<br />            if (</span><span style="color: #9876AA">is_object</span><span style="color: #007700">(</span><span style="color: #9876AA">$result</span><span style="color: #007700">))<br />                </span><span style="color: #9876AA">mysqli_free_result</span><span style="color: #007700">(</span><span style="color: #9876AA">$result</span><span style="color: #007700">);<br />        } else die(</span><span style="color: #9876AA">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"MySQLi Error: %s"</span><span style="color: #007700">, </span><span style="color: #9876AA">mysqli_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$link</span><span style="color: #007700">)));<br />        </span><span style="color: #9876AA">$processed</span><span style="color: #007700">++;<br />    }<br />} while (</span><span style="color: #9876AA">$processed </span><span style="color: #007700">&lt; </span><span style="color: #9876AA">count</span><span style="color: #007700">(</span><span style="color: #9876AA">$all_links</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Array<br>(<br>    [0] =&gt; test<br>)<br></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-mysqli.poll-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function"><a href="https://www.php.net/manual/zh/mysqli.query.php" class="function" rel="rdfs-seeAlso">mysqli_query()</a> - 对数据库执行查询</span></li>    <li class="member"><span class="function"><a href="https://www.php.net/manual/zh/mysqli.reap-async-query.php" class="function" rel="rdfs-seeAlso">mysqli_reap_async_query()</a> - 获取异步查询的结果</span></li>   </ul>  </span> </div></div>
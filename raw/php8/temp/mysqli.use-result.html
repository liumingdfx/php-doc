<div id="mysqli.use-result" class="refentry"> <div class="refnamediv">  <h1 class="refname">mysqli::use_result</h1>  <h1 class="refname">mysqli_use_result</h1>  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mysqli::use_result</span> -- <span class="refname">mysqli_use_result</span> &mdash; <span class="dc-title">Initiate a result set retrieval</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-mysqli.use-result-description">  <h3 class="title">说明</h3>  <p class="para">面向对象风格</p>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>mysqli::use_result</strong></span>(): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.mysqli-result.php" class="type mysqli_result" style="color:#EAB766">mysqli_result</a></span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">过程化风格</p>  <div class="methodsynopsis dc-description"><span class="methodname" style="color:#CC7832"><strong>mysqli_use_result</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.mysqli.php" class="type mysqli" style="color:#EAB766">mysqli</a></span> <span class="parameter" style="color:#3A95FF">$mysql</span></span>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.mysqli-result.php" class="type mysqli_result" style="color:#EAB766">mysqli_result</a></span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   Used to initiate the retrieval of a result set from the last query   executed using the <span class="function"><a href="https://www.php.net/manual/zh/mysqli.real-query.php" class="function">mysqli_real_query()</a></span> function on the   database connection.  </p>  <p class="para">   Either this or the <span class="function"><a href="https://www.php.net/manual/zh/mysqli.store-result.php" class="function">mysqli_store_result()</a></span> function must   be called before the results of a query can be retrieved, and one or the   other must be called to prevent the next query on that database connection   from failing.  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    The <span class="function"><strong style="color:#CC7832">mysqli_use_result()</strong></span> function does not transfer    the entire result set from the database and hence cannot be used functions    such as <span class="function"><a href="https://www.php.net/manual/zh/mysqli-result.data-seek.php" class="function">mysqli_data_seek()</a></span> to move to a particular    row within the set. To use this functionality, the result set must be    stored using <span class="function"><a href="https://www.php.net/manual/zh/mysqli.store-result.php" class="function">mysqli_store_result()</a></span>. One should not    use <span class="function"><strong style="color:#CC7832">mysqli_use_result()</strong></span> if a lot of processing on    the client side is performed, since this will tie up the server and    prevent other threads from updating any tables from which the data is    being fetched.   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-mysqli.use-result-parameters">  <h3 class="title">参数</h3>  <span>此函数没有参数。</span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-mysqli.use-result-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   Returns an unbuffered result object or <strong><span>false</span></strong> if an error occurred.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-mysqli.use-result-errors">  <h3 class="title">错误／异常</h3>  <p class="para">If mysqli error reporting is enabled (<strong><span>MYSQLI_REPORT_ERROR</span></strong>) and the requested operation fails,a warning is generated. If, in addition, the mode is set to <strong><span>MYSQLI_REPORT_STRICT</span></strong>,a <span class="classname"><a href="https://www.php.net/manual/zh/class.mysqli-sql-exception.php" class="classname">mysqli_sql_exception</a></span> is thrown instead.</p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-mysqli.use-result-examples">  <h3 class="title">示例</h3>  <div class="example" id="example-4463">   <p><strong>示例 #1 <span class="methodname" style="color:#CC7832"><strong>mysqli::use_result()</strong></span> example</strong></p>   <div class="example-contents"><p>面向对象风格</p></div>   <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$mysqli </span><span style="color: #007700">= new </span><span style="color: #9876AA">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">, </span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">, </span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">, </span><span style="color: #DD0000">"world"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// check connection <br /></span><span style="color: #007700">if (</span><span style="color: #9876AA">mysqli_connect_errno</span><span style="color: #007700">()) {<br />    </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect failed: %s\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">mysqli_connect_error</span><span style="color: #007700">());<br />    exit();<br />}<br /><br /></span><span style="color: #9876AA">$query  </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT CURRENT_USER();"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$query </span><span style="color: #007700">.= </span><span style="color: #DD0000">"SELECT Name FROM City ORDER BY ID LIMIT 20, 5"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// execute multi query <br /></span><span style="color: #007700">if (</span><span style="color: #9876AA">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">multi_query</span><span style="color: #007700">(</span><span style="color: #9876AA">$query</span><span style="color: #007700">)) {<br />    do {<br />        </span><span style="color: #FF8000">// store first result set <br />        </span><span style="color: #007700">if (</span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">use_result</span><span style="color: #007700">()) {<br />            while (</span><span style="color: #9876AA">$row </span><span style="color: #007700">= </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">fetch_row</span><span style="color: #007700">()) {<br />                </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$row</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]);<br />            }<br />            </span><span style="color: #9876AA">$result</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">close</span><span style="color: #007700">();<br />        }<br />        </span><span style="color: #FF8000">// print divider <br />        </span><span style="color: #007700">if (</span><span style="color: #9876AA">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">more_results</span><span style="color: #007700">()) {<br />            </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"-----------------\n"</span><span style="color: #007700">);<br />        }<br />    } while (</span><span style="color: #9876AA">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">next_result</span><span style="color: #007700">());<br />}<br /><br /></span><span style="color: #FF8000">// close connection <br /></span><span style="color: #9876AA">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">close</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>   </div>   <div class="example-contents"><p>过程化风格</p></div>   <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$link </span><span style="color: #007700">= </span><span style="color: #9876AA">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">, </span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">, </span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">, </span><span style="color: #DD0000">"world"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// check connection <br /></span><span style="color: #007700">if (</span><span style="color: #9876AA">mysqli_connect_errno</span><span style="color: #007700">()) {<br />    </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect failed: %s\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">mysqli_connect_error</span><span style="color: #007700">());<br />    exit();<br />}<br /><br /></span><span style="color: #9876AA">$query  </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT CURRENT_USER();"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$query </span><span style="color: #007700">.= </span><span style="color: #DD0000">"SELECT Name FROM City ORDER BY ID LIMIT 20, 5"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// execute multi query <br /></span><span style="color: #007700">if (</span><span style="color: #9876AA">mysqli_multi_query</span><span style="color: #007700">(</span><span style="color: #9876AA">$link</span><span style="color: #007700">, </span><span style="color: #9876AA">$query</span><span style="color: #007700">)) {<br />    do {<br />        </span><span style="color: #FF8000">// store first result set <br />        </span><span style="color: #007700">if (</span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">mysqli_use_result</span><span style="color: #007700">(</span><span style="color: #9876AA">$link</span><span style="color: #007700">)) {<br />            while (</span><span style="color: #9876AA">$row </span><span style="color: #007700">= </span><span style="color: #9876AA">mysqli_fetch_row</span><span style="color: #007700">(</span><span style="color: #9876AA">$result</span><span style="color: #007700">)) {<br />                </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$row</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]);<br />            }<br />            </span><span style="color: #9876AA">mysqli_free_result</span><span style="color: #007700">(</span><span style="color: #9876AA">$result</span><span style="color: #007700">);<br />        }<br />        </span><span style="color: #FF8000">// print divider <br />        </span><span style="color: #007700">if (</span><span style="color: #9876AA">mysqli_more_results</span><span style="color: #007700">(</span><span style="color: #9876AA">$link</span><span style="color: #007700">)) {<br />            </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"-----------------\n"</span><span style="color: #007700">);<br />        }<br />    } while (</span><span style="color: #9876AA">mysqli_next_result</span><span style="color: #007700">(</span><span style="color: #9876AA">$link</span><span style="color: #007700">));<br />}<br /><br /></span><span style="color: #FF8000">// close connection <br /></span><span style="color: #9876AA">mysqli_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$link</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>  </div>  <div class="example-contents"><p>以上示例会输出：</p></div>  <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>my_user@localhost<br>-----------------<br>Amersfoort<br>Maastricht<br>Dordrecht<br>Leiden<br>Haarlemmermeer<br></span></div>   </div>  </div> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-mysqli.use-result-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function"><a href="https://www.php.net/manual/zh/mysqli.real-query.php" class="function" rel="rdfs-seeAlso">mysqli_real_query()</a> - 执行一个mysql查询</span></li>    <li class="member"><span class="function"><a href="https://www.php.net/manual/zh/mysqli.store-result.php" class="function" rel="rdfs-seeAlso">mysqli_store_result()</a> - 传输上次查询的结果集</span></li>   </ul>  </span> </div></div>
<div id="function.stream-notification-callback" class="refentry"> <div class="refnamediv">  <h1 class="refname">stream_notification_callback</h1>  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">stream_notification_callback</span> &mdash; <span class="dc-title">A callback function for the <span>notification</span> context parameter</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.stream-notification-callback-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><span class="replaceable">stream_notification_callback</span></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$notification_code</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$severity</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$message</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$message_code</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$bytes_transferred</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$bytes_max</span></span><br>): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div>  <p class="para rdfs-comment">   A <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.callable.php" class="type callable" style="color:#EAB766">callable</a></span> function, used by the   <a href="https://www.php.net/manual/zh/context.params.php#context.params.notification" class="link">notification context parameter</a>,   called during an event.  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    This is <em>not</em> a real function, only a prototype of how the function should    be.   </p>  </p></blockquote> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.stream-notification-callback-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">notification_code</span></dt>     <dd>      <p class="para">       One of the <strong><span>STREAM_NOTIFY_*</span></strong> notification constants.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">severity</span></dt>     <dd>      <p class="para">       One of the <strong><span>STREAM_NOTIFY_SEVERITY_*</span></strong> notification constants.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">message</span></dt>     <dd>      <p class="para">       Passed if a descriptive message is available for the event.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">message_code</span></dt>     <dd>      <p class="para">       Passed if a descriptive message code is available for the event.      </p>      <p class="para">       The meaning of this value is dependent on the specific wrapper in use.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">bytes_transferred</span></dt>     <dd>      <p class="para">       If applicable, the <span class="parameter" style="color:#3A95FF">bytes_transferred</span> will be       populated.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">bytes_max</span></dt>     <dd>      <p class="para">       If applicable, the <span class="parameter" style="color:#3A95FF">bytes_max</span> will be       populated.      </p>     </dd>       </dl>  </span> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.stream-notification-callback-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   没有返回值。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.stream-notification-callback-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">stream_notification_callback()</strong></span> example</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #9876AA">stream_notification_callback</span><span style="color: #007700">(</span><span style="color: #9876AA">$notification_code</span><span style="color: #007700">, </span><span style="color: #9876AA">$severity</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">, </span><span style="color: #9876AA">$message_code</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_max</span><span style="color: #007700">) {<br /><br />    switch(</span><span style="color: #9876AA">$notification_code</span><span style="color: #007700">) {<br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_RESOLVE</span><span style="color: #007700">:<br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_AUTH_REQUIRED</span><span style="color: #007700">:<br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_COMPLETED</span><span style="color: #007700">:<br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_FAILURE</span><span style="color: #007700">:<br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_AUTH_RESULT</span><span style="color: #007700">:<br />            </span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$notification_code</span><span style="color: #007700">, </span><span style="color: #9876AA">$severity</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">, </span><span style="color: #9876AA">$message_code</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_max</span><span style="color: #007700">);<br />            </span><span style="color: #FF8000">// Ignore <br />            </span><span style="color: #007700">break;<br /><br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_REDIRECTED</span><span style="color: #007700">:<br />            echo </span><span style="color: #DD0000">"Being redirected to: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">;<br />            break;<br /><br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_CONNECT</span><span style="color: #007700">:<br />            echo </span><span style="color: #DD0000">"Connected..."</span><span style="color: #007700">;<br />            break;<br /><br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_FILE_SIZE_IS</span><span style="color: #007700">:<br />            echo </span><span style="color: #DD0000">"Got the filesize: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_max</span><span style="color: #007700">;<br />            break;<br /><br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_MIME_TYPE_IS</span><span style="color: #007700">:<br />            echo </span><span style="color: #DD0000">"Found the mime-type: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">;<br />            break;<br /><br />        case </span><span style="color: #9876AA">STREAM_NOTIFY_PROGRESS</span><span style="color: #007700">:<br />            echo </span><span style="color: #DD0000">"Made some progress, downloaded "</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">, </span><span style="color: #DD0000">" so far"</span><span style="color: #007700">;<br />            break;<br />    }<br />    echo </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #9876AA">$ctx </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_context_create</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">stream_context_set_params</span><span style="color: #007700">(</span><span style="color: #9876AA">$ctx</span><span style="color: #007700">, array(</span><span style="color: #DD0000">"notification" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"stream_notification_callback"</span><span style="color: #007700">));<br /><br /></span><span style="color: #9876AA">file_get_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://php.net/contact"</span><span style="color: #007700">, </span><span style="color: #9876AA">false</span><span style="color: #007700">, </span><span style="color: #9876AA">$ctx</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例的输出类似于：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Connected...<br>Found the mime-type: text/html; charset=utf-8<br>Being redirected to: http://no.php.net/contact<br>Connected...<br>Got the filesize: 0<br>Found the mime-type: text/html; charset=utf-8<br>Being redirected to: http://no.php.net/contact.php<br>Connected...<br>Got the filesize: 4589<br>Found the mime-type: text/html;charset=utf-8<br>Made some progress, downloaded 0 so far<br>Made some progress, downloaded 0 so far<br>Made some progress, downloaded 0 so far<br>Made some progress, downloaded 1440 so far<br>Made some progress, downloaded 2880 so far<br>Made some progress, downloaded 4320 so far<br>Made some progress, downloaded 5760 so far<br>Made some progress, downloaded 6381 so far<br>Made some progress, downloaded 7002 so far<br></span></div>    </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 Simple progressbar for commandline download client</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #9876AA">usage</span><span style="color: #007700">(</span><span style="color: #9876AA">$argv</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Usage:\n"</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\tphp %s &lt;http://example.com/file&gt; &lt;localfile&gt;\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]);<br />    exit(</span><span style="color: #9876AA">1</span><span style="color: #007700">);<br />}<br /><br />function </span><span style="color: #9876AA">stream_notification_callback</span><span style="color: #007700">(</span><span style="color: #9876AA">$notification_code</span><span style="color: #007700">, </span><span style="color: #9876AA">$severity</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">, </span><span style="color: #9876AA">$message_code</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_max</span><span style="color: #007700">) {<br />    static </span><span style="color: #9876AA">$filesize </span><span style="color: #007700">= </span><span style="color: #9876AA">null</span><span style="color: #007700">;<br /><br />    switch(</span><span style="color: #9876AA">$notification_code</span><span style="color: #007700">) {<br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_RESOLVE</span><span style="color: #007700">:<br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_AUTH_REQUIRED</span><span style="color: #007700">:<br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_COMPLETED</span><span style="color: #007700">:<br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_FAILURE</span><span style="color: #007700">:<br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_AUTH_RESULT</span><span style="color: #007700">:<br />        </span><span style="color: #FF8000">// Ignore <br />        </span><span style="color: #007700">break;<br /><br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_REDIRECTED</span><span style="color: #007700">:<br />        echo </span><span style="color: #DD0000">"Being redirected to: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />        break;<br /><br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_CONNECT</span><span style="color: #007700">:<br />        echo </span><span style="color: #DD0000">"Connected...\n"</span><span style="color: #007700">;<br />        break;<br /><br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_FILE_SIZE_IS</span><span style="color: #007700">:<br />        </span><span style="color: #9876AA">$filesize </span><span style="color: #007700">= </span><span style="color: #9876AA">$bytes_max</span><span style="color: #007700">;<br />        echo </span><span style="color: #DD0000">"Filesize: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$filesize</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />        break;<br /><br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_MIME_TYPE_IS</span><span style="color: #007700">:<br />        echo </span><span style="color: #DD0000">"Mime-type: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$message</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />        break;<br /><br />    case </span><span style="color: #9876AA">STREAM_NOTIFY_PROGRESS</span><span style="color: #007700">:<br />        if (</span><span style="color: #9876AA">$bytes_transferred </span><span style="color: #007700">&gt; </span><span style="color: #9876AA">0</span><span style="color: #007700">) {<br />            if (!isset(</span><span style="color: #9876AA">$filesize</span><span style="color: #007700">)) {<br />                </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\rUnknown filesize.. %2d kb done.."</span><span style="color: #007700">, </span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">/</span><span style="color: #9876AA">1024</span><span style="color: #007700">);<br />            } else {<br />                </span><span style="color: #9876AA">$length </span><span style="color: #007700">= (int)((</span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">/</span><span style="color: #9876AA">$filesize</span><span style="color: #007700">)*</span><span style="color: #9876AA">100</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\r[%-100s] %d%% (%2d/%2d kb)"</span><span style="color: #007700">, </span><span style="color: #9876AA">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">"="</span><span style="color: #007700">, </span><span style="color: #9876AA">$length</span><span style="color: #007700">). </span><span style="color: #DD0000">"&gt;"</span><span style="color: #007700">, </span><span style="color: #9876AA">$length</span><span style="color: #007700">, (</span><span style="color: #9876AA">$bytes_transferred</span><span style="color: #007700">/</span><span style="color: #9876AA">1024</span><span style="color: #007700">), </span><span style="color: #9876AA">$filesize</span><span style="color: #007700">/</span><span style="color: #9876AA">1024</span><span style="color: #007700">);<br />            }<br />        }<br />        break;<br />    }<br />}<br /><br />isset(</span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">], </span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">2</span><span style="color: #007700">]) or </span><span style="color: #9876AA">usage</span><span style="color: #007700">(</span><span style="color: #9876AA">$argv</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$ctx </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_context_create</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">stream_context_set_params</span><span style="color: #007700">(</span><span style="color: #9876AA">$ctx</span><span style="color: #007700">, array(</span><span style="color: #DD0000">"notification" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"stream_notification_callback"</span><span style="color: #007700">));<br /><br /></span><span style="color: #9876AA">$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">], </span><span style="color: #DD0000">"r"</span><span style="color: #007700">, </span><span style="color: #9876AA">false</span><span style="color: #007700">, </span><span style="color: #9876AA">$ctx</span><span style="color: #007700">);<br />if (</span><span style="color: #9876AA">is_resource</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">) &amp;&amp; </span><span style="color: #9876AA">file_put_contents</span><span style="color: #007700">(</span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">2</span><span style="color: #007700">], </span><span style="color: #9876AA">$fp</span><span style="color: #007700">)) {<br />    echo </span><span style="color: #DD0000">"\nDone!\n"</span><span style="color: #007700">;<br />    exit(</span><span style="color: #9876AA">0</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #9876AA">$err </span><span style="color: #007700">= </span><span style="color: #9876AA">error_get_last</span><span style="color: #007700">();<br />echo </span><span style="color: #DD0000">"\nErrrrrorr..\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$err</span><span style="color: #007700">[</span><span style="color: #DD0000">"message"</span><span style="color: #007700">], </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />exit(</span><span style="color: #9876AA">1</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>     Executing the example above with:     <span>php -n fetch.php     http://no2.php.net/get/php-5-LATEST.tar.bz2/from/this/mirror     php-latest.tar.bz2</span> will output something similar too:    </p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Connected...<br>Mime-type: text/html; charset=utf-8<br>Being redirected to: http://no2.php.net/distributions/php-5.2.5.tar.bz2<br>Connected...<br>Filesize: 7773024<br>Mime-type: application/octet-stream<br>[========================================&gt;                                                           ] 40% (3076/7590 kb)<br></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.stream-notification-callback-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><a href="https://www.php.net/manual/zh/context.params.php" class="xref">Context 参数</a></li>   </ul>  </span> </div></div>
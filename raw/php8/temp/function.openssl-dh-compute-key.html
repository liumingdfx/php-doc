<div id="function.openssl-dh-compute-key" class="refentry"> <div class="refnamediv">  <h1 class="refname">openssl_dh_compute_key</h1>  <p class="verinfo">(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">openssl_dh_compute_key</span> &mdash; <span class="dc-title">计算远程 DH 公钥和本地 DH 密钥的共享密钥</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.openssl-dh-compute-key-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>openssl_dh_compute_key</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$public_key</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.opensslasymmetrickey.php" class="type OpenSSLAsymmetricKey" style="color:#EAB766">OpenSSLAsymmetricKey</a></span> <span class="parameter" style="color:#3A95FF">$private_key</span></span>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">openssl_dh_compute_key()</strong></span> 返回的共享密钥通常用作与远端秘密通信的加密密钥。这称为 Diffie-Hellman 密钥交换。  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <span class="simpara">    ECDH 仅从 PHP 8.1.0 <em>和</em> OpenSSL 3.0.0 开始受支持。   </span>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.openssl-dh-compute-key-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">public_key</span></dt>     <dd>      <p class="para">       远端的 DH 公钥。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">private_key</span></dt>     <dd>      <p class="para">       本地 DH 私钥，对应于要与远端共享的公钥。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.openssl-dh-compute-key-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回共享密钥， 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.openssl-dh-compute-key-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>      <td>8.0.0</td>      <td>       <span class="parameter" style="color:#3A95FF">private_key</span> 现在接受 <span class="classname"><a href="https://www.php.net/manual/zh/class.opensslasymmetrickey.php" class="classname">OpenSSLAsymmetricKey</a></span>；之前接受类型       <span>OpenSSL key</span> 的 <a href="https://www.php.net/manual/zh/language.types.resource.php" class="link">resource</a>。      </td>     </tr>    </tbody>     </table> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.openssl-dh-compute-key-examples">  <h3 class="title">示例</h3>  <span>      <div class="example" id="example-2804">    <p><strong>示例 #1 计算共享秘密</strong></p>    <div class="example-contents"><p>首先在本地生成公私 DH 密钥对，让远端也这样做。需要使用 <span>openssl</span> 命令行实用程序。</p></div>    <div class="example-contents"><div class="shellcode"><span># generate private/public key keypair<br>openssl dhparam -out dhparam.pem 2048<br>openssl genpkey -paramfile dhparam.pem -out privatekey.pem<br><br># extract public key only<br>openssl pkey -in privatekey.pem -pubout -out publickey.pem</span></div>    </div>    <div class="example-contents"><p>    接下来，将公钥发送给远端。使用 <span>openssl pkey</span> 命令查看从远端发送的公钥。</p></div>    <div class="example-contents"><div class="shellcode"><span>openssl pkey -pubin -in remotepublickey.pem -text -noout</span></div>    </div>    <div class="example-contents"><p>以上示例的输出类似于：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>PKCS#3 DH Public-Key: (2048 bit)<br>    public-key:<br>        67:e5:e5:fa:e0:7b:0f:96:2c:dc:96:44:5f:50:02:<br>        9e:8d:c2:6c:04:68:b0:d1:1d:75:66:fc:63:f5:e3:<br>        42:30:b8:96:c1:45:cc:08:60:b4:21:3b:dd:ee:66:<br>        88:db:77:d9:1e:11:89:d4:5c:f2:7a:f2:f1:fe:1c:<br>        77:9d:6f:13:b8:b2:56:00:ef:cb:3b:60:79:74:02:<br>        98:f5:f9:8e:3e:b5:62:08:de:ca:8c:c3:40:4a:80:<br>        79:d5:43:06:17:a8:19:56:af:cc:95:5e:e2:32:2d:<br>        d2:14:7b:76:5a:9a:f1:3c:76:76:35:cc:7b:c1:a5:<br>        f4:39:e5:b6:ca:71:3f:7c:3f:97:e5:ab:86:c1:cd:<br>        0e:e6:ee:04:c9:e6:2d:80:7e:59:c0:49:eb:b6:64:<br>        4f:a8:f9:bb:a3:87:b3:3d:76:01:9e:2b:16:94:a4:<br>        37:30:fb:35:e2:63:be:23:90:b9:ef:3f:46:46:04:<br>        94:8f:60:79:7a:51:55:d6:1a:1d:f5:d9:7f:4a:3e:<br>        aa:ac:b0:d0:82:cc:c2:e0:94:e0:54:c1:17:83:0b:<br>        74:08:4d:5a:79:ae:ff:7f:1c:04:ab:23:39:4a:ae:<br>        87:83:55:43:ab:7a:7c:04:9d:20:80:bb:af:5f:16:<br>        a3:e3:20:b9:21:47:8c:f8:7f:a8:60:80:9e:61:77:<br>        36<br> [...abbreviated...]<br></span></div>    </div>    <div class="example-contents"><p>使用此公钥作为 <span class="function"><strong style="color:#CC7832">openssl_dh_compute_key()</strong></span> 的参数以计算共享密钥。</p></div>     <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$remote_public_key </span><span style="color: #007700">= </span><span style="color: #DD0000">'67e5e5fae07b0f962cdc96445f50029e8dc26c0468b0d11d7566fc63f5e34230b896c145cc0860b4213bddee6688db77d91e1189d45cf27af2f1fe1c779d6f13b8b25600efcb3b6079740298f5f98e3eb56208deca8cc3404a8079d5430617a81956afcc955ee2322dd2147b765a9af13c767635cc7bc1a5f439e5b6ca713f7c3f97e5ab86c1cd0ee6ee04c9e62d807e59c049ebb6644fa8f9bba387b33d76019e2b1694a43730fb35e263be2390b9ef3f464604948f60797a5155d61a1df5d97f4a3eaaacb0d082ccc2e094e054c117830b74084d5a79aeff7f1c04ab23394aae87835543ab7a7c049d2080bbaf5f16a3e320b921478cf87fa860809e617736'</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">$local_priv_key </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_pkey_get_private</span><span style="color: #007700">(</span><span style="color: #DD0000">'file://privatekey.pem'</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$shared_secret </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_dh_compute_key</span><span style="color: #007700">(</span><span style="color: #9876AA">hex2bin</span><span style="color: #007700">(</span><span style="color: #9876AA">$remote_public_key</span><span style="color: #007700">), </span><span style="color: #9876AA">$local_priv_key</span><span style="color: #007700">);<br />echo </span><span style="color: #9876AA">bin2hex</span><span style="color: #007700">(</span><span style="color: #9876AA">$shared_secret</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>     </div>   </div>  </span>  <p class="para">   <div class="example" id="example-2807">    <p><strong>示例 #2 在 php 中生成 DH 公/私钥对</strong></p>    <div class="example-contents"><p>首先，生成 DH 质数</p></div>    <div class="example-contents"><div class="shellcode"><span>openssl dhparam -out dhparam.pem 2048<br>openssl dh -in dhparam.pem -noout  -text</span></div>    </div>    <div class="example-contents"><p>以上示例的输出类似于：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>    PKCS#3 DH Parameters: (2048 bit)<br>        prime:<br>            00:a3:25:1e:73:3f:44:b9:2b:ee:f4:9d:9f:37:6a:<br>            4b:fd:1d:bd:f4:af:da:c8:10:77:59:41:c6:5f:73:<br>            d2:88:29:39:cd:1c:5f:c3:9f:0f:22:d2:9c:20:c1:<br>            e4:c0:18:03:b8:b6:d8:da:ad:3b:39:a6:da:8e:fe:<br>            12:30:e9:03:5d:22:ba:ef:18:d2:7b:69:f9:5b:cb:<br>            78:c6:0c:8c:6b:f2:49:92:c2:49:e0:45:77:72:b3:<br>            55:36:30:f2:40:17:89:18:50:03:fa:2d:54:7a:7f:<br>            34:4c:73:32:b6:88:14:51:14:be:80:57:95:e6:a3:<br>            f6:51:ff:17:47:4f:15:d6:0e:6c:47:53:72:2c:2a:<br>            4c:21:cb:7d:f3:49:97:c9:47:5e:40:33:7b:99:52:<br>            7e:7a:f3:52:27:80:de:1b:26:6b:40:bb:14:11:0b:<br>            fb:e6:d8:2f:cf:a0:06:2f:96:b9:1c:0b:b4:cb:d3:<br>            a6:62:9c:48:67:f6:81:f2:c6:ff:45:03:0a:9d:67:<br>            9d:ce:27:d9:6b:48:5d:ca:fb:c2:5d:84:9b:8b:cb:<br>            40:c7:a4:0c:8a:6e:f4:ab:ba:b6:10:c3:b8:25:4d:<br>            cf:60:96:f4:db:e8:00:1c:58:47:7a:fb:51:86:d1:<br>            22:d7:4e:94:31:7a:d5:da:3d:53:de:da:bb:64:8d:<br>            62:6b<br>        generator: 2 (0x2)<br></span></div>    </div>    <div class="example-contents"><p>质数和生成器值作为 p 和 g 传递给 <span class="function">{@link openssl_pkey_new()}</span></p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$configargs </span><span style="color: #007700">= array();<br /></span><span style="color: #9876AA">$configargs</span><span style="color: #007700">[</span><span style="color: #DD0000">'p'</span><span style="color: #007700">] = </span><span style="color: #9876AA">hex2bin</span><span style="color: #007700">(</span><span style="color: #DD0000">'00a3251e733f44b92beef49d9f376a4bfd1dbdf4afdac810775941c65f73d2882939cd1c5fc39f0f22d29c20c1e4c01803b8b6d8daad3b39a6da8efe1230e9035d22baef18d27b69f95bcb78c60c8c6bf24992c249e0457772b3553630f2401789185003fa2d547a7f344c7332b688145114be805795e6a3f651ff17474f15d60e6c4753722c2a4c21cb7df34997c9475e40337b99527e7af3522780de1b266b40bb14110bfbe6d82fcfa0062f96b91c0bb4cbd3a6629c4867f681f2c6ff45030a9d679dce27d96b485dcafbc25d849b8bcb40c7a40c8a6ef4abbab610c3b8254dcf6096f4dbe8001c58477afb5186d122d74e94317ad5da3d53dedabb648d626b'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$configargs</span><span style="color: #007700">[</span><span style="color: #DD0000">'g'</span><span style="color: #007700">] = </span><span style="color: #9876AA">hex2bin</span><span style="color: #007700">(</span><span style="color: #DD0000">'02'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$private_key </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_pkey_new</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'dh' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">$configargs</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">openssl_pkey_export_to_file</span><span style="color: #007700">(</span><span style="color: #9876AA">$private_key</span><span style="color: #007700">,</span><span style="color: #DD0000">'privatekey.pem'</span><span style="color: #007700">,</span><span style="color: #9876AA">$passphrase</span><span style="color: #007700">=</span><span style="color: #DD0000">'y0urp@s5phr@se'</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$details </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_pkey_get_details</span><span style="color: #007700">(</span><span style="color: #9876AA">$private_key</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$local_pub_key </span><span style="color: #007700">= </span><span style="color: #9876AA">$details</span><span style="color: #007700">[</span><span style="color: #DD0000">'dh'</span><span style="color: #007700">][</span><span style="color: #DD0000">'pub_key'</span><span style="color: #007700">];<br />echo </span><span style="color: #9876AA">bin2hex</span><span style="color: #007700">(</span><span style="color: #9876AA">$local_pub_key</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;</span><span style="color: #FF8000">//you can send your public key to the remote party<br /><br /></span><span style="color: #9876AA">$details </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_pkey_get_details</span><span style="color: #007700">(</span><span style="color: #9876AA">openssl_pkey_get_public</span><span style="color: #007700">(</span><span style="color: #DD0000">"file://remotepublickey.pem"</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">$remote_public_key </span><span style="color: #007700">= </span><span style="color: #9876AA">$details</span><span style="color: #007700">[</span><span style="color: #DD0000">'dh'</span><span style="color: #007700">][</span><span style="color: #DD0000">'pub_key'</span><span style="color: #007700">];<br /></span><span style="color: #9876AA">$shared_secret </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_dh_compute_key</span><span style="color: #007700">(</span><span style="color: #9876AA">$remote_public_key</span><span style="color: #007700">, </span><span style="color: #9876AA">$private_key</span><span style="color: #007700">);<br />echo </span><span style="color: #9876AA">bin2hex</span><span style="color: #007700">(</span><span style="color: #9876AA">$shared_secret</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.openssl-dh-compute-key-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link openssl_pkey_new()} - 生成一个新的私钥</span></li>    <li class="member"><span class="function">{@link openssl_pkey_get_details()} - 返回包含密钥详情的数组</span></li>    <li class="member"><span class="function">{@link openssl_pkey_get_private()} - 获取私钥</span></li>    <li class="member"><span class="function">{@link openssl_pkey_get_public()} - 从证书中解析公钥，以供使用</span></li>   </ul>  </span> </div> </div>
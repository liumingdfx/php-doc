<div id="function.stream-filter-register" class="refentry"> <div class="refnamediv">  <h1 class="refname">stream_filter_register</h1>  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">stream_filter_register</span> &mdash; <span class="dc-title">Register a user defined stream filter</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.stream-filter-register-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>stream_filter_register</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$filter_name</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$class</span></span>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">stream_filter_register()</strong></span> allows you to implement   your own filter on any registered stream used with all the other   filesystem functions (such as <span class="function">{@link fopen()}</span>,   <span class="function">{@link fread()}</span> etc.).  </p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.stream-filter-register-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">filter_name</span></dt>     <dd>      <p class="para">       The filter name to be registered.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">class</span></dt>     <dd>      <p class="para">       To implement a filter, you need to define a class as an extension of       <span class="classname"><a href="https://www.php.net/manual/zh/class.php-user-filter.php" class="classname">php_user_filter</a></span> with a number of member       functions. When performing read/write operations on the stream       to which your filter is attached, PHP will pass the data through your       filter (and any other filters attached to that stream) so that the       data may be modified as desired. You must implement the methods       exactly as described in <span class="classname"><a href="https://www.php.net/manual/zh/class.php-user-filter.php" class="classname">php_user_filter</a></span> - doing       otherwise will lead to undefined behaviour.      </p>     </dd>       </dl>  </span> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.stream-filter-register-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回 <strong><span>true</span></strong>， 或者在失败时返回 <strong><span>false</span></strong>。  </p>  <p class="para">   <span class="function"><strong style="color:#CC7832">stream_filter_register()</strong></span> will return <strong><span>false</span></strong> if the   <span class="parameter" style="color:#3A95FF">filter_name</span> is already defined.  </p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.stream-filter-register-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 Filter for capitalizing characters on <var class="filename">foo-bar.txt</var> stream</strong></p>    <div class="example-contents"><p>     The example below implements a filter named <span>strtoupper</span>     on the <var class="filename">foo-bar.txt</var> stream which will capitalize     all letter characters written to/read from that stream.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #FF8000">// Define our filter class <br /></span><span style="color: #007700">class </span><span style="color: #9876AA">strtoupper_filter </span><span style="color: #007700">extends </span><span style="color: #9876AA">php_user_filter </span><span style="color: #007700">{<br />  function </span><span style="color: #9876AA">filter</span><span style="color: #007700">(</span><span style="color: #9876AA">$in</span><span style="color: #007700">, </span><span style="color: #9876AA">$out</span><span style="color: #007700">, &amp;</span><span style="color: #9876AA">$consumed</span><span style="color: #007700">, </span><span style="color: #9876AA">$closing</span><span style="color: #007700">)<br />  {<br />    while (</span><span style="color: #9876AA">$bucket </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_bucket_make_writeable</span><span style="color: #007700">(</span><span style="color: #9876AA">$in</span><span style="color: #007700">)) {<br />      </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">data </span><span style="color: #007700">= </span><span style="color: #9876AA">strtoupper</span><span style="color: #007700">(</span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">data</span><span style="color: #007700">);<br />      </span><span style="color: #9876AA">$consumed </span><span style="color: #007700">+= </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">datalen</span><span style="color: #007700">;<br />      </span><span style="color: #9876AA">stream_bucket_append</span><span style="color: #007700">(</span><span style="color: #9876AA">$out</span><span style="color: #007700">, </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">);<br />    }<br />    return </span><span style="color: #9876AA">PSFS_PASS_ON</span><span style="color: #007700">;<br />  }<br />}<br /><br /></span><span style="color: #FF8000">// Register our filter with PHP <br /></span><span style="color: #9876AA">stream_filter_register</span><span style="color: #007700">(</span><span style="color: #DD0000">"strtoupper"</span><span style="color: #007700">, </span><span style="color: #DD0000">"strtoupper_filter"</span><span style="color: #007700">)<br />    or die(</span><span style="color: #DD0000">"Failed to register filter"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"foo-bar.txt"</span><span style="color: #007700">, </span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Attach the registered filter to the stream just opened <br /></span><span style="color: #9876AA">stream_filter_append</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"strtoupper"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"Line1\n"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"Word - 2\n"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"Easy As 123\n"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Read the contents back out<br /> <br /></span><span style="color: #9876AA">readfile</span><span style="color: #007700">(</span><span style="color: #DD0000">"foo-bar.txt"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>LINE1<br>WORD - 2<br>EASY AS 123<br></span></div>    </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 Registering a generic filter class to match multiple filter names.</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #FF8000">// Define our filter class <br /></span><span style="color: #007700">class </span><span style="color: #9876AA">string_filter </span><span style="color: #007700">extends </span><span style="color: #9876AA">php_user_filter </span><span style="color: #007700">{<br />  var </span><span style="color: #9876AA">$mode</span><span style="color: #007700">;<br /><br />  function </span><span style="color: #9876AA">filter</span><span style="color: #007700">(</span><span style="color: #9876AA">$in</span><span style="color: #007700">, </span><span style="color: #9876AA">$out</span><span style="color: #007700">, &amp;</span><span style="color: #9876AA">$consumed</span><span style="color: #007700">, </span><span style="color: #9876AA">$closing</span><span style="color: #007700">)<br />  {<br />    while (</span><span style="color: #9876AA">$bucket </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_bucket_make_writeable</span><span style="color: #007700">(</span><span style="color: #9876AA">$in</span><span style="color: #007700">)) {<br />      if (</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">mode </span><span style="color: #007700">== </span><span style="color: #9876AA">1</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">data </span><span style="color: #007700">= </span><span style="color: #9876AA">strtoupper</span><span style="color: #007700">(</span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">data</span><span style="color: #007700">);<br />      } elseif (</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">mode </span><span style="color: #007700">== </span><span style="color: #9876AA">0</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">data </span><span style="color: #007700">= </span><span style="color: #9876AA">strtolower</span><span style="color: #007700">(</span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">data</span><span style="color: #007700">);<br />      }<br /><br />      </span><span style="color: #9876AA">$consumed </span><span style="color: #007700">+= </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">datalen</span><span style="color: #007700">;<br />      </span><span style="color: #9876AA">stream_bucket_append</span><span style="color: #007700">(</span><span style="color: #9876AA">$out</span><span style="color: #007700">, </span><span style="color: #9876AA">$bucket</span><span style="color: #007700">);<br />    }<br />    return </span><span style="color: #9876AA">PSFS_PASS_ON</span><span style="color: #007700">;<br />  }<br /><br />  function </span><span style="color: #9876AA">onCreate</span><span style="color: #007700">()<br />  {<br />    if (</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">filtername </span><span style="color: #007700">== </span><span style="color: #DD0000">'str.toupper'</span><span style="color: #007700">) {<br />      </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">mode </span><span style="color: #007700">= </span><span style="color: #9876AA">1</span><span style="color: #007700">;<br />    } elseif (</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">filtername </span><span style="color: #007700">== </span><span style="color: #DD0000">'str.tolower'</span><span style="color: #007700">) {<br />      </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">mode </span><span style="color: #007700">= </span><span style="color: #9876AA">0</span><span style="color: #007700">;<br />    } else {<br />      </span><span style="color: #FF8000">// Some other str.* filter was asked for,<br />         report failure so that PHP will keep looking <br />      </span><span style="color: #007700">return </span><span style="color: #9876AA">false</span><span style="color: #007700">;<br />    }<br /><br />    return </span><span style="color: #9876AA">true</span><span style="color: #007700">;<br />  }<br />}<br /><br /></span><span style="color: #FF8000">// Register our filter with PHP <br /></span><span style="color: #9876AA">stream_filter_register</span><span style="color: #007700">(</span><span style="color: #DD0000">"str.*"</span><span style="color: #007700">, </span><span style="color: #DD0000">"string_filter"</span><span style="color: #007700">)<br />    or die(</span><span style="color: #DD0000">"Failed to register filter"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"foo-bar.txt"</span><span style="color: #007700">, </span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Attach the registered filter to the stream just opened<br />   We could alternately bind to str.tolower here <br /></span><span style="color: #9876AA">stream_filter_append</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"str.toupper"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"Line1\n"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"Word - 2\n"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"Easy As 123\n"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Read the contents back out<br /> <br /></span><span style="color: #9876AA">readfile</span><span style="color: #007700">(</span><span style="color: #DD0000">"foo-bar.txt"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>LINE1<br>WORD - 2<br>EASY AS 123<br></span></div>    </div>   </div>  </p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.stream-filter-register-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link stream_wrapper_register()} - 注册一个用 PHP 类实现的 URL 封装协议</span></li>    <li class="member"><span class="function">{@link stream_filter_append()} - Attach a filter to a stream</span></li>    <li class="member"><span class="function">{@link stream_filter_prepend()} - Attach a filter to a stream</span></li>   </ul>  </span> </div></div>
<div id="eventbufferevent.connecthost" class="refentry"> <div class="refnamediv">  <h1 class="refname">EventBufferEvent::connectHost</h1>  <p class="verinfo">(PECL event &gt;= 1.2.6-beta)</p><p class="refpurpose"><span class="refname">EventBufferEvent::connectHost</span> &mdash; <span class="dc-title">Connects to a hostname with optionally asyncronous DNS resolving</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-eventbufferevent.connecthost-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span>   <span class="methodname" style="color:#CC7832"><strong>EventBufferEvent::connectHost</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.eventdnsbase.php" class="type EventDnsBase" style="color:#EAB766">EventDnsBase</a></span>     <span class="parameter" style="color:#3A95FF">$dns_base</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766">string</span>     <span class="parameter" style="color:#3A95FF">$hostname</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766">int</span>     <span class="parameter" style="color:#3A95FF">$port</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766">int</span>     <span class="parameter" style="color:#3A95FF">$family</span>    <span class="initializer"> = EventUtil::AF_UNSPEC</span>   </span><br>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">   Resolves the DNS name hostname, looking for addresses of type   <span class="parameter" style="color:#3A95FF">family</span>   (   <span>EventUtil::AF_*</span>   constants). If the name resolution fails, it invokes the event callback   with an error event. If it succeeds, it launches a connection attempt just   as   <span class="methodname" style="color:#CC7832">{@link EventBufferEvent::connect()}</span>   would.  </p>  <p class="para">   <span class="parameter" style="color:#3A95FF">dns_base</span>   is optional. May be <strong><span>null</span></strong>, or an object created with   <span class="methodname" style="color:#CC7832">{@link EventDnsBase::__construct()}</span>   . For asyncronous hostname resolving pass a valid event dns base resource.   Otherwise the hostname resolving will block.  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    <span class="classname"><a href="https://www.php.net/manual/zh/class.eventdnsbase.php" class="classname">EventDnsBase</a></span>    is available only if    <span>Event</span>    configured    <strong class="option configure">--with-event-extra</strong>    (    <span>event_extra</span>    library,    <em>libevent protocol-specific functionality support including HTTP, DNS, and RPC</em>    ).   </p>  </p></blockquote>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    <span class="methodname" style="color:#CC7832"><strong>EventBufferEvent::connectHost()</strong></span>    requires    <span>libevent-2.0.3-alpha</span>    or greater.   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-eventbufferevent.connecthost-parameters">  <h3 class="title">参数</h3>  <dl>       <dt>     <span class="parameter" style="color:#3A95FF">dns_base</span>    </dt>    <dd>     <span>      Object of      <span class="classname"><a href="https://www.php.net/manual/zh/class.eventdnsbase.php" class="classname">EventDnsBase</a></span>      in case if DNS is to be resolved asyncronously. Otherwise <strong><span>null</span></strong>.     </span>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">hostname</span>    </dt>    <dd>     <p class="para">      Hostname to connect to. Recognized formats are:<div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="parameterscode"><span>www.example.com (hostname)<br> 1.2.3.4 (ipv4address)<br> ::1 (ipv6address)<br>[::1] ([ipv6address])</span></div>      </div>     </p>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">port</span>    </dt>    <dd>     <p class="para">      Port number     </p>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">family</span>    </dt>    <dd>     <p class="para">      Address family.      <strong><span>EventUtil::AF_UNSPEC</span></strong>      ,      <strong><span>EventUtil::AF_INET</span></strong>      , or      <strong><span>EventUtil::AF_INET6</span></strong>      . See      <a href="https://www.php.net/manual/zh/class.eventutil.php#eventutil.constants" class="link">EventUtil constants</a>      .     </p>    </dd>     </dl> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-eventbufferevent.connecthost-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回 <strong><span>true</span></strong>， 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-eventbufferevent.connecthost-examples">  <h3 class="title">示例</h3>  <div class="example" id="">   <p><strong>示例 #1     <span class="function"><strong style="color:#CC7832">EventBufferEvent::connectHost()</strong></span> example</strong></p>   <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// Read callback <br /></span><span style="color: #007700">function </span><span style="color: #9876AA">readcb</span><span style="color: #007700">(</span><span style="color: #9876AA">$bev</span><span style="color: #007700">, </span><span style="color: #9876AA">$base</span><span style="color: #007700">) {<br />    </span><span style="color: #FF8000">//$input = $bev-&gt;input; //$bev-&gt;getInput();<br /><br />    //$pos = $input-&gt;search("TTP");<br />    </span><span style="color: #9876AA">$pos </span><span style="color: #007700">= </span><span style="color: #9876AA">$bev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">input</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">search</span><span style="color: #007700">(</span><span style="color: #DD0000">"TTP"</span><span style="color: #007700">);<br /><br />    while ((</span><span style="color: #9876AA">$n </span><span style="color: #007700">= </span><span style="color: #9876AA">$bev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">input</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">remove</span><span style="color: #007700">(</span><span style="color: #9876AA">$buf</span><span style="color: #007700">, </span><span style="color: #9876AA">1024</span><span style="color: #007700">)) &gt; </span><span style="color: #9876AA">0</span><span style="color: #007700">) {<br />        echo </span><span style="color: #9876AA">$buf</span><span style="color: #007700">;<br />    }<br />}<br /><br /></span><span style="color: #FF8000">// Event callback <br /></span><span style="color: #007700">function </span><span style="color: #9876AA">eventcb</span><span style="color: #007700">(</span><span style="color: #9876AA">$bev</span><span style="color: #007700">, </span><span style="color: #9876AA">$events</span><span style="color: #007700">, </span><span style="color: #9876AA">$base</span><span style="color: #007700">) {<br />    if (</span><span style="color: #9876AA">$events </span><span style="color: #007700">&amp; </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">CONNECTED</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"Connected.\n"</span><span style="color: #007700">;<br />    } elseif (</span><span style="color: #9876AA">$events </span><span style="color: #007700">&amp; (</span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">ERROR </span><span style="color: #007700">| </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">EOF</span><span style="color: #007700">)) {<br />        if (</span><span style="color: #9876AA">$events </span><span style="color: #007700">&amp; </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">ERROR</span><span style="color: #007700">) {<br />            echo </span><span style="color: #DD0000">"DNS error: "</span><span style="color: #007700">, </span><span style="color: #9876AA">$bev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getDnsErrorString</span><span style="color: #007700">(), </span><span style="color: #9876AA">PHP_EOL</span><span style="color: #007700">;<br />        }<br /><br />        echo </span><span style="color: #DD0000">"Closing\n"</span><span style="color: #007700">;<br />        </span><span style="color: #9876AA">$base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">exit</span><span style="color: #007700">();<br />        exit(</span><span style="color: #DD0000">"Done\n"</span><span style="color: #007700">);<br />    }<br />}<br /><br /></span><span style="color: #9876AA">$base </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventBase</span><span style="color: #007700">();<br /><br /></span><span style="color: #9876AA">$dns_base </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventDnsBase</span><span style="color: #007700">(</span><span style="color: #9876AA">$base</span><span style="color: #007700">, </span><span style="color: #9876AA">TRUE</span><span style="color: #007700">); </span><span style="color: #FF8000">// We'll use async DNS resolving<br /></span><span style="color: #007700">if (!</span><span style="color: #9876AA">$dns_base</span><span style="color: #007700">) {<br />    exit(</span><span style="color: #DD0000">"Failed to init DNS Base\n"</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #9876AA">$bev </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">(</span><span style="color: #9876AA">$base</span><span style="color: #007700">, </span><span style="color: #FF8000">// use internal socket  </span><span style="color: #9876AA">NULL</span><span style="color: #007700">,<br />    </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_CLOSE_ON_FREE </span><span style="color: #007700">| </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_DEFER_CALLBACKS</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"readcb"</span><span style="color: #007700">, </span><span style="color: #FF8000">// writecb  </span><span style="color: #9876AA">NULL</span><span style="color: #007700">, </span><span style="color: #DD0000">"eventcb"</span><span style="color: #007700">, </span><span style="color: #9876AA">$base<br /></span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$bev</span><span style="color: #007700">) {<br />    exit(</span><span style="color: #DD0000">"Failed creating bufferevent socket\n"</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">//$bev-&gt;setCallbacks("readcb", // writecb  NULL, "eventcb", $base);<br /></span><span style="color: #9876AA">$bev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">enable</span><span style="color: #007700">(</span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">READ </span><span style="color: #007700">| </span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">WRITE</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$output </span><span style="color: #007700">= </span><span style="color: #9876AA">$bev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">output</span><span style="color: #007700">; </span><span style="color: #FF8000">//$bev-&gt;getOutput();<br /></span><span style="color: #007700">if (!</span><span style="color: #9876AA">$output</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">add</span><span style="color: #007700">(<br />    </span><span style="color: #DD0000">"GET </span><span style="color: #007700">{</span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">2</span><span style="color: #007700">]}</span><span style="color: #DD0000"> HTTP/1.0\r\n"</span><span style="color: #007700">.<br />    </span><span style="color: #DD0000">"Host: </span><span style="color: #007700">{</span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]}</span><span style="color: #DD0000">\r\n"</span><span style="color: #007700">.<br />    </span><span style="color: #DD0000">"Connection: Close\r\n\r\n"<br /></span><span style="color: #007700">)) {<br />    exit(</span><span style="color: #DD0000">"Failed adding request to output buffer\n"</span><span style="color: #007700">);<br />}<br /><br />if (!</span><span style="color: #9876AA">$bev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connectHost</span><span style="color: #007700">(</span><span style="color: #9876AA">$dns_base</span><span style="color: #007700">, </span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">], </span><span style="color: #9876AA">80</span><span style="color: #007700">, </span><span style="color: #9876AA">EventUtil</span><span style="color: #007700">::</span><span style="color: #9876AA">AF_UNSPEC</span><span style="color: #007700">)) {<br />    exit(</span><span style="color: #DD0000">"Can't connect to host </span><span style="color: #007700">{</span><span style="color: #9876AA">$argv</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #9876AA">$base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">dispatch</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>   </div>   <div class="example-contents"><p>以上示例的输出类似于：</p></div>   <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Connected.<br>HTTP/1.0 301 Moved Permanently<br>Location: http://www.google.co.uk/<br>Content-Type: text/html; charset=UTF-8<br>Date: Sat, 09 Mar 2013 12:21:19 GMT<br>Expires: Mon, 08 Apr 2013 12:21:19 GMT<br>Cache-Control: public, max-age=2592000<br>Server: gws<br>Content-Length: 221<br>X-XSS-Protection: 1; mode=block<br>X-Frame-Options: SAMEORIGIN<br><br>&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;<br>&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;<br>&lt;H1&gt;301 Moved&lt;/H1&gt;<br>The document has moved<br>&lt;A HREF=&quot;http://www.google.co.uk/&quot;&gt;here&lt;/A&gt;.<br>&lt;/BODY&gt;&lt;/HTML&gt;<br>Closing<br>Done<br></span></div>   </div>  </div> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-eventbufferevent.connecthost-seealso">  <h3 class="title">参见</h3>  <ul class="simplelist">   <li class="member">    <span class="methodname" style="color:#CC7832">{@link EventBufferEvent::connect()} - Connect buffer event's file descriptor to given address or  UNIX socket</span>   </li>  </ul> </div></div>
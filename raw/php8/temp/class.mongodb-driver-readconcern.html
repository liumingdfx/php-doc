<div id="class.mongodb-driver-readconcern" class="reference"> <h1 class="title">The MongoDB\Driver\ReadConcern class</h1>  <div class="partintro"><p class="verinfo">(mongodb &gt;=1.1.0)</p>  <div class="section" id="mongodb-driver-readconcern.intro">   <h2 class="title">简介</h2>   <p class="para">    <span class="classname"><strong class="classname">MongoDB\Driver\ReadConcern</strong></span> controls the level of    isolation for read operations for replica sets and replica set shards. This    option requires MongoDB 3.2 or later.   </p>  </div>  <div class="section" id="mongodb-driver-readconcern.synopsis">   <h2 class="title">类摘要</h2>   <div class="classsynopsis">    <span class="ooclass"><strong class="classname"></strong></span>    <div class="classsynopsisinfo">     <span class="modifier">final</span>     <span class="ooclass">      <span class="modifier">class</span> <strong class="classname">MongoDB\Driver\ReadConcern</strong>     </span>     <span class="oointerface"><span class="modifier">implements</span>        <a href="https://www.php.net/manual/zh/class.mongodb-bson-serializable.php" class="interfacename">MongoDB\BSON\Serializable</a></span><span class="oointerface">,  <a href="https://www.php.net/manual/zh/class.serializable.php" class="interfacename">Serializable</a></span> {</div>    <div class="classsynopsisinfo classsynopsisinfo_comment">// 常量 </div>    <div class="fieldsynopsis">     <span class="modifier">const</span>     <span class="type" style="color:#EAB766">string</span>      <var class="fieldsynopsis_varname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-readconcern.php#mongodb-driver-readconcern.constants.linearizable"><var class="varname">AVAILABLE</var></a></var><span class="initializer"> = &quot;available&quot;</span>;</div>    <div class="fieldsynopsis"><span class="modifier">const</span>     <span class="type" style="color:#EAB766">string</span>      <var class="fieldsynopsis_varname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-readconcern.php#mongodb-driver-readconcern.constants.linearizable"><var class="varname">LINEARIZABLE</var></a></var><span class="initializer"> = &quot;linearizable&quot;</span>;</div>    <div class="fieldsynopsis"><span class="modifier">const</span>     <span class="type" style="color:#EAB766">string</span>      <var class="fieldsynopsis_varname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-readconcern.php#mongodb-driver-readconcern.constants.local"><var class="varname">LOCAL</var></a></var><span class="initializer"> = &quot;local&quot;</span>;</div>    <div class="fieldsynopsis"><span class="modifier">const</span>     <span class="type" style="color:#EAB766">string</span>      <var class="fieldsynopsis_varname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-readconcern.php#mongodb-driver-readconcern.constants.majority"><var class="varname">MAJORITY</var></a></var><span class="initializer"> = &quot;majority&quot;</span>;</div>    <div class="fieldsynopsis"><span class="modifier">const</span>     <span class="type" style="color:#EAB766">string</span>      <var class="fieldsynopsis_varname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-readconcern.php#mongodb-driver-readconcern.constants.snapshot"><var class="varname">SNAPSHOT</var></a></var><span class="initializer"> = &quot;snapshot&quot;</span>;</div>    <div class="classsynopsisinfo classsynopsisinfo_comment">// 方法 </div>    <div class="methodsynopsis dc-description">   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-readconcern.bsonserialize.php" class="methodname" style="color:#CC7832">bsonSerialize</a></span>(): <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.stdclass.php" class="type stdClass" style="color:#EAB766">stdClass</a></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-readconcern.construct.php" class="methodname" style="color:#CC7832">__construct</a></span>(<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$level</span><span class="initializer"> = <strong><span>null</span></strong></span></span>)</div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-readconcern.getlevel.php" class="methodname" style="color:#CC7832">getLevel</a></span>(): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766">string</span></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-readconcern.isdefault.php" class="methodname" style="color:#CC7832">isDefault</a></span>(): <span class="type" style="color:#EAB766">bool</span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-readconcern.serialize.php" class="methodname" style="color:#CC7832">serialize</a></span>(): <span class="type" style="color:#EAB766">string</span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-readconcern.unserialize.php" class="methodname" style="color:#CC7832">unserialize</a></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$data</span></span>): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div>   }</div>  </div>  <div class="section" id="mongodb-driver-readconcern.constants">   <h2 class="title">预定义常量</h2>   <dl>         <dt id="mongodb-driver-readconcern.constants.available"><strong><span>MongoDB\Driver\ReadConcern::AVAILABLE</span></strong></dt>     <dd>      <p class="para">       Default for reads against secondaries when       <span>afterClusterTime</span>and <span>level</span> are       unspecified.      </p>      <p class="para">       The query returns the instance&#039;s most recent data. Provides no       guarantee that the data has been written to a majority of the replica set       members (i.e. may be rolled back).      </p>      <p class="para">       For unsharded collections (including collections in a standalone       deployment or a replica set deployment), <span>&quot;local&quot;</span> and       <span>&quot;available&quot;</span> read concerns behave identically.      </p>      <p class="para">       For a sharded cluster, <span>&quot;available&quot;</span> read concern       provides greater tolerance for partitions since it does not wait to       ensure consistency guarantees. However, a query with       <span>&quot;available&quot;</span> read concern may return orphan documents       if the shard is undergoing chunk migrations since the       <span>&quot;available&quot;</span> read concern, unlike       <span>&quot;local&quot;</span> read concern, does not contact the       shard&#039;s primary nor the config servers for updated metadata.      </p>     </dd>             <dt id="mongodb-driver-readconcern.constants.linearizable"><strong><span>MongoDB\Driver\ReadConcern::LINEARIZABLE</span></strong></dt>     <dd>      <p class="para">       The query returns data that reflects all successful writes issued with a       write concern of <span>&quot;majority&quot;</span> <em>and</em>       acknowledged prior to the start of the read operation. For replica sets       that run with <span>writeConcernMajorityJournalDefault</span> set       to <strong><span>true</span></strong>, linearizable read concern returns data that will never be       rolled back.      </p>      <p class="para">       With <span>writeConcernMajorityJournalDefault</span> set to       <strong><span>false</span></strong>, MongoDB will not wait for <span>w: &quot;majority&quot;</span>       writes to be durable before acknowledging the writes. As such,       <span>&quot;majority&quot;</span> write operations could possibly roll back       in the event of a loss of a replica set member.      </p>      <p class="para">       You can specify linearizable read concern for read operations on the       primary only.      </p>      <p class="para">       Linearizable read concern guarantees only apply if read       operations specify a query filter that uniquely identifies a single       document.      </p>      <div class="tip"><strong class="tip">小技巧</strong>       <p class="simpara">        Always use <span>maxTimeMS</span> with linearizable read concern        in case a majority of data bearing members are unavailable.        <span>maxTimeMS</span> ensures that the operation does not block        indefinitely and instead ensures that the operation returns an error if        the read concern cannot be fulfilled.       </p>      </div>      <p class="para">       Linearizable read concern requires MongoDB 3.4.      </p>     </dd>             <dt id="mongodb-driver-readconcern.constants.local"><strong><span>MongoDB\Driver\ReadConcern::LOCAL</span></strong></dt>     <dd>      <p class="para">       Default for reads against primary if <span>level</span> is       unspecified and for reads against secondaries if <span>level</span>       is unspecified but <span>afterClusterTime</span> is specified.      </p>      <p class="para">       The query returns the instance&#039;s most recent data. Provides no       guarantee that the data has been written to a majority of the replica set       members (i.e. may be rolled back).      </p>     </dd>             <dt id="mongodb-driver-readconcern.constants.majority"><strong><span>MongoDB\Driver\ReadConcern::MAJORITY</span></strong></dt>     <dd>      <p class="para">       The query returns the instance&#039;s most recent data acknowledged as       having been written to a majority of members in the replica set.      </p>      <p class="para">       To use read concern level of <span>&quot;majority&quot;</span>, replica sets       must use WiredTiger storage engine and election protocol version 1.      </p>     </dd>             <dt id="mongodb-driver-readconcern.constants.snapshot"><strong><span>MongoDB\Driver\ReadConcern::SNAPSHOT</span></strong></dt>     <dd>      <p class="para">       Read concern <span>&quot;snapshot&quot;</span> is available for       multi-document transactions, and starting in MongoDB 5.0, certain read       operations outside of multi-document transactions.      </p>      <p class="para">       If the transaction is not part of a causally consistent session, upon       transaction commit with write concern <span>&quot;majority&quot;</span>, the       transaction operations are guaranteed to have read from a snapshot of       majority-committed data.      </p>      <p class="para">       If the transaction is part of a causally consistent session, upon       transaction commit with write concern <span>&quot;majority&quot;</span>, the       transaction operations are guaranteed to have read from a snapshot of       majority-committed data that provides causal consistency with the       operation immediately preceding the transaction start.      </p>      <p class="para">       Outside of multi-document transactions, read concern       <span>&quot;snapshot&quot;</span> is available on primaries and secondaries       for the following read operations: <span>find</span>,       <span>aggregate</span>, and <span>distinct</span> (on       unsharded collections). All other read commands prohibit       <span>&quot;snapshot&quot;</span>.      </p>     </dd>       </dl>  </div>  <div class="section">   <h2 class="title">更新日志</h2>   <p class="para">    <table class="doctable informaltable">           <thead>       <tr>        <th>版本</th>        <th>说明</th>       </tr>      </thead>      <tbody class="tbody">       <tr>        <td>PECL mongodb 1.11.0</td>        <td>         <p class="para">          Added the <strong><span>MongoDB\Driver\ReadConcern::SNAPSHOT</span></strong>          constant.         </p>        </td>       </tr>       <tr>        <td>PECL mongodb 1.7.0</td>        <td>         Implements <span class="interfacename"><a href="https://www.php.net/manual/zh/class.serializable.php" class="interfacename">Serializable</a></span>.        </td>       </tr>       <tr>        <td>PECL mongodb 1.4.0</td>        <td>         <p class="para">          Added the <strong><span>MongoDB\Driver\ReadConcern::AVAILABLE</span></strong>          constant.         </p>        </td>       </tr>       <tr>        <td>PECL mongodb 1.2.0</td>        <td>         <p class="para">          Added the          <strong><span>MongoDB\Driver\ReadConcern::LINEARIZABLE</span></strong>          constant.         </p>         <p class="para">          Implements <span class="interfacename"><a href="https://www.php.net/manual/zh/class.mongodb-bson-serializable.php" class="interfacename">MongoDB\BSON\Serializable</a></span>.         </p>        </td>       </tr>      </tbody>         </table>   </p>  </div>  <div class="section" id="mongodb-driver-readconcern.seealso">   <h2 class="title">参见</h2>  <ul class="simplelist">   <li class="member"><a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/reference/read-concern/" class="link external">&raquo;&nbsp;Read Concern reference</a></li>  </ul>  </div> </div>   <h2>目录</h2><ul class="chunklist chunklist_reference"><li>{@link MongoDB\Driver\ReadConcern::bsonSerialize} — Returns an object for BSON serialization</li><li>{@link MongoDB\Driver\ReadConcern::__construct} — Create a new ReadConcern</li><li>{@link MongoDB\Driver\ReadConcern::getLevel} — Returns the ReadConcern's &quot;level&quot; option</li><li>{@link MongoDB\Driver\ReadConcern::isDefault} — Checks if this is the default read concern</li><li>{@link MongoDB\Driver\ReadConcern::serialize} — Serialize a ReadConcern</li><li>{@link MongoDB\Driver\ReadConcern::unserialize} — Unserialize a ReadConcern</li></ul></div>
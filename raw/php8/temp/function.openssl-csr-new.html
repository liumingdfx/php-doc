<div id="function.openssl-csr-new" class="refentry"> <div class="refnamediv">  <h1 class="refname">openssl_csr_new</h1>  <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">openssl_csr_new</span> &mdash; <span class="dc-title">生成一个 <abbr title="Certificate Signing Request">CSR</abbr></span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.openssl-csr-new-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>openssl_csr_new</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">$distinguished_names</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.opensslasymmetrickey.php" class="type OpenSSLAsymmetricKey" style="color:#EAB766">OpenSSLAsymmetricKey</a></span> <span class="parameter" style="color:#3A95FF">&$private_key</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$options</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$extra_attributes</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.opensslcertificatesigningrequest.php" class="type OpenSSLCertificateSigningRequest" style="color:#EAB766">OpenSSLCertificateSigningRequest</a></span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">openssl_csr_new()</strong></span> 根据 <span class="parameter" style="color:#3A95FF">distinguished_names</span> 提供的信息生成新的 <abbr title="Certificate Signing Request">CSR</abbr>（证书签名请求）。  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>: <span class="simpara"> 必须安装有效的 <var class="filename">openssl.cnf</var> 以保证此函数正确运行。参考有关<a href="https://www.php.net/manual/zh/openssl.installation.php" class="link">安装</a>的说明以获得更多信息。</span></p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.openssl-csr-new-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">distinguished_names</span></dt>     <dd>      <p class="para">       在证书中使用的专有名称或主题字段。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">private_key</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">private_key</span> 应该被设置为由 <span class="function">{@link openssl_pkey_new()}</span> 函数预先生成(或者以其他方式从 openssl_pkey 函数集中获得)的私钥。该密钥的相应公共部分将用于签署 <abbr title="Certificate Signing Request">CSR</abbr>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">options</span></dt>     <dd>      <p class="para">       默认通过系统里的 <span>openssl.conf</span> 配置来初始化请求；可以通过设置 <span class="parameter" style="color:#3A95FF">options</span> 的 <span>config_section_section</span> 项来指定配置文件部分。       还可以通过将 config 键的值设置为想要使用的文件路径来指定另一个 openssl 配置文件。如果在 <span class="parameter" style="color:#3A95FF">options</span> 中存在下列键，它们的行为就像在 <span>openssl.conf</span> 中一样。如下表所示：       <table class="doctable table">        <caption><strong>配置覆盖</strong></caption>                 <thead>          <tr>           <th><span class="parameter" style="color:#3A95FF">options</span> 键</th>           <th>类型</th>           <th>等同于 <span>openssl.conf</span></th>           <th>描述</th>          </tr>         </thead>         <tbody class="tbody">          <tr>           <td>digest_alg</td>           <td><span class="type" style="color:#EAB766">string</span></td>           <td>default_md</td>           <td>摘要算法或签名哈希算法，通常是 <span class="function">{@link openssl_get_md_methods()}</span> 之一。</td>          </tr>          <tr>           <td>x509_extensions</td>           <td><span class="type" style="color:#EAB766">string</span></td>           <td>x509_extensions</td>           <td>选择在创建 x509 证书时应该使用哪些扩展</td>          </tr>          <tr>           <td>req_extensions</td>           <td><span class="type" style="color:#EAB766">string</span></td>           <td>req_extensions</td>           <td>创建 <abbr title="Certificate Signing Request">CSR</abbr> 时，选择使用哪个扩展</td>          </tr>          <tr>           <td>private_key_bits</td>           <td><span class="type" style="color:#EAB766">int</span></td>           <td>default_bits</td>           <td>指定应该使用多少位来生成私钥</td>          </tr>          <tr>           <td>private_key_type</td>           <td><span class="type" style="color:#EAB766">int</span></td>           <td>none</td>           <td>选择在创建 CSR 时应该使用哪些扩展。可选值有            <strong><span>OPENSSL_KEYTYPE_DSA</span></strong>、            <strong><span>OPENSSL_KEYTYPE_DH</span></strong>、            <strong><span>OPENSSL_KEYTYPE_RSA</span></strong> 或            <strong><span>OPENSSL_KEYTYPE_EC</span></strong>。            默认值是 <strong><span>OPENSSL_KEYTYPE_RSA</span></strong>。           </td>          </tr>          <tr>           <td>encrypt_key</td>           <td><span class="type" style="color:#EAB766">bool</span></td>           <td>encrypt_key</td>           <td>是否应该对导出的密钥（带有密码短语）进行加密?</td>          </tr>          <tr>           <td>encrypt_key_cipher</td>           <td><span class="type" style="color:#EAB766">int</span></td>           <td>none</td>           <td>            <a href="https://www.php.net/manual/zh/openssl.ciphers.php" class="link">cipher constants</a> 常量之一。           </td>          </tr>          <tr>           <td>curve_name</td>           <td><span class="type" style="color:#EAB766">string</span></td>           <td>none</td>           <td>            <span class="function">{@link openssl_get_curve_names()}</span> 之一。           </td>          </tr>          <tr>           <td>config</td>           <td><span class="type" style="color:#EAB766">string</span></td>           <td>N/A</td>           <td>            自定义 openssl.conf 文件的路径。           </td>          </tr>         </tbody>               </table>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">extra_attributes</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">extra_attributes</span> 用于为 <abbr title="Certificate Signing Request">CSR</abbr> 指定额外的配置选项。<span class="parameter" style="color:#3A95FF">distinguished_names</span> 和       <span class="parameter" style="color:#3A95FF">extra_attributes</span> 都是关联数组它们的键被转换成 OID，并应用到请求的相关部分。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.openssl-csr-new-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功，返回 <abbr title="Certificate Signing Request">CSR</abbr> 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.openssl-csr-new-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>      <td>8.0.0</td>      <td>       成功时，此函数现在返回 <span class="classname"><a href="https://www.php.net/manual/zh/class.opensslcertificatesigningrequest.php" class="classname">OpenSSLCertificateSigningRequest</a></span>       实例；之前返回类型 <span>OpenSSL X.509 CSR</span> 的 <a href="https://www.php.net/manual/zh/language.types.resource.php" class="link">resource</a>。      </td>     </tr>     <tr>      <td>8.0.0</td>      <td>       <span class="parameter" style="color:#3A95FF">private_key</span> 现在接受 <span class="classname"><a href="https://www.php.net/manual/zh/class.opensslasymmetrickey.php" class="classname">OpenSSLAsymmetricKey</a></span>       实例；之前接受类型 <span>OpenSSL key</span> 的 <a href="https://www.php.net/manual/zh/language.types.resource.php" class="link">resource</a>。      </td>     </tr>     <tr>      <td>7.1.0</td>      <td>       <span class="parameter" style="color:#3A95FF">options</span> 现在也支持 <span>curve_name</span>。      </td>     </tr>    </tbody>     </table> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.openssl-csr-new-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="example-2795">    <p><strong>示例 #1 创建一个自签名的证书</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// for SSL server certificates the commonName is the domain name to be secured<br />// for S/MIME email certificates the commonName is the owner of the email address<br />// location and identification fields refer to the owner of domain or email subject to be secured<br /></span><span style="color: #9876AA">$dn </span><span style="color: #007700">= array(<br />    </span><span style="color: #DD0000">"countryName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"GB"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"stateOrProvinceName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"Somerset"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"localityName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"Glastonbury"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"organizationName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"The Brain Room Limited"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"organizationalUnitName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"PHP Documentation Team"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"commonName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"Wez Furlong"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"emailAddress" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"wez@example.com"<br /></span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Generate a new private (and public) key pair<br /></span><span style="color: #9876AA">$privkey </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_pkey_new</span><span style="color: #007700">(array(<br />    </span><span style="color: #DD0000">"private_key_bits" </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2048</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"private_key_type" </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">OPENSSL_KEYTYPE_RSA</span><span style="color: #007700">,<br />));<br /><br /></span><span style="color: #FF8000">// Generate a certificate signing request<br /></span><span style="color: #9876AA">$csr </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_csr_new</span><span style="color: #007700">(</span><span style="color: #9876AA">$dn</span><span style="color: #007700">, </span><span style="color: #9876AA">$privkey</span><span style="color: #007700">, array(</span><span style="color: #DD0000">'digest_alg' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">// Generate a self-signed cert, valid for 365 days<br /></span><span style="color: #9876AA">$x509 </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_csr_sign</span><span style="color: #007700">(</span><span style="color: #9876AA">$csr</span><span style="color: #007700">, </span><span style="color: #9876AA">null</span><span style="color: #007700">, </span><span style="color: #9876AA">$privkey</span><span style="color: #007700">, </span><span style="color: #9876AA">$days</span><span style="color: #007700">=</span><span style="color: #9876AA">365</span><span style="color: #007700">, array(</span><span style="color: #DD0000">'digest_alg' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">// Save your private key, CSR and self-signed cert for later use<br /></span><span style="color: #9876AA">openssl_csr_export</span><span style="color: #007700">(</span><span style="color: #9876AA">$csr</span><span style="color: #007700">, </span><span style="color: #9876AA">$csrout</span><span style="color: #007700">) and </span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$csrout</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">openssl_x509_export</span><span style="color: #007700">(</span><span style="color: #9876AA">$x509</span><span style="color: #007700">, </span><span style="color: #9876AA">$certout</span><span style="color: #007700">) and </span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$certout</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">openssl_pkey_export</span><span style="color: #007700">(</span><span style="color: #9876AA">$privkey</span><span style="color: #007700">, </span><span style="color: #9876AA">$pkeyout</span><span style="color: #007700">, </span><span style="color: #DD0000">"mypassword"</span><span style="color: #007700">) and </span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$pkeyout</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Show any errors that occurred here<br /></span><span style="color: #007700">while ((</span><span style="color: #9876AA">$e </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_error_string</span><span style="color: #007700">()) !== </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #9876AA">$e </span><span style="color: #007700">. </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>      <div class="example" id="example-2798">    <p><strong>示例 #2 创建一个自签名的 ECC 证书（从 PHP 7.1.0 开始）</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$subject </span><span style="color: #007700">= array(<br />    </span><span style="color: #DD0000">"commonName" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"docs.php.net"</span><span style="color: #007700">,<br />);<br /><br /></span><span style="color: #FF8000">// Generate a new private (and public) key pair<br /></span><span style="color: #9876AA">$private_key </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_pkey_new</span><span style="color: #007700">(array(<br />    </span><span style="color: #DD0000">"private_key_type" </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">OPENSSL_KEYTYPE_EC</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"curve_name" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'prime256v1'</span><span style="color: #007700">,<br />));<br /><br /></span><span style="color: #FF8000">// Generate a certificate signing request<br /></span><span style="color: #9876AA">$csr </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_csr_new</span><span style="color: #007700">(</span><span style="color: #9876AA">$subject</span><span style="color: #007700">, </span><span style="color: #9876AA">$private_key</span><span style="color: #007700">, array(</span><span style="color: #DD0000">'digest_alg' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sha384'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">// Generate self-signed EC cert<br /></span><span style="color: #9876AA">$x509 </span><span style="color: #007700">= </span><span style="color: #9876AA">openssl_csr_sign</span><span style="color: #007700">(</span><span style="color: #9876AA">$csr</span><span style="color: #007700">, </span><span style="color: #9876AA">null</span><span style="color: #007700">, </span><span style="color: #9876AA">$private_key</span><span style="color: #007700">, </span><span style="color: #9876AA">$days</span><span style="color: #007700">=</span><span style="color: #9876AA">365</span><span style="color: #007700">, array(</span><span style="color: #DD0000">'digest_alg' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sha384'</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">openssl_x509_export_to_file</span><span style="color: #007700">(</span><span style="color: #9876AA">$x509</span><span style="color: #007700">, </span><span style="color: #DD0000">'ecc-cert.pem'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">openssl_pkey_export_to_file</span><span style="color: #007700">(</span><span style="color: #9876AA">$private_key</span><span style="color: #007700">, </span><span style="color: #DD0000">'ecc-private.key'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>        </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.openssl-csr-new-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link openssl_csr_sign()} - 用另一个证书签署 CSR（或者本身）并且生成一个证书</span></li>   </ul>  </span> </div></div>
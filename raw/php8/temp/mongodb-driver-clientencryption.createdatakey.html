<div id="mongodb-driver-clientencryption.createdatakey" class="refentry"> <div class="refnamediv">  <h1 class="refname">MongoDB\Driver\ClientEncryption::createDataKey</h1>  <p class="verinfo">(mongodb &gt;=1.7.0)</p><p class="refpurpose"><span class="refname">MongoDB\Driver\ClientEncryption::createDataKey</span> &mdash; <span class="dc-title">Creates a key document</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-mongodb-driver-clientencryption.createdatakey-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>MongoDB\Driver\ClientEncryption::createDataKey</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$kmsProvider</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$options</span><span class="initializer"> = <strong><span>null</span></strong></span></span>): <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.mongodb-bson-binary.php" class="type MongoDB\BSON\Binary" style="color:#EAB766">MongoDB\BSON\Binary</a></span></div>  <p class="para rdfs-comment">   Creates a new key document and inserts it into the key vault collection.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-mongodb-driver-clientencryption.createdatakey-parameters">  <h3 class="title">参数</h3>  <dl>       <dt><span class="parameter" style="color:#3A95FF">kmsProvider</span></dt>    <dd>     <span>      The KMS provider (e.g. <span>&quot;local&quot;</span>,      <span>&quot;aws&quot;</span>) that will be used to encrypt the new data key.     </span>    </dd>          <dt><span class="parameter" style="color:#3A95FF">options</span></dt>    <dd>     <p class="para">      <table class="doctable table">       <caption><strong>Data key options</strong></caption>               <thead>         <tr>          <th>Option</th>          <th>Type</th>          <th>Description</th>         </tr>        </thead>        <tbody class="tbody">         <tr>          <td>masterKey</td>          <td><span class="type" style="color:#EAB766">array</span></td>          <td>           <p class="para">            The masterKey document identifies a KMS-specific key used to encrypt            the new data key. This option is required unless            <span class="parameter" style="color:#3A95FF">kmsProvider</span> is <span>&quot;local&quot;</span>.           </p>             <p class="para">   <table class="doctable table">    <caption><strong><span>&quot;aws&quot;</span> provider options</strong></caption>         <thead>      <tr>       <th>Option</th>       <th>Type</th>       <th>Description</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>region</td>       <td>string</td>       <td>Required.</td>      </tr>      <tr>       <td>key</td>       <td>string</td>       <td>Required. The Amazon Resource Name (ARN) to the AWS customer master key (CMK).</td>      </tr>      <tr>       <td>endpoint</td>       <td>string</td>       <td>Optional. An alternate host identifier to send KMS requests to. May include port number.</td>      </tr>     </tbody>       </table>  </p>  <p class="para">   <table class="doctable table">    <caption><strong><span>&quot;azure&quot;</span> provider options</strong></caption>         <thead>      <tr>       <th>Option</th>       <th>Type</th>       <th>Description</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>keyVaultEndpoint</td>       <td>string</td>       <td>Required. Host with optional port (e.g. &quot;example.vault.azure.net&quot;).</td>      </tr>      <tr>       <td>keyName</td>       <td>string</td>       <td>Required.</td>      </tr>      <tr>       <td>keyVersion</td>       <td>string</td>       <td>Optional. A specific version of the named key. Defaults to using the key&#039;s primary version.</td>      </tr>     </tbody>       </table>  </p>  <p class="para">   <table class="doctable table">    <caption><strong><span>&quot;gcp&quot;</span> provider options</strong></caption>         <thead>      <tr>       <th>Option</th>       <th>Type</th>       <th>Description</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>projectId</td>       <td>string</td>       <td>Required.</td>      </tr>      <tr>       <td>location</td>       <td>string</td>       <td>Required.</td>      </tr>      <tr>       <td>keyRing</td>       <td>string</td>       <td>Required.</td>      </tr>      <tr>       <td>keyName</td>       <td>string</td>       <td>Required.</td>      </tr>      <tr>       <td>keyVersion</td>       <td>string</td>       <td>Optional. A specific version of the named key. Defaults to using the key&#039;s primary version.</td>      </tr>      <tr>       <td>endpoint</td>       <td>string</td>       <td>Optional. Host with optional port. Defaults to &quot;cloudkms.googleapis.com&quot;.</td>      </tr>     </tbody>       </table>  </p>  <p class="para">   <table class="doctable table">    <caption><strong><span>&quot;kmip&quot;</span> provider options</strong></caption>         <thead>      <tr>       <th>Option</th>       <th>Type</th>       <th>Description</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>keyId</td>       <td>string</td>       <td>Optional. Unique identifier to a 96-byte KMIP secret data managed object. If unspecified, the driver creates a random 96-byte KMIP secret data managed object.</td>      </tr>      <tr>       <td>endpoint</td>       <td>string</td>       <td>Optional. Host with optional port.</td>      </tr>     </tbody>       </table>  </p>          </td>         </tr>         <tr>          <td>keyAltNames</td>          <td><span class="type" style="color:#EAB766">array</span></td>          <td>           <p class="para">            An optional list of string alternate names used to reference a key.            If a key is created with alternate names, then encryption may refer            to the key by the unique alternate name instead of by            <span>_id</span>.           </p>          </td>         </tr>         <tr>          <td>keyMaterial</td>          <td><span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-bson-binary.php" class="classname">MongoDB\BSON\Binary</a></span></td>          <td>           <p class="para">            An optional 96-byte value to use as custom key material for the data            key being created. If keyMaterial is given, the custom key material            is used for encrypting and decrypting data. Otherwise, the key            material for the new data key is generated from a cryptographically            secure random device.           </p>          </td>         </tr>        </tbody>             </table>     </p>    </dd>     </dl> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-mongodb-driver-clientencryption.createdatakey-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   Returns the identifier of the new key as a   <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-bson-binary.php" class="classname">MongoDB\BSON\Binary</a></span> object with subtype 4 (UUID).  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-mongodb-driver-clientencryption.createdatakey-errors">  <h3 class="title">错误／异常</h3>  <ul class="simplelist">   <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-invalidargumentexception.php" class="classname">MongoDB\Driver\Exception\InvalidArgumentException</a></span> on argument parsing errors.</li><li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-connectionexception.php" class="classname">MongoDB\Driver\Exception\ConnectionException</a></span> if connection to the server fails (for reasons other than authentication).</li><li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-authenticationexception.php" class="classname">MongoDB\Driver\Exception\AuthenticationException</a></span> if authentication is needed and fails.</li>   <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-runtimeexception.php" class="classname">MongoDB\Driver\Exception\RuntimeException</a></span> on other errors.</li>  </ul> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-mongodb-driver-clientencryption.createdatakey-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>PECL mongodb 1.15.0</td>       <td>        Added the <span>&quot;keyMaterial&quot;</span> option.       </td>      </tr>      <tr>       <td>PECL mongodb 1.10.0</td>       <td>        Azure and GCP are now supported as KMS providers for client-side        encryption.       </td>      </tr>     </tbody>       </table>  </span> </div></div>
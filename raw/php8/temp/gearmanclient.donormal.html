<div id="gearmanclient.donormal" class="refentry"> <div class="refnamediv">  <h1 class="refname">GearmanClient::doNormal</h1>  <p class="verinfo">(No version information available, might only be in Git)</p><p class="refpurpose"><span class="refname">GearmanClient::doNormal</span> &mdash; <span class="dc-title">Run a single task and return a result</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-gearmanclient.donormal-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>GearmanClient::doNormal</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$function</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$workload</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$unique</span><span class="initializer"> = <strong><span>null</span></strong></span></span>): <span class="type" style="color:#EAB766">string</span></div>  <p class="para rdfs-comment">   Runs a single task and returns a string representation of the result.  It is up to   the <span class="classname"><a href="https://www.php.net/manual/zh/class.gearmanclient.php" class="classname">GearmanClient</a></span> and <span class="classname"><a href="https://www.php.net/manual/zh/class.gearmanworker.php" class="classname">GearmanWorker</a></span> to   agree on the format of the result.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-gearmanclient.donormal-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">function</span></dt>     <dd>      <p class="para">       由程序自动执行的已注册函数。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">workload</span></dt>     <dd>      <p class="para">       被处理的序列化数据。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">unique</span></dt>     <dd>      <p class="para">       用于标识特定任务的唯一性 ID。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-gearmanclient.donormal-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   A string representing the results of running a task.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-gearmanclient.donormal-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 Simple job submission with immediate return</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />?&gt;</span></span></span></div>    </div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #FF8000"># Client code<br /><br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">"Starting\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Create our client object.<br /></span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">= new </span><span style="color: #9876AA">GearmanClient</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Add default server (localhost).<br /></span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addServer</span><span style="color: #007700">();<br /><br />echo </span><span style="color: #DD0000">"Sending job\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">doNormal</span><span style="color: #007700">(</span><span style="color: #DD0000">"reverse"</span><span style="color: #007700">, </span><span style="color: #DD0000">"Hello!"</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #DD0000">"Success: </span><span style="color: #9876AA">$result</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">"Starting\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Create our worker object.<br /></span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">= new </span><span style="color: #9876AA">GearmanWorker</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Add default server (localhost).<br /></span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addServer</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Register function "reverse" with the server. Change the worker function to<br /># "reverse_fn_fast" for a faster worker with no output.<br /></span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addFunction</span><span style="color: #007700">(</span><span style="color: #DD0000">"reverse"</span><span style="color: #007700">, </span><span style="color: #DD0000">"reverse_fn"</span><span style="color: #007700">);<br /><br />print </span><span style="color: #DD0000">"Waiting for job...\n"</span><span style="color: #007700">;<br />while(</span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">work</span><span style="color: #007700">())<br />{<br />  if (</span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() != </span><span style="color: #9876AA">GEARMAN_SUCCESS</span><span style="color: #007700">)<br />  {<br />    echo </span><span style="color: #DD0000">"return_code: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />    break;<br />  }<br />}<br /><br />function </span><span style="color: #9876AA">reverse_fn</span><span style="color: #007700">(</span><span style="color: #9876AA">$job</span><span style="color: #007700">)<br />{<br />  return </span><span style="color: #9876AA">strrev</span><span style="color: #007700">(</span><span style="color: #9876AA">$job</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">workload</span><span style="color: #007700">());<br />}<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例的输出类似于：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Starting<br>Sending job<br>Success: !olleH<br></span></div>    </div>   </div>   <div class="example" id="">    <p><strong>示例 #2 Submitting a job and retrieving incremental status</strong></p>    <div class="example-contents"><p>     A job is submitted and the script loops to retrieve status information.     The worker has an artificial delay which results in a long running job     and sends status and data as processing occurs.     Each subsequent call to <span class="methodname" style="color:#CC7832"><strong>GearmanClient::doNormal()</strong></span>     produces status information on the running job.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #FF8000"># Client code<br /><br /># Create our client object.<br /></span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">= new </span><span style="color: #9876AA">GearmanClient</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Add default server (localhost).<br /></span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addServer</span><span style="color: #007700">();<br /><br />echo </span><span style="color: #DD0000">"Sending job\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Send reverse job<br /></span><span style="color: #007700">do<br />{<br />  </span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">doNormal</span><span style="color: #007700">(</span><span style="color: #DD0000">"reverse"</span><span style="color: #007700">, </span><span style="color: #DD0000">"Hello!"</span><span style="color: #007700">);<br />  </span><span style="color: #FF8000"># Check for various return packets and errors.<br /><br />  </span><span style="color: #007700">switch(</span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">())<br />  {<br />    case </span><span style="color: #9876AA">GEARMAN_WORK_DATA</span><span style="color: #007700">:<br />      echo </span><span style="color: #DD0000">"Data: </span><span style="color: #9876AA">$result</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />      break;<br />    case </span><span style="color: #9876AA">GEARMAN_WORK_STATUS</span><span style="color: #007700">:<br />      list(</span><span style="color: #9876AA">$numerator</span><span style="color: #007700">, </span><span style="color: #9876AA">$denominator</span><span style="color: #007700">)= </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">doStatus</span><span style="color: #007700">();<br />      echo </span><span style="color: #DD0000">"Status: </span><span style="color: #9876AA">$numerator</span><span style="color: #DD0000">/</span><span style="color: #9876AA">$denominator</span><span style="color: #DD0000"> complete\n"</span><span style="color: #007700">;<br />      break;<br />    case </span><span style="color: #9876AA">GEARMAN_WORK_FAIL</span><span style="color: #007700">:<br />      echo </span><span style="color: #DD0000">"Failed\n"</span><span style="color: #007700">;<br />      exit;<br />    case </span><span style="color: #9876AA">GEARMAN_SUCCESS</span><span style="color: #007700">:<br />      break;<br />    default:<br />      echo </span><span style="color: #DD0000">"RET: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />      echo </span><span style="color: #DD0000">"Error: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">error</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />      echo </span><span style="color: #DD0000">"Errno: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">getErrno</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />      exit;<br />  }<br />}<br />while(</span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() != </span><span style="color: #9876AA">GEARMAN_SUCCESS</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #DD0000">"Success: </span><span style="color: #9876AA">$result</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #FF8000"># Worker code<br /><br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">"Starting\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Create our worker object.<br /></span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">= new </span><span style="color: #9876AA">GearmanWorker</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Add default server (localhost).<br /></span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addServer</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Register function "reverse" with the server.<br /></span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addFunction</span><span style="color: #007700">(</span><span style="color: #DD0000">"reverse"</span><span style="color: #007700">, </span><span style="color: #DD0000">"reverse_fn"</span><span style="color: #007700">);<br /><br />print </span><span style="color: #DD0000">"Waiting for job...\n"</span><span style="color: #007700">;<br />while(</span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">work</span><span style="color: #007700">())<br />{<br />  if (</span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() != </span><span style="color: #9876AA">GEARMAN_SUCCESS</span><span style="color: #007700">)<br />  {<br />    echo </span><span style="color: #DD0000">"return_code: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />    break;<br />  }<br />}<br /><br />function </span><span style="color: #9876AA">reverse_fn</span><span style="color: #007700">(</span><span style="color: #9876AA">$job</span><span style="color: #007700">)<br />{<br />  echo </span><span style="color: #DD0000">"Received job: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$job</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">handle</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br />  </span><span style="color: #9876AA">$workload </span><span style="color: #007700">= </span><span style="color: #9876AA">$job</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">workload</span><span style="color: #007700">();<br />  </span><span style="color: #9876AA">$workload_size </span><span style="color: #007700">= </span><span style="color: #9876AA">$job</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">workloadSize</span><span style="color: #007700">();<br /><br />  echo </span><span style="color: #DD0000">"Workload: </span><span style="color: #9876AA">$workload</span><span style="color: #DD0000"> (</span><span style="color: #9876AA">$workload_size</span><span style="color: #DD0000">)\n"</span><span style="color: #007700">;<br /><br />  </span><span style="color: #FF8000"># This status loop is not needed, just showing how it works<br />  </span><span style="color: #007700">for (</span><span style="color: #9876AA">$x</span><span style="color: #007700">= </span><span style="color: #9876AA">0</span><span style="color: #007700">; </span><span style="color: #9876AA">$x </span><span style="color: #007700">&lt; </span><span style="color: #9876AA">$workload_size</span><span style="color: #007700">; </span><span style="color: #9876AA">$x</span><span style="color: #007700">++)<br />  {<br />    echo </span><span style="color: #DD0000">"Sending status: " </span><span style="color: #007700">+ </span><span style="color: #9876AA">$x </span><span style="color: #007700">+ </span><span style="color: #9876AA">1 </span><span style="color: #007700">. </span><span style="color: #DD0000">"/</span><span style="color: #9876AA">$workload_size</span><span style="color: #DD0000"> complete\n"</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">$job</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">sendStatus</span><span style="color: #007700">(</span><span style="color: #9876AA">$x</span><span style="color: #007700">+</span><span style="color: #9876AA">1</span><span style="color: #007700">, </span><span style="color: #9876AA">$workload_size</span><span style="color: #007700">);<br />    </span><span style="color: #9876AA">$job</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">sendData</span><span style="color: #007700">(</span><span style="color: #9876AA">substr</span><span style="color: #007700">(</span><span style="color: #9876AA">$workload</span><span style="color: #007700">, </span><span style="color: #9876AA">$x</span><span style="color: #007700">, </span><span style="color: #9876AA">1</span><span style="color: #007700">));<br />    </span><span style="color: #9876AA">sleep</span><span style="color: #007700">(</span><span style="color: #9876AA">1</span><span style="color: #007700">);<br />  }<br /><br />  </span><span style="color: #9876AA">$result</span><span style="color: #007700">= </span><span style="color: #9876AA">strrev</span><span style="color: #007700">(</span><span style="color: #9876AA">$workload</span><span style="color: #007700">);<br />  echo </span><span style="color: #DD0000">"Result: </span><span style="color: #9876AA">$result</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br /><br />  </span><span style="color: #FF8000"># Return what we want to send back to the client.<br />  </span><span style="color: #007700">return </span><span style="color: #9876AA">$result</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例的输出类似于：</p></div>    <div class="example-contents"><p>     Worker output:    </p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Starting<br>Waiting for job...<br>Received job: H:foo.local:106<br>Workload: Hello! (6)<br>1/6 complete<br>2/6 complete<br>3/6 complete<br>4/6 complete<br>5/6 complete<br>6/6 complete<br>Result: !olleH<br></span></div>    </div>    <div class="example-contents"><p>     Client output:    </p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Starting<br>Sending job<br>Status: 1/6 complete<br>Data: H<br>Status: 2/6 complete<br>Data: e<br>Status: 3/6 complete<br>Data: l<br>Status: 4/6 complete<br>Data: l<br>Status: 5/6 complete<br>Data: o<br>Status: 6/6 complete<br>Data: !<br>Success: !olleH<br></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-gearmanclient.donormal-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanClient::doHigh()} - Run a single high priority task</span></li>    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanClient::doLow()} - Run a single low priority task</span></li>    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanClient::doBackground()} - Run a task in the background</span></li>    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanClient::doHighBackground()} - Run a high priority task in the background</span></li>    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanClient::doLowBackground()} - Run a low priority task in the background</span></li>   </ul>  </span> </div></div>
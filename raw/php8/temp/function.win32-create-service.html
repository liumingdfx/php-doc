<div id="function.win32-create-service" class="refentry"> <div class="refnamediv">  <h1 class="refname">win32_create_service</h1>  <p class="verinfo">(PECL win32service &gt;=0.1.0)</p><p class="refpurpose"><span class="refname">win32_create_service</span> &mdash; <span class="dc-title">Creates a new service entry in the SCM database</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.win32-create-service-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>win32_create_service</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">$details</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$machine</span><span class="initializer"> = ?</span></span>): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div>  <p class="para rdfs-comment">   Attempts to add a service into the SCM database. Administrative   privileges are required for this to succeed.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.win32-create-service-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">details</span></dt>     <dd>      <p class="para">       An array of service details:       <dl>                 <dt><span class="parameter" style="color:#3A95FF">service</span></dt>         <dd>          <p class="para">           The short name of the service.  This is the name that you           will use to control the service using the <span>net</span>           command.  The service must be unique (no two services can share the           same name), and, ideally, should avoid having spaces in the name.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">display</span></dt>         <dd>          <p class="para">The display name of the service.  This is the name that you          will see in the Services Applet.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">description</span></dt>         <dd>          <p class="para">The long description of the service.  This is the description          that you will see in the Services Applet.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">user</span></dt>         <dd>          <p class="para">           The name of the user account under which you want the service to           run.  If omitted, the service will run as the LocalSystem account.           If the username is specified, you must also provide a password.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">password</span></dt>         <dd>          <p class="para">           The password that corresponds to the <span class="parameter" style="color:#3A95FF">user</span>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">path</span></dt>         <dd>          <p class="para">           The full path to the executable module that will be launched when           the service is started.  If omitted, the path to the current PHP           process will be used.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">params</span></dt>         <dd>          <p class="para">           Command line parameters to pass to the service when it starts.           If you want to run a PHP script as the service, then the first           parameter should be the full path to the PHP script that you intend           to run. If the script name or path contains spaces, then wrap the           full path to the PHP script with <span>&quot;</span>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">load_order</span></dt>         <dd>          <p class="para">           Controls the load_order.  This is not yet fully supported.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">svc_type</span></dt>         <dd>          <p class="para">           Sets the service type.  If omitted, the default value is           <strong><span>WIN32_SERVICE_WIN32_OWN_PROCESS</span></strong>.           Don&#039;t change this unless you know what you&#039;re doing.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">start_type</span></dt>         <dd>          <p class="para">           Specifies how the service should be started.  The default is           <strong><span>WIN32_SERVICE_AUTO_START</span></strong> which means the           service will be launched when the machine starts up.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">error_control</span></dt>         <dd>          <p class="para">           Informs the SCM what it should do when it detects a problem with           the service.  The default is           <strong><span>WIN32_SERVER_ERROR_IGNORE</span></strong>.  Changing this           value is not yet fully supported.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">delayed_start</span></dt>         <dd>          <p class="para">           If <span class="parameter" style="color:#3A95FF">delayed_start</span> is set to <strong><span>true</span></strong>, then this           will inform the SCM that this service should be started after other           auto-start services are started plus a short delay.          </p>          <p class="para">           Any service can be marked as a delayed auto-start service; however,           this setting has no effect unless the service&#039;s           <span class="parameter" style="color:#3A95FF">start_type</span> is           <strong><span>WIN32_SERVICE_AUTO_START</span></strong>.          </p>          <p class="para">           This setting is only applicable on Windows Vista and Windows Server           2008 or greater.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">base_priority</span></dt>         <dd>          <p class="para">           To reduce the impact on processor utilisation, it may be necessary           to set a base priority lower than normal.          </p>          <p class="para">           The <span class="parameter" style="color:#3A95FF">base_priority</span> can be set to one of the           constants define in           <a href="https://www.php.net/manual/zh/win32service.constants.basepriorities.php" class="link">Win32 Base Priority Classes</a>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">dependencies</span></dt>         <dd>          <p class="para">           To define the dependencies for your service, it may be necessary to set            this parameter to the list of the services names in an array.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_delay</span></dt>         <dd>          <p class="para">           This parameter defines the delay between the fail and the execution            of recovery action. The value is in milliseconds.          </p>          <p class="para">           The default value is 60000.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_action_1</span></dt>         <dd>          <p class="para">           The action will be executed on first failure. The default value is            <strong><span>WIN32_SC_ACTION_NONE</span></strong>.          </p>          <p class="para">           The <span class="parameter" style="color:#3A95FF">recovery_action_1</span> can be set to one of the           constants defined in           <a href="https://www.php.net/manual/zh/win32service.constants.recovery-action.php" class="link">Win32 Recovery action</a>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_action_2</span></dt>         <dd>          <p class="para">           The action will be executed on second failure. The default value is            <strong><span>WIN32_SC_ACTION_NONE</span></strong>.          </p>          <p class="para">           The <span class="parameter" style="color:#3A95FF">recovery_action_2</span> can be set to one of the           constants defined in           <a href="https://www.php.net/manual/zh/win32service.constants.recovery-action.php" class="link">Win32 Recovery action</a>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_action_3</span></dt>         <dd>          <p class="para">           The action will be executed on next failures. The default value is            <strong><span>WIN32_SC_ACTION_NONE</span></strong>.          </p>          <p class="para">           The <span class="parameter" style="color:#3A95FF">recovery_action_3</span> can be set to one of the           constants defined in           <a href="https://www.php.net/manual/zh/win32service.constants.recovery-action.php" class="link">Win32 Recovery action</a>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_reset_period</span></dt>         <dd>          <p class="para">           The failure count will be reset after the delay defined in the parameter. The delay is expirement in seconds.          </p>          <p class="para">           The default value is <span>86400</span>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_enabled</span></dt>         <dd>          <p class="para">           Set this parameter at <strong><span>true</span></strong> to enable the recovery settings, <strong><span>false</span></strong>            to disable.           </p>          <p class="para">           The default value is <strong><span>false</span></strong>          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_reboot_msg</span></dt>         <dd>          <p class="para">           Set this parameter to define the message saved into the Windows Event            Log before the reboot. Used only if one action is set to            <strong><span>WIN32_SC_ACTION_REBOOT</span></strong>.          </p>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">recovery_command</span></dt>         <dd>          <p class="para">           Set this parameter to define the command executed when one action is defined on             <strong><span>WIN32_SC_ACTION_RUN_COMMAND</span></strong>.          </p>         </dd>               </dl>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">machine</span></dt>     <dd>      <p class="para">       The optional machine name on which you want to create a service.       If omitted, it will use the local machine.      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.win32-create-service-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   没有返回值。  </p>  <p class="para">   Prior to version 1.0.0,  成功时返回 <strong><span>WIN32_NO_ERROR</span></strong>，参数错误时返回 <strong><span>false</span></strong>，或失败时返回一个 <a href="https://www.php.net/manual/zh/win32service.constants.errors.php" class="link">Win32 错误码</a>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-function.win32-create-service-errors">  <h3 class="title">错误／异常</h3>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">service</span> parameter is empty.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">path</span> parameter is missing or empty.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">svc_type</span> parameter is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">start_type</span> parameter is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">error_control</span> parameter is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">base_priority</span> parameter  is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">recovery_delay</span> parameter is not between    0 and PHP_INT_MAX.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">recovery_action_1</span> parameter is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">recovery_action_2</span> parameter is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">recovery_action_3</span> parameter is wrong.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> is thrown if the   value of <span class="parameter" style="color:#3A95FF">recovery_reset_period</span> parameter is not    between 0 and PHP_INT_MAX.  </p>  <p class="para">   A <span class="classname"><a href="https://www.php.net/manual/zh/class.win32serviceexception.php" class="classname">Win32ServiceException</a></span> is thrown on error.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.win32-create-service-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>PECL win32service 1.0.0</td>       <td>        Throws a <span class="classname"><a href="https://www.php.net/manual/zh/class.valueerror.php" class="classname">ValueError</a></span> on invalid data in parameters,        previously <strong><span>false</span></strong> was returned.       </td>      </tr>      <tr>       <td>PECL win32service 1.0.0</td>       <td>        Throws a <span class="classname"><a href="https://www.php.net/manual/zh/class.win32serviceexception.php" class="classname">Win32ServiceException</a></span> on error,        previously a         <a href="https://www.php.net/manual/zh/win32service.constants.errors.php" class="link">Win32 Error Code</a>        was returned.       </td>      </tr>      <tr>       <td>PECL win32service 1.0.0</td>       <td>        The return type is now <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span>, previously it was <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed" class="type mixed" style="color:#EAB766">mixed</a></span>.       </td>      </tr>      <tr>       <td>PECL win32service 0.4.0</td>       <td>        The <span class="parameter" style="color:#3A95FF">dependencies</span>, <span class="parameter" style="color:#3A95FF">recovery_delay</span>,        <span class="parameter" style="color:#3A95FF">recovery_action_1</span>, <span class="parameter" style="color:#3A95FF">recovery_action_2</span>,        <span class="parameter" style="color:#3A95FF">recovery_action_3</span>, <span class="parameter" style="color:#3A95FF">recovery_reset_period</span>,        <span class="parameter" style="color:#3A95FF">recovery_enabled</span>, <span class="parameter" style="color:#3A95FF">recovery_reboot_msg</span>        and <span class="parameter" style="color:#3A95FF">recovery_command</span> parameters have been added.       </td>      </tr>     </tbody>       </table>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.win32-create-service-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 A <span class="function"><strong style="color:#CC7832">win32_create_service()</strong></span> example</strong></p>    <div class="example-contents"><p>     Create a service with the short name &#039;dummyphp&#039;.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$x </span><span style="color: #007700">= </span><span style="color: #9876AA">win32_create_service</span><span style="color: #007700">(array(<br />    </span><span style="color: #DD0000">'service'     </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'dummyphp'</span><span style="color: #007700">,                                           </span><span style="color: #FF8000">// the name of your service<br />    </span><span style="color: #DD0000">'display'     </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sample dummy PHP service'</span><span style="color: #007700">,                           </span><span style="color: #FF8000">// short description<br />    </span><span style="color: #DD0000">'description' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'This is a dummy Windows service created using PHP.'</span><span style="color: #007700">, </span><span style="color: #FF8000">// long description<br />    </span><span style="color: #DD0000">'params'      </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'"' </span><span style="color: #007700">. </span><span style="color: #9876AA">__FILE__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'"  run'</span><span style="color: #007700">,                            </span><span style="color: #FF8000">// path to the script and parameters<br /></span><span style="color: #007700">));<br /></span><span style="color: #9876AA">debug_zval_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$x</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>     </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 A <span class="function"><strong style="color:#CC7832">win32_create_service()</strong></span> example with dependencies</strong></p>    <div class="example-contents"><p>     Create a service with the short name &#039;dummyphp&#039; and dependencies.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$x </span><span style="color: #007700">= </span><span style="color: #9876AA">win32_create_service</span><span style="color: #007700">(array(<br />    </span><span style="color: #DD0000">'service'      </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'dummyphp'</span><span style="color: #007700">,                                           </span><span style="color: #FF8000">// the name of your service<br />    </span><span style="color: #DD0000">'display'      </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sample dummy PHP service'</span><span style="color: #007700">,                           </span><span style="color: #FF8000">// short description<br />    </span><span style="color: #DD0000">'description'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'This is a dummy Windows service created using PHP.'</span><span style="color: #007700">, </span><span style="color: #FF8000">// long description<br />    </span><span style="color: #DD0000">'params'       </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'"' </span><span style="color: #007700">. </span><span style="color: #9876AA">__FILE__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'"  run'</span><span style="color: #007700">,                            </span><span style="color: #FF8000">// path to the script and parameters<br />    </span><span style="color: #DD0000">'dependencies' </span><span style="color: #007700">=&gt; array(</span><span style="color: #DD0000">"Netman"</span><span style="color: #007700">),                                      </span><span style="color: #FF8000">// The list of the dependencies <br /></span><span style="color: #007700">));<br /></span><span style="color: #9876AA">debug_zval_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$x</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>     </div>   </div>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #3 A <span class="function"><strong style="color:#CC7832">win32_create_service()</strong></span> example with recovery</strong></p>    <div class="example-contents"><p>     Create a service with the short name &#039;dummyphp&#039; and recovery settings.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$x </span><span style="color: #007700">= </span><span style="color: #9876AA">win32_create_service</span><span style="color: #007700">(array(<br />    </span><span style="color: #DD0000">'service'               </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'dummyphp'</span><span style="color: #007700">,                                           </span><span style="color: #FF8000">// the name of your service<br />    </span><span style="color: #DD0000">'display'               </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sample dummy PHP service'</span><span style="color: #007700">,                           </span><span style="color: #FF8000">// short description<br />    </span><span style="color: #DD0000">'description'           </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'This is a dummy Windows service created using PHP.'</span><span style="color: #007700">, </span><span style="color: #FF8000">// long description<br />    </span><span style="color: #DD0000">'params'                </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'"' </span><span style="color: #007700">. </span><span style="color: #9876AA">__FILE__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'"  run'</span><span style="color: #007700">,                            </span><span style="color: #FF8000">// path to the script and parameters<br />    </span><span style="color: #DD0000">'recovery_delay'        </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">120000</span><span style="color: #007700">,                                               </span><span style="color: #FF8000">// Recovery action is executed after 2 minutes<br />    </span><span style="color: #DD0000">'recovery_action_1'     </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">WIN32_SC_ACTION_RESTART</span><span style="color: #007700">,                              </span><span style="color: #FF8000">// On first failure, restart the service<br />    </span><span style="color: #DD0000">'recovery_action_2'     </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">WIN32_SC_ACTION_RUN_COMMAND</span><span style="color: #007700">,                          </span><span style="color: #FF8000">// On second failure, execute the commmand<br />    </span><span style="color: #DD0000">'recovery_action_3'     </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">WIN32_SC_ACTION_NONE</span><span style="color: #007700">,                                 </span><span style="color: #FF8000">// On other failure, do nothing<br />    </span><span style="color: #DD0000">'recovery_reset_period' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">86400</span><span style="color: #007700">,                                                </span><span style="color: #FF8000">// Reset the fail counter after 1 day<br />    </span><span style="color: #DD0000">'recovery_enabled'      </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true</span><span style="color: #007700">,                                                 </span><span style="color: #FF8000">// Enable the recovery parameter<br />    </span><span style="color: #DD0000">'recovery_reboot_msg'   </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">null</span><span style="color: #007700">,                                                 </span><span style="color: #FF8000">// Do not define a reboot message, it's not needed here<br />    </span><span style="color: #DD0000">'recovery_command'      </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"c:\clean-service.bat"</span><span style="color: #007700">,                               </span><span style="color: #FF8000">// When the action is WIN32_SC_ACTION_RUN_COMMAND, execute this command<br /></span><span style="color: #007700">));<br /></span><span style="color: #9876AA">debug_zval_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$x</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>     </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.win32-create-service-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link win32_delete_service()} - Deletes a service entry from the SCM database</span></li>    <li class="member"><a href="https://www.php.net/manual/zh/win32service.constants.basepriorities.php" class="link">Win32 Base Priority Classes</a></li>    <li class="member"><a href="https://www.php.net/manual/zh/win32service.constants.recovery-action.php" class="link">Win32 Recovery action</a></li>    <li class="member"><a href="https://www.php.net/manual/zh/win32service.constants.errors.php" class="link">Win32 Error Codes</a></li>   </ul>  </span> </div></div>
<div id="function.ob-start" class="refentry"> <div class="refnamediv">  <h1 class="refname">ob_start</h1>  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">ob_start</span> &mdash; <span class="dc-title">打开输出控制缓冲</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.ob-start-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>ob_start</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.callable.php" class="type callable" style="color:#EAB766">callable</a></span> <span class="parameter" style="color:#3A95FF">$callback</span><span class="initializer"> = <strong><span>null</span></strong></span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$chunk_size</span><span class="initializer"> = 0</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$flags</span><span class="initializer"> = <strong><span>PHP_OUTPUT_HANDLER_STDFLAGS</span></strong></span></span>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">   此函数将打开输出缓冲。当输出缓冲激活后，脚本将不会输出内容（消息头除外），相反需要输出的内容被存储在内部缓冲区中。  </p>  <p class="para">    内部缓冲区的内容可以用 <span class="function">{@link ob_get_contents()}</span>    复制到字符串变量中。想要输出存储在内部缓冲区中的内容，使用 <span class="function">{@link ob_end_flush()}</span>    函数。另外，使用 <span class="function">{@link ob_end_clean()}</span> 函数会静默丢弃掉缓冲区的内容。  </p>  <div class="warning"><strong class="warning">警告</strong>   <p class="para">    当有正在调用的回调函数时，一些 Web 服务器（例如 Apache）会改变脚本的工作目录。可以在回调函数中再把它改回来，例如    <span>chdir(dirname($_SERVER[&#039;SCRIPT_FILENAME&#039;]))</span>。   </p>  </div>  <p class="para">   输出缓冲区是可堆叠的，这就意味着，当有一个 <span class="function"><strong style="color:#CC7832">ob_start()</strong></span> 是活跃的时，可以调用另一个   <span class="function"><strong style="color:#CC7832">ob_start()</strong></span>。只要确保正确调用了 <span class="function">{@link ob_end_flush()}</span>   恰当的次数即可。如果有多重输出回调函数是活跃的，输出内容会一直按嵌套的顺序依次过滤。  </p>  <p class="para">   如果脚本结束时输出缓存仍处于激活状态，PHP 会自动输出内容。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.ob-start-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">callback</span></dt>     <dd>      <p class="para">       可选参数 <span class="parameter" style="color:#3A95FF">callback</span>        函数可以被指定。此函数把一个字符串当作参数并返回一个字符串。当输出缓冲区被（<span class="function">{@link ob_flush()}</span>、<span class="function">{@link ob_clean()}</span>       或者相似的函数）冲刷（送出）或者被清洗的时候；或者在请求结束之际输出缓冲区内容被冲刷到浏览器的时候该函数将会被调用。当调用       <span class="parameter" style="color:#3A95FF">callback</span>       时，它将收到输出缓冲区的内容作为参数并预期返回一个新的输出缓冲区作为结果，这个新返回的输出缓冲区内容将被送到浏览器。如果这个       <span class="parameter" style="color:#3A95FF">callback</span> 不是一个可以调用的函数，此函数会返回 <strong><span>false</span></strong>。以下是回调签名：      </p>      <p class="para">       <div class="methodsynopsis dc-description">        <span class="methodname" style="color:#CC7832"><span class="replaceable">handler</span></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$buffer</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$phase</span><span class="initializer"> = ?</span></span>): <span class="type" style="color:#EAB766">string</span></div>       <dl>                 <dt><span class="parameter" style="color:#3A95FF">buffer</span></dt>         <dd>          <span class="simpara">           输出缓冲区中的内容。          </span>         </dd>                         <dt><span class="parameter" style="color:#3A95FF">phase</span></dt>         <dd>          <span class="simpara">           比特掩码 <a href="https://www.php.net/manual/zh/outcontrol.constants.php" class="link"><strong><span>PHP_OUTPUT_HANDLER_*</span></strong> 常量</a>。          </span>         </dd>               </dl>      </p>      <p class="para">       如果 <span class="parameter" style="color:#3A95FF">callback</span> 返回 <strong><span>false</span></strong> ，其原来的输入内容被直接送到浏览器。      </p>      <p class="para">       这个参数 <span class="parameter" style="color:#3A95FF">callback</span> 可以通过直接给一个 <strong><span>null</span></strong> 值而避开。      </p>      <p class="para">       <span class="function">{@link ob_end_clean()}</span>, <span class="function">{@link ob_end_flush()}</span>,       <span class="function">{@link ob_clean()}</span>, <span class="function">{@link ob_flush()}</span> 和       <span class="function"><strong style="color:#CC7832">ob_start()</strong></span> 不能从一个回调函数中调用。       如果从回调函数中调用了它们，产生的行为是不明确的。       如果想要删除缓冲区的内容，从回调函数中返回一个&quot;&quot; (空字符串)。       更不能从一个回调函数中使用像<span>print_r($expression, true)</span>        或<span>highlight_file($filename, true)</span> 一样的输出缓冲函数。         </p>      <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:        <p class="para">        <span class="function">{@link ob_gzhandler()}</span> 函数的存在有助于将 gz 编码的数据发送到支持压缩网页的 Web        浏览器。<span class="function">{@link ob_gzhandler()}</span> 确定浏览器将接受哪种类型的内容编码并相应的返回输出。       </p>      </p></blockquote>     </dd>                         <dt><span class="parameter" style="color:#3A95FF">chunk_size</span></dt>     <dd>      <p class="para">       如果可选参数 <span class="parameter" style="color:#3A95FF">chunk_size</span> 被赋值了，在任何一个能引起缓冲区的长度等于       或超过 <span class="parameter" style="color:#3A95FF">chunk_size</span> 的输出操作后，缓冲区都会被刷送。       默认值 <span>0</span> 意味着函数仅在最后被调用。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">flags</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">flags</span>       参数代表了一个掩码位，用来控制对缓冲区的操作。默认是允许清理、刷新和移除输出缓冲区，可以通过       <strong><span>PHP_OUTPUT_HANDLER_CLEANABLE</span></strong> |       <strong><span>PHP_OUTPUT_HANDLER_FLUSHABLE</span></strong> |       <strong><span>PHP_OUTPUT_HANDLER_REMOVABLE</span></strong> 显式设置或使用       <strong><span>PHP_OUTPUT_HANDLER_STDFLAGS</span></strong> 作为简写。      </p>      <p class="para">       每个标志都控制着对一组功能的访问，详细介绍如下：       <table class="doctable informaltable">                 <thead>          <tr>           <th>常量</th>           <th>函数</th>          </tr>         </thead>         <tbody class="tbody">          <tr>           <td><strong><span>PHP_OUTPUT_HANDLER_CLEANABLE</span></strong></td>           <td>            <span class="function">{@link ob_clean()}</span>,            <span class="function">{@link ob_end_clean()}</span> 和            <span class="function">{@link ob_get_clean()}</span>。           </td>          </tr>          <tr>           <td><strong><span>PHP_OUTPUT_HANDLER_FLUSHABLE</span></strong></td>           <td>            <span class="function">{@link ob_end_flush()}</span>,            <span class="function">{@link ob_flush()}</span> 和            <span class="function">{@link ob_get_flush()}</span>。           </td>          </tr>          <tr>           <td><strong><span>PHP_OUTPUT_HANDLER_REMOVABLE</span></strong></td>           <td>            <span class="function">{@link ob_end_clean()}</span>,            <span class="function">{@link ob_end_flush()}</span> 和            <span class="function">{@link ob_get_flush()}</span>。           </td>          </tr>         </tbody>               </table>      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.ob-start-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回 <strong><span>true</span></strong>， 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.ob-start-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="example-1625">    <p><strong>示例 #1 用户自定义回调函数的例子</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #007700">function </span><span style="color: #9876AA">callback</span><span style="color: #007700">(</span><span style="color: #9876AA">$buffer</span><span style="color: #007700">)<br />{<br />  </span><span style="color: #FF8000">// replace all the apples with oranges<br />  </span><span style="color: #007700">return (</span><span style="color: #9876AA">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"apples"</span><span style="color: #007700">, </span><span style="color: #DD0000">"oranges"</span><span style="color: #007700">, </span><span style="color: #9876AA">$buffer</span><span style="color: #007700">));<br />}<br /><br /></span><span style="color: #9876AA">ob_start</span><span style="color: #007700">(</span><span style="color: #DD0000">"callback"</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">?&gt;<br /></span>&lt;html&gt;<br />&lt;body&gt;<br />&lt;p&gt;It's like comparing apples to oranges.&lt;/p&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /><span style="color: #9876AA">&lt;?php<br /><br />ob_end_flush</span><span style="color: #007700">();<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>&lt;html&gt;<br>&lt;body&gt;<br>&lt;p&gt;It&#039;s like comparing oranges to oranges.&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></span></div>    </div>   </div>  </span> <p class="para">   <div class="example" id="example-1628">    <p><strong>示例 #2 创建不可擦除的输出缓冲区</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />ob_start</span><span style="color: #007700">(</span><span style="color: #9876AA">null</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">PHP_OUTPUT_HANDLER_STDFLAGS </span><span style="color: #007700">^ </span><span style="color: #9876AA">PHP_OUTPUT_HANDLER_REMOVABLE</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.ob-start-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link ob_get_contents()} - 返回输出缓冲区的内容</span></li>    <li class="member"><span class="function">{@link ob_end_clean()} - 清空（擦除）缓冲区并关闭输出缓冲</span></li>    <li class="member"><span class="function">{@link ob_end_flush()} - 冲刷出（送出）输出缓冲区内容并关闭缓冲区</span></li>    <li class="member"><span class="function">{@link ob_implicit_flush()} - 打开/关闭绝对刷送</span></li>    <li class="member"><span class="function">{@link ob_gzhandler()} - ob_start callback function to gzip output buffer</span></li>    <li class="member"><span class="function">{@link ob_iconv_handler()} - 以输出缓冲处理程序转换字符编码</span></li>    <li class="member"><span class="function">{@link mb_output_handler()} - 在输出缓冲中转换字符编码的回调函数</span></li>    <li class="member"><span class="function">{@link ob_tidyhandler()} - ob_start callback function to repair the buffer</span></li>   </ul>  </span> </div>  </div>
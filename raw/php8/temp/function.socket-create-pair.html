<div id="function.socket-create-pair" class="refentry"> <div class="refnamediv">  <h1 class="refname">socket_create_pair</h1>  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">socket_create_pair</span> &mdash; <span class="dc-title">创建一对彼此连接的套接字，并用数组存储</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.socket-create-pair-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>socket_create_pair</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$domain</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$type</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$protocol</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">&$pair</span></span><br>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">socket_create_pair()</strong></span> 创建两个已连接的，彼此连接的套接字，并存储在 <span class="parameter" style="color:#3A95FF">pair</span>    中。此函数通常在 IPC（进程间通信）使用。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.socket-create-pair-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">domain</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">domain</span> 参数指定套接字使用的协议族。完整列表参见 <span class="function">{@link socket_create()}</span>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">type</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">type</span> 参数选择套接字使用的通信类型。完整列表参见 <span class="function">{@link socket_create()}</span>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">protocol</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">domain</span> 参数指定套接字在 <span class="parameter" style="color:#3A95FF">domain</span>        协议族下通信时使用的具体协议。这个值可以通过 <span class="function">{@link getprotobyname()}</span>        获取。如果所需的协议是 TCP 或 UDP，可以直接使用相应的常量 <strong><span>SOL_TCP</span></strong> 和 <strong><span>SOL_UDP</span></strong>。      </p>      <p class="para">       有关支持协议的完整列表，参见 <span class="function">{@link socket_create()}</span>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">pair</span></dt>     <dd>      <p class="para">       包含两个 <span class="classname"><a href="https://www.php.net/manual/zh/class.socket.php" class="classname">Socket</a></span> 实例的引用数组。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.socket-create-pair-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回 <strong><span>true</span></strong>， 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.socket-create-pair-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>      <td>8.0.0</td>      <td>       <span class="parameter" style="color:#3A95FF">pair</span> 现在是 <span class="classname"><a href="https://www.php.net/manual/zh/class.socket.php" class="classname">Socket</a></span> 实例的引用数组；在这之前是 <span class="type" style="color:#EAB766">resource</span> 的引用数组。      </td>     </tr>    </tbody>     </table> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.socket-create-pair-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">socket_create_pair()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$sockets </span><span style="color: #007700">= array();<br /><br /></span><span style="color: #FF8000">// On Windows we need to use AF_INET <br /></span><span style="color: #9876AA">$domain </span><span style="color: #007700">= (</span><span style="color: #9876AA">strtoupper</span><span style="color: #007700">(</span><span style="color: #9876AA">substr</span><span style="color: #007700">(</span><span style="color: #9876AA">PHP_OS</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">3</span><span style="color: #007700">)) == </span><span style="color: #DD0000">'WIN' </span><span style="color: #007700">? </span><span style="color: #9876AA">AF_INET </span><span style="color: #007700">: </span><span style="color: #9876AA">AF_UNIX</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Setup socket pair <br /></span><span style="color: #007700">if (</span><span style="color: #9876AA">socket_create_pair</span><span style="color: #007700">(</span><span style="color: #9876AA">$domain</span><span style="color: #007700">, </span><span style="color: #9876AA">SOCK_STREAM</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">$sockets</span><span style="color: #007700">) === </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"socket_create_pair failed. Reason: "</span><span style="color: #007700">.</span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">());<br />}<br /></span><span style="color: #FF8000">// Send and Receive Data <br /></span><span style="color: #007700">if (</span><span style="color: #9876AA">socket_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$sockets</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">], </span><span style="color: #DD0000">"ABCdef123\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #DD0000">"ABCdef123\n"</span><span style="color: #007700">)) === </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"socket_write() failed. Reason: "</span><span style="color: #007700">.</span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$sockets</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]));<br />}<br />if ((</span><span style="color: #9876AA">$data </span><span style="color: #007700">= </span><span style="color: #9876AA">socket_read</span><span style="color: #007700">(</span><span style="color: #9876AA">$sockets</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">], </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #DD0000">"ABCdef123\n"</span><span style="color: #007700">), </span><span style="color: #9876AA">PHP_BINARY_READ</span><span style="color: #007700">)) === </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"socket_read() failed. Reason: "</span><span style="color: #007700">.</span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$sockets</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]));<br />}<br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$data</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Close sockets <br /></span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$sockets</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$sockets</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 <span class="function"><strong style="color:#CC7832">socket_create_pair()</strong></span> IPC 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$ary </span><span style="color: #007700">= array();<br /></span><span style="color: #9876AA">$strone </span><span style="color: #007700">= </span><span style="color: #DD0000">'Message From Parent.'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$strtwo </span><span style="color: #007700">= </span><span style="color: #DD0000">'Message From Child.'</span><span style="color: #007700">;<br /><br />if (</span><span style="color: #9876AA">socket_create_pair</span><span style="color: #007700">(</span><span style="color: #9876AA">AF_UNIX</span><span style="color: #007700">, </span><span style="color: #9876AA">SOCK_STREAM</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">$ary</span><span style="color: #007700">) === </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"socket_create_pair() failed. Reason: "</span><span style="color: #007700">.</span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">());<br />}<br /></span><span style="color: #9876AA">$pid </span><span style="color: #007700">= </span><span style="color: #9876AA">pcntl_fork</span><span style="color: #007700">();<br />if (</span><span style="color: #9876AA">$pid </span><span style="color: #007700">== -</span><span style="color: #9876AA">1</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">'Could not fork Process.'</span><span style="color: #007700">;<br />} elseif (</span><span style="color: #9876AA">$pid</span><span style="color: #007700">) {<br />    </span><span style="color: #FF8000">//parent<br />    </span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]);<br />    if (</span><span style="color: #9876AA">socket_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">], </span><span style="color: #9876AA">$strone</span><span style="color: #007700">, </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$strone</span><span style="color: #007700">)) === </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"socket_write() failed. Reason: "</span><span style="color: #007700">.</span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]));<br />    }<br />    if (</span><span style="color: #9876AA">socket_read</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">], </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$strtwo</span><span style="color: #007700">), </span><span style="color: #9876AA">PHP_BINARY_READ</span><span style="color: #007700">) == </span><span style="color: #9876AA">$strtwo</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"Received </span><span style="color: #9876AA">$strtwo</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />    }<br />    </span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]);<br />} else {<br />    </span><span style="color: #FF8000">//child<br />    </span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">]);<br />    if (</span><span style="color: #9876AA">socket_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">], </span><span style="color: #9876AA">$strtwo</span><span style="color: #007700">, </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$strtwo</span><span style="color: #007700">)) === </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"socket_write() failed. Reason: "</span><span style="color: #007700">.</span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]));<br />    }<br />    if (</span><span style="color: #9876AA">socket_read</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">], </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$strone</span><span style="color: #007700">), </span><span style="color: #9876AA">PHP_BINARY_READ</span><span style="color: #007700">) == </span><span style="color: #9876AA">$strone</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"Received </span><span style="color: #9876AA">$strone</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />    }<br />    </span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$ary</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">]);<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.socket-create-pair-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link socket_create()} - 创建一个套接字（通讯节点）</span></li>    <li class="member"><span class="function">{@link socket_create_listen()} - 在端口上打开一个套接字以接受连接</span></li>    <li class="member"><span class="function">{@link socket_bind()} - 给套接字绑定名字</span></li>    <li class="member"><span class="function">{@link socket_listen()} - 监听套接字的连接</span></li>    <li class="member"><span class="function">{@link socket_last_error()} - 返回套接字上的最后一个错误</span></li>    <li class="member"><span class="function">{@link socket_strerror()} - 返回描述套接字错误的字符串</span></li>   </ul>  </span> </div></div>
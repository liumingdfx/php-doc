<div id="function.stream-socket-server" class="refentry"> <div class="refnamediv">  <h1 class="refname">stream_socket_server</h1>  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">stream_socket_server</span> &mdash; <span class="dc-title">创建 Internet 或 Unix 域服务器套接字</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.stream-socket-server-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>stream_socket_server</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$address</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">&$error_code</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">&$error_message</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$flags</span><span class="initializer"> = STREAM_SERVER_BIND | STREAM_SERVER_LISTEN</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$context</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   在指定 <span class="parameter" style="color:#3A95FF">address</span> 上创建 stream 或者数据包套接字（datagram socket）。  </p>  <p class="para">   此函数仅创建套接字，并使用 <span class="function">{@link stream_socket_accept()}</span> 开始接受连接。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.stream-socket-server-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">address</span></dt>     <dd>      <p class="para">       传输器决定创建的套接字类型，其传输器由标准 URL 格式（<span>transport://target</span>）指定。      </p>      <p class="para">       对于 Internet 域套接字（<strong><span>AF_INET</span></strong>），比如 TCP 和 UDP，       <span class="parameter" style="color:#3A95FF">remote_socket</span> 参数的 <span>target</span>       部分应由主机名或者 IP 地址，随后跟着冒号和端口号组成。       对于 Unix 域套接字， <span>target</span> 部分指向文件系统中的套接字文件。      </p>      <p class="para">       环境的不同，可能会导致 Unix 域套接字无法使用。可以使用 <span class="function">{@link stream_get_transports()}</span>       检索可以使用的传输器列表。查看<a href="https://www.php.net/manual/zh/transports.php" class="xref">所支持的套接字传输器列表</a>获取内置传输器列表。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_code</span></dt>     <dd>      <p class="para">       如果指定了可选的 <span class="parameter" style="color:#3A95FF">error_code</span> 和 <span class="parameter" style="color:#3A95FF">error_message</span>       参数，它们将被设置为指出在系统级别进行 <span>socket()</span>、<span>bind()</span>、       <span>listen()</span> 调用时发生的真实系统级别错误。如果 <span class="parameter" style="color:#3A95FF">error_code</span>       返回的值为 <span>0</span> 且函数返回 <strong><span>false</span></strong>，则表明错误发生在 <span>bind()</span>       调用之前。请注意 <span class="parameter" style="color:#3A95FF">error_code</span> 和 <span class="parameter" style="color:#3A95FF">error_message</span>       始终通过引用传递。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_message</span></dt>     <dd>      <p class="para">       参阅 <span class="parameter" style="color:#3A95FF">error_code</span> 描述。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">flags</span></dt>     <dd>      <p class="para">       位掩码字段，可以设置为套接字创建 flag 的任意组合。      </p>      <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:        <p class="para">        对于 UDP 套接字，你必须使用 <strong><span>STREAM_SERVER_BIND</span></strong> 作为        <span class="parameter" style="color:#3A95FF">flags</span> 参数。       </p>      </p></blockquote>     </dd>             <dt><span class="parameter" style="color:#3A95FF">context</span></dt>     <dd>      <p class="para">      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.stream-socket-server-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   返回已创建的 stream，错误时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.stream-socket-server-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>      <td>8.0.0</td>      <td>       <span class="parameter" style="color:#3A95FF">context</span> 现在可为 null。      </td>     </tr>    </tbody>     </table> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.stream-socket-server-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 使用 TCP 服务器套接字</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$socket </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_socket_server</span><span style="color: #007700">(</span><span style="color: #DD0000">"tcp://0.0.0.0:8000"</span><span style="color: #007700">, </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">$errstr</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$socket</span><span style="color: #007700">) {<br />  echo </span><span style="color: #DD0000">"</span><span style="color: #9876AA">$errstr</span><span style="color: #DD0000"> (</span><span style="color: #9876AA">$errno</span><span style="color: #DD0000">)&lt;br /&gt;\n"</span><span style="color: #007700">;<br />} else {<br />  while (</span><span style="color: #9876AA">$conn </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_socket_accept</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">)) {<br />    </span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'The local time is ' </span><span style="color: #007700">. </span><span style="color: #9876AA">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'n/j/Y g:i a'</span><span style="color: #007700">) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">);<br />    </span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$conn</span><span style="color: #007700">);<br />  }<br />  </span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">);<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">   下面的示例展示了如何充当时间服务器，可以响应时间查询，正如 <span class="function">{@link stream_socket_client()}</span> 上的示例。   <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:     <span class="simpara">     大多数系统在低于 1024 的端口号上创建服务器套接字时需要 root 访问权限。    </span>   </p></blockquote>   <div class="example" id="">    <p><strong>示例 #2 使用 UDP 服务器套接字</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$socket </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_socket_server</span><span style="color: #007700">(</span><span style="color: #DD0000">"udp://127.0.0.1:1113"</span><span style="color: #007700">, </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">$errstr</span><span style="color: #007700">, </span><span style="color: #9876AA">STREAM_SERVER_BIND</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$socket</span><span style="color: #007700">) {<br />    die(</span><span style="color: #DD0000">"</span><span style="color: #9876AA">$errstr</span><span style="color: #DD0000"> (</span><span style="color: #9876AA">$errno</span><span style="color: #DD0000">)"</span><span style="color: #007700">);<br />}<br /><br />do {<br />    </span><span style="color: #9876AA">$pkt </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_socket_recvfrom</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">1</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">$peer</span><span style="color: #007700">);<br />    echo </span><span style="color: #DD0000">"</span><span style="color: #9876AA">$peer</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">stream_socket_sendto</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"D M j H:i:s Y\r\n"</span><span style="color: #007700">), </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">$peer</span><span style="color: #007700">);<br />} while (</span><span style="color: #9876AA">$pkt </span><span style="color: #007700">!== </span><span style="color: #9876AA">false</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.stream-socket-server-notes">  <h3 class="title">注释</h3>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>: <span class="simpara">当指定数值型的 IPv6地址（例如 <span>fe80::1</span>）时必须用方括号将 IP 围起来——例如，<span>tcp://[fe80::1]:80</span>。</span></p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.stream-socket-server-seealso">  <h3 class="title">参见</h3>  <ul class="simplelist">   <li class="member"><span class="function">{@link stream_socket_client()} - Open Internet or Unix domain socket connection</span></li>   <li class="member"><span class="function">{@link stream_set_blocking()} - 为资源流设置阻塞或者阻塞模式</span></li>   <li class="member"><span class="function">{@link stream_set_timeout()} - Set timeout period on a stream</span></li>   <li class="member"><span class="function">{@link fgets()} - 从文件指针中读取一行</span></li>   <li class="member"><span class="function">{@link fgetss()} - 从文件指针中读取一行并过滤掉 HTML 标记</span></li>   <li class="member"><span class="function">{@link fwrite()} - 写入文件（可安全用于二进制文件）</span></li>   <li class="member"><span class="function">{@link fclose()} - 关闭一个已打开的文件指针</span></li>   <li class="member"><span class="function">{@link feof()} - 测试文件指针是否到了文件结束的位置</span></li>   <li class="member"><a href="https://www.php.net/manual/zh/ref.curl.php" class="link">Curl 扩展</a></li>  </ul> </div></div>
<div id="eventbufferevent.sslfilter" class="refentry"> <div class="refnamediv">  <h1 class="refname">EventBufferEvent::sslFilter</h1>  <p class="verinfo">(PECL event &gt;= 1.2.6-beta)</p><p class="refpurpose"><span class="refname">EventBufferEvent::sslFilter</span> &mdash; <span class="dc-title">Create a new SSL buffer event to send its data over another buffer event</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-eventbufferevent.sslfilter-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span>   <span class="modifier">static</span>   <span class="methodname" style="color:#CC7832"><strong>EventBufferEvent::sslFilter</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.eventbase.php" class="type EventBase" style="color:#EAB766">EventBase</a></span>     <span class="parameter" style="color:#3A95FF">$base</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.eventbufferevent.php" class="type EventBufferEvent" style="color:#EAB766">EventBufferEvent</a></span>     <span class="parameter" style="color:#3A95FF">$underlying</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.eventsslcontext.php" class="type EventSslContext" style="color:#EAB766">EventSslContext</a></span>     <span class="parameter" style="color:#3A95FF">$ctx</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766">int</span>     <span class="parameter" style="color:#3A95FF">$state</span>   </span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam">    <span class="type" style="color:#EAB766">int</span>     <span class="parameter" style="color:#3A95FF">$options</span>    <span class="initializer"> = 0</span>   </span><br>): <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.eventbufferevent.php" class="type EventBufferEvent" style="color:#EAB766">EventBufferEvent</a></span></div>  <p class="para rdfs-comment">   Create a new SSL buffer event to send its data over another buffer event  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    This function is available only if    <span>Event</span>    is compiled with OpenSSL support.   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-eventbufferevent.sslfilter-parameters">  <h3 class="title">参数</h3>  <dl>       <dt>     <span class="parameter" style="color:#3A95FF">base</span>    </dt>    <dd>     <span>      Associated event base.     </span>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">underlying</span>    </dt>    <dd>     <p class="para">      A socket buffer event to use for this SSL.     </p>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">ctx</span>    </dt>    <dd>     <p class="para">      Object of      <span class="classname"><a href="https://www.php.net/manual/zh/class.eventsslcontext.php" class="classname">EventSslContext</a></span>      class.     </p>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">state</span>    </dt>    <dd>     <p class="para">      The current state of SSL connection:      <strong><span>EventBufferEvent::SSL_OPEN</span></strong>      ,      <strong><span>EventBufferEvent::SSL_ACCEPTING</span></strong>      or      <strong><span>EventBufferEvent::SSL_CONNECTING</span></strong>      .     </p>    </dd>          <dt>     <span class="parameter" style="color:#3A95FF">options</span>    </dt>    <dd>     <p class="para">      One or more buffer event options.     </p>    </dd>     </dl> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-eventbufferevent.sslfilter-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   Returns a new SSL   <span class="classname"><a href="https://www.php.net/manual/zh/class.eventbufferevent.php" class="classname">EventBufferEvent</a></span>   object.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-eventbufferevent.sslfilter-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 Simple SMTP server</strong></p><div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /> </span><span style="color: #FF8000">//<br /> * Author: Andrew Rose &lt;hello at andrewrose dot co dot uk&gt;<br /> *<br /> * Usage:<br /> * 1) Prepare cert.pem certificate and privkey.pem private key files.<br /> * 2) Launch the server script<br /> * 3) Open TLS connection, e.g.:<br /> *      $ openssl s_client -connect localhost:25 -starttls smtp -crlf<br /> * 4) Start testing the commands listed in `cmd` method below.<br /> <br /><br /></span><span style="color: #007700">class </span><span style="color: #9876AA">Handler </span><span style="color: #007700">{<br />    public </span><span style="color: #9876AA">$domainName </span><span style="color: #007700">= </span><span style="color: #9876AA">FALSE</span><span style="color: #007700">;<br />    public </span><span style="color: #9876AA">$connections </span><span style="color: #007700">= [];<br />    public </span><span style="color: #9876AA">$buffers </span><span style="color: #007700">= [];<br />    public </span><span style="color: #9876AA">$maxRead </span><span style="color: #007700">= </span><span style="color: #9876AA">256000</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #9876AA">__construct</span><span style="color: #007700">() {<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ctx </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventSslContext</span><span style="color: #007700">(</span><span style="color: #9876AA">EventSslContext</span><span style="color: #007700">::</span><span style="color: #9876AA">SSLv3_SERVER_METHOD</span><span style="color: #007700">, [<br />            </span><span style="color: #9876AA">EventSslContext</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_LOCAL_CERT  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'cert.pem'</span><span style="color: #007700">,<br />            </span><span style="color: #9876AA">EventSslContext</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_LOCAL_PK    </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'privkey.pem'</span><span style="color: #007700">,<br />            </span><span style="color: #FF8000">//EventSslContext::OPT_PASSPHRASE  =&gt; '',<br />            </span><span style="color: #9876AA">EventSslContext</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_VERIFY_PEER </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">false</span><span style="color: #007700">, </span><span style="color: #FF8000">// change to true with authentic cert<br />            </span><span style="color: #9876AA">EventSslContext</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_ALLOW_SELF_SIGNED </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true </span><span style="color: #FF8000">// change to false with authentic cert<br />        </span><span style="color: #007700">]);<br /><br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventBase</span><span style="color: #007700">();<br />        if (!</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">) {<br />            exit(</span><span style="color: #DD0000">"Couldn't open event base\n"</span><span style="color: #007700">);<br />        }<br /><br />        if (!</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">listener </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventListener</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">,<br />            [</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">'ev_accept'</span><span style="color: #007700">],<br />            </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ctx</span><span style="color: #007700">,<br />            </span><span style="color: #9876AA">EventListener</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_CLOSE_ON_FREE </span><span style="color: #007700">| </span><span style="color: #9876AA">EventListener</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_REUSEABLE</span><span style="color: #007700">,<br />            -</span><span style="color: #9876AA">1</span><span style="color: #007700">,<br />            </span><span style="color: #DD0000">'0.0.0.0:25'</span><span style="color: #007700">))<br />        {<br />            exit(</span><span style="color: #DD0000">"Couldn't create listener\n"</span><span style="color: #007700">);<br />        }<br /><br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">listener</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">setErrorCallback</span><span style="color: #007700">([</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">'ev_error'</span><span style="color: #007700">]);<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">dispatch</span><span style="color: #007700">();<br />    }<br /><br />    public function </span><span style="color: #9876AA">ev_accept</span><span style="color: #007700">(</span><span style="color: #9876AA">$listener</span><span style="color: #007700">, </span><span style="color: #9876AA">$fd</span><span style="color: #007700">, </span><span style="color: #9876AA">$address</span><span style="color: #007700">, </span><span style="color: #9876AA">$ctx</span><span style="color: #007700">) {<br />        static </span><span style="color: #9876AA">$id </span><span style="color: #007700">= </span><span style="color: #9876AA">0</span><span style="color: #007700">;<br />        </span><span style="color: #9876AA">$id </span><span style="color: #007700">+= </span><span style="color: #9876AA">1</span><span style="color: #007700">;<br /><br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">] = </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">] = new </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">, </span><span style="color: #9876AA">$fd</span><span style="color: #007700">,<br />            </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_CLOSE_ON_FREE</span><span style="color: #007700">);<br /><br />        if (!</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]) {<br />            echo </span><span style="color: #DD0000">"Failed creating buffer\n"</span><span style="color: #007700">;<br />            </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">exit</span><span style="color: #007700">(</span><span style="color: #9876AA">NULL</span><span style="color: #007700">);<br />            exit(</span><span style="color: #9876AA">1</span><span style="color: #007700">);<br />        }<br /><br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]-&gt;</span><span style="color: #9876AA">setCallbacks</span><span style="color: #007700">([</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">"ev_read"</span><span style="color: #007700">], </span><span style="color: #9876AA">NULL</span><span style="color: #007700">,<br />            [</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">'ev_error'</span><span style="color: #007700">], </span><span style="color: #9876AA">$id</span><span style="color: #007700">);<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]-&gt;</span><span style="color: #9876AA">enable</span><span style="color: #007700">(</span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">READ </span><span style="color: #007700">| </span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">WRITE</span><span style="color: #007700">);<br /><br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">'220 '</span><span style="color: #007700">.</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">domainName</span><span style="color: #007700">.</span><span style="color: #DD0000">" wazzzap?\r\n"</span><span style="color: #007700">);<br />    }<br /><br />    function </span><span style="color: #9876AA">ev_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$listener</span><span style="color: #007700">, </span><span style="color: #9876AA">$ctx</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$errno </span><span style="color: #007700">= </span><span style="color: #9876AA">EventUtil</span><span style="color: #007700">::</span><span style="color: #9876AA">getLastSocketErrno</span><span style="color: #007700">();<br /><br />        </span><span style="color: #9876AA">fprintf</span><span style="color: #007700">(</span><span style="color: #9876AA">STDERR</span><span style="color: #007700">, </span><span style="color: #DD0000">"Got an error %d (%s) on the listener. Shutting down.\n"</span><span style="color: #007700">,<br />            </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">EventUtil</span><span style="color: #007700">::</span><span style="color: #9876AA">getLastSocketError</span><span style="color: #007700">());<br /><br />        if (</span><span style="color: #9876AA">$errno </span><span style="color: #007700">!= </span><span style="color: #9876AA">0</span><span style="color: #007700">) {<br />            </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">exit</span><span style="color: #007700">(</span><span style="color: #9876AA">NULL</span><span style="color: #007700">);<br />            exit();<br />        }<br />    }<br /><br />    public function </span><span style="color: #9876AA">ev_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]-&gt;</span><span style="color: #9876AA">disable</span><span style="color: #007700">(</span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">READ </span><span style="color: #007700">| </span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">WRITE</span><span style="color: #007700">);<br />        unset(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">]);<br />    }<br /><br />    protected function </span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #9876AA">$string</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">'S('</span><span style="color: #007700">.</span><span style="color: #9876AA">$id</span><span style="color: #007700">.</span><span style="color: #DD0000">'): '</span><span style="color: #007700">.</span><span style="color: #9876AA">$string</span><span style="color: #007700">;<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]-&gt;</span><span style="color: #9876AA">write</span><span style="color: #007700">(</span><span style="color: #9876AA">$string</span><span style="color: #007700">);<br />    }<br /><br />    public function </span><span style="color: #9876AA">ev_read</span><span style="color: #007700">(</span><span style="color: #9876AA">$buffer</span><span style="color: #007700">, </span><span style="color: #9876AA">$id</span><span style="color: #007700">) {<br />        while(</span><span style="color: #9876AA">$buffer</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">input</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">length </span><span style="color: #007700">&gt; </span><span style="color: #9876AA">0</span><span style="color: #007700">) {<br />            </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">] .= </span><span style="color: #9876AA">$buffer</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">input</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">read</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">maxRead</span><span style="color: #007700">);<br />            </span><span style="color: #9876AA">$clientDataLen </span><span style="color: #007700">= </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">]);<br /><br />            if(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">][</span><span style="color: #9876AA">$clientDataLen</span><span style="color: #007700">-</span><span style="color: #9876AA">1</span><span style="color: #007700">] == </span><span style="color: #DD0000">"\n"<br />                </span><span style="color: #007700">&amp;&amp; </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">][</span><span style="color: #9876AA">$clientDataLen</span><span style="color: #007700">-</span><span style="color: #9876AA">2</span><span style="color: #007700">] == </span><span style="color: #DD0000">"\r"</span><span style="color: #007700">)<br />            {<br />                </span><span style="color: #FF8000">// remove the trailing \r\n<br />                </span><span style="color: #9876AA">$line </span><span style="color: #007700">= </span><span style="color: #9876AA">substr</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">], </span><span style="color: #9876AA">0</span><span style="color: #007700">,<br />                    </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">]) - </span><span style="color: #9876AA">2</span><span style="color: #007700">);<br /><br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'clientData'</span><span style="color: #007700">] = </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">cmd</span><span style="color: #007700">(</span><span style="color: #9876AA">$buffer</span><span style="color: #007700">, </span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #9876AA">$line</span><span style="color: #007700">);<br />            }<br />        }<br />    }<br /><br />    protected function </span><span style="color: #9876AA">cmd</span><span style="color: #007700">(</span><span style="color: #9876AA">$buffer</span><span style="color: #007700">, </span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #9876AA">$line</span><span style="color: #007700">) {<br />        switch (</span><span style="color: #9876AA">$line</span><span style="color: #007700">) {<br />            case </span><span style="color: #9876AA">strncmp</span><span style="color: #007700">(</span><span style="color: #DD0000">'EHLO '</span><span style="color: #007700">, </span><span style="color: #9876AA">$line</span><span style="color: #007700">, </span><span style="color: #9876AA">4</span><span style="color: #007700">):<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">"250-STARTTLS\r\n"</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">"250 OK ehlo\r\n"</span><span style="color: #007700">);<br />                break;<br /><br />            case </span><span style="color: #9876AA">strncmp</span><span style="color: #007700">(</span><span style="color: #DD0000">'HELO '</span><span style="color: #007700">, </span><span style="color: #9876AA">$line</span><span style="color: #007700">, </span><span style="color: #9876AA">4</span><span style="color: #007700">):<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">"250-STARTTLS\r\n"</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">"250 OK helo\r\n"</span><span style="color: #007700">);<br />                break;<br /><br />            case </span><span style="color: #9876AA">strncmp</span><span style="color: #007700">(</span><span style="color: #DD0000">'QUIT'</span><span style="color: #007700">, </span><span style="color: #9876AA">$line</span><span style="color: #007700">, </span><span style="color: #9876AA">3</span><span style="color: #007700">):<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">"250 OK quit\r\n"</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">);<br />                break;<br /><br />            case </span><span style="color: #9876AA">strncmp</span><span style="color: #007700">(</span><span style="color: #DD0000">'STARTTLS'</span><span style="color: #007700">, </span><span style="color: #9876AA">$line</span><span style="color: #007700">, </span><span style="color: #9876AA">3</span><span style="color: #007700">):<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">"220 Ready to start TLS\r\n"</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">] = </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">sslFilter</span><span style="color: #007700">(</span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">,<br />                    </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">], </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ctx</span><span style="color: #007700">,<br />                    </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">SSL_ACCEPTING</span><span style="color: #007700">,<br />                    </span><span style="color: #9876AA">EventBufferEvent</span><span style="color: #007700">::</span><span style="color: #9876AA">OPT_CLOSE_ON_FREE</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]-&gt;</span><span style="color: #9876AA">setCallbacks</span><span style="color: #007700">([</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">"ev_read"</span><span style="color: #007700">], </span><span style="color: #9876AA">NULL</span><span style="color: #007700">, [</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">'ev_error'</span><span style="color: #007700">], </span><span style="color: #9876AA">$id</span><span style="color: #007700">);<br />                </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">connections</span><span style="color: #007700">[</span><span style="color: #9876AA">$id</span><span style="color: #007700">][</span><span style="color: #DD0000">'cnx'</span><span style="color: #007700">]-&gt;</span><span style="color: #9876AA">enable</span><span style="color: #007700">(</span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">READ </span><span style="color: #007700">| </span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">WRITE</span><span style="color: #007700">);<br />                break;<br /><br />            default:<br />                echo </span><span style="color: #DD0000">'unknown command: '</span><span style="color: #007700">.</span><span style="color: #9876AA">$line</span><span style="color: #007700">.</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />                break;<br />        }<br />    }<br />}<br /><br />new </span><span style="color: #9876AA">Handler</span><span style="color: #007700">();</span></span></span></div>  </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-eventbufferevent.sslfilter-seealso">  <h3 class="title">参见</h3>  <ul class="simplelist">   <li class="member">    <span class="methodname" style="color:#CC7832">{@link EventBufferEvent::sslSocket()} - Creates a new SSL buffer event to send its data over an SSL on a socket</span>   </li>  </ul> </div></div>
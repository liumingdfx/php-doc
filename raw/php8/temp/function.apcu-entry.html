<div id="function.apcu-entry" class="refentry"> <div class="refnamediv">  <h1 class="refname">apcu_entry</h1>  <p class="verinfo">(PECL apcu &gt;= 5.1.0)</p><p class="refpurpose"><span class="refname">apcu_entry</span> &mdash; <span class="dc-title">   Atomically fetch or generate a cache entry  </span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.apcu-entry-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>apcu_entry</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$key</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.callable.php" class="type callable" style="color:#EAB766">callable</a></span> <span class="parameter" style="color:#3A95FF">$generator</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$ttl</span><span class="initializer"> = 0</span></span>): <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed" class="type mixed" style="color:#EAB766">mixed</a></span></div>  <p class="para rdfs-comment">   Atomically attempts to find <span class="parameter" style="color:#3A95FF">key</span> in the cache, if it cannot be found <span class="parameter" style="color:#3A95FF">generator</span>   is called, passing <span class="parameter" style="color:#3A95FF">key</span> as the only argument. The return value of the call is then cached with the optionally specified   <span class="parameter" style="color:#3A95FF">ttl</span>, and returned.  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <span class="simpara">    When control enters <span class="function"><strong style="color:#CC7832">apcu_entry()</strong></span> the lock for the cache is acquired exclusively, it is released when control leaves <span class="function"><strong style="color:#CC7832">apcu_entry()</strong></span>:     In effect, this turns the body of <span class="parameter" style="color:#3A95FF">generator</span> into a critical section, disallowing two processes from executing the same code paths concurrently.    In addition, it prohibits the concurrent execution of any other APCu functions, since they will acquire the same lock.   </span>  </p></blockquote>  <div class="warning"><strong class="warning">警告</strong>   <p class="simpara">    The only APCu function that can be called safely by <span class="parameter" style="color:#3A95FF">generator</span> is <span class="function"><strong style="color:#CC7832">apcu_entry()</strong></span>.   </p>  </div> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.apcu-entry-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">key</span></dt>     <dd>      <p class="para">       Identity of cache entry      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">generator</span></dt>     <dd>      <p class="para">       A callable that accepts <span class="parameter" style="color:#3A95FF">key</span> as the only argument and returns the value to cache.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">ttl</span></dt>     <dd>      <p class="para">       Time To Live; store <span class="parameter" style="color:#3A95FF">var</span> in the cache for       <span class="parameter" style="color:#3A95FF">ttl</span> seconds. After the       <span class="parameter" style="color:#3A95FF">ttl</span> has passed, the stored variable will be       expunged from the cache (on the next request). If no <span class="parameter" style="color:#3A95FF">ttl</span>       is supplied (or if the <span class="parameter" style="color:#3A95FF">ttl</span> is       <span>0</span>), the value will persist until it is removed from       the cache manually, or otherwise fails to exist in the cache (clear,       restart, etc.).      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.apcu-entry-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   Returns the cached value  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.apcu-entry-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="example-1514">    <p><strong>示例 #1 An <span class="function"><strong style="color:#CC7832">apcu_entry()</strong></span> example</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$config </span><span style="color: #007700">= </span><span style="color: #9876AA">apcu_entry</span><span style="color: #007700">(</span><span style="color: #DD0000">"config"</span><span style="color: #007700">, function(</span><span style="color: #9876AA">$key</span><span style="color: #007700">) {<br /> return [<br />   </span><span style="color: #DD0000">"fruit" </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">apcu_entry</span><span style="color: #007700">(</span><span style="color: #DD0000">"config.fruit"</span><span style="color: #007700">, function(</span><span style="color: #9876AA">$key</span><span style="color: #007700">){<br />     return [<br />       </span><span style="color: #DD0000">"apples"</span><span style="color: #007700">,<br />       </span><span style="color: #DD0000">"pears"<br />     </span><span style="color: #007700">];<br />   }), <br />   </span><span style="color: #DD0000">"people" </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">apcu_entry</span><span style="color: #007700">(</span><span style="color: #DD0000">"config.people"</span><span style="color: #007700">, function(</span><span style="color: #9876AA">$key</span><span style="color: #007700">){<br />     return [<br />      </span><span style="color: #DD0000">"bob"</span><span style="color: #007700">,<br />      </span><span style="color: #DD0000">"joe"</span><span style="color: #007700">,<br />      </span><span style="color: #DD0000">"niki"<br />     </span><span style="color: #007700">];<br />   })<br /> ];<br />});<br /><br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">$config</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>array(2) {<br>  [&quot;fruit&quot;]=&gt;<br>  array(2) {<br>    [0]=&gt;<br>    string(6) &quot;apples&quot;<br>    [1]=&gt;<br>    string(5) &quot;pears&quot;<br>  }<br>  [&quot;people&quot;]=&gt;<br>  array(3) {<br>    [0]=&gt;<br>    string(3) &quot;bob&quot;<br>    [1]=&gt;<br>    string(3) &quot;joe&quot;<br>    [2]=&gt;<br>    string(4) &quot;niki&quot;<br>  }<br>}<br></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.apcu-entry-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link apcu_store()} - 缓存一个变量到存储中</span></li>    <li class="member"><span class="function">{@link apcu_fetch()} - Fetch a stored variable from the cache</span></li>    <li class="member"><span class="function">{@link apcu_delete()} - Removes a stored variable from the cache</span></li>   </ul>  </span> </div></div>
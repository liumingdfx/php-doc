<div id="function.socket-recv" class="refentry"> <div class="refnamediv">  <h1 class="refname">socket_recv</h1>  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">socket_recv</span> &mdash; <span class="dc-title">从已连接的 socket 接收数据</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.socket-recv-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>socket_recv</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.socket.php" class="type Socket" style="color:#EAB766">Socket</a></span> <span class="parameter" style="color:#3A95FF">$socket</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$data</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$length</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$flags</span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">int</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   函数 <span class="function"><strong style="color:#CC7832">socket_recv()</strong></span> 从 <span class="parameter" style="color:#3A95FF">socket</span> 中接收长度为   <span class="parameter" style="color:#3A95FF">length</span> 字节的数据，并保存在 <span class="parameter" style="color:#3A95FF">data</span> 中。   <span class="function"><strong style="color:#CC7832">socket_recv()</strong></span> 用于从已连接的 socket 中接收数据。除此之外，可以设定一个或多个 flags   来控制函数的具体行为。  </p>  <p class="para">   <span class="parameter" style="color:#3A95FF">data</span> 是传引用的，因此必须以变量的形式，指定到参数列表。从   <span class="parameter" style="color:#3A95FF">socket</span> 中接收到的数据将会保存在 <span class="parameter" style="color:#3A95FF">data</span> 中。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.socket-recv-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">socket</span></dt>     <dd>      <p class="para">       参数 <span class="parameter" style="color:#3A95FF">socket</span> 必须是一个由 <span class="function">{@link socket_create()}</span>       创建的 <span class="classname"><a href="https://www.php.net/manual/zh/class.socket.php" class="classname">Socket</a></span> 实例。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">data</span></dt>     <dd>      <p class="para">       从 socket 中获取的数据将被保存在由 <span class="parameter" style="color:#3A95FF">data</span> 指定的变量中。       如果有错误发生，如链接被重置，数据不可用等等， <span class="parameter" style="color:#3A95FF">data</span> 将被设为 <strong><span>null</span></strong>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">length</span></dt>     <dd>      <p class="para">       从远程主机接收长度最多为 <span class="parameter" style="color:#3A95FF">length</span> 字节的数据。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">flags</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">flags</span> 的值可以为下列任意 flag 的组合。使用按位或运算符(<span>|</span>)来       组合不同的 flag。      </p>            <table class="doctable table">       <caption><strong>可用的 <span class="parameter" style="color:#3A95FF">flags</span> 值</strong></caption>               <thead>         <tr>          <th>Flag</th>          <th>描述</th>         </tr>        </thead>        <tbody class="tbody">         <tr>          <td><strong><span>MSG_OOB</span></strong></td>          <td>           处理超出边界的数据          </td>         </tr>         <tr>          <td><strong><span>MSG_PEEK</span></strong></td>          <td>           从接收队列的起始位置接收数据，但不将他们从接收队列中移除。          </td>         </tr>         <tr>          <td><strong><span>MSG_WAITALL</span></strong></td>          <td>           在接收到至少 <span class="parameter" style="color:#3A95FF">length</span> 字节的数据之前，造成一个阻塞，并暂停脚本运行（block）。但是，           如果接收到中断信号，或远程服务器断开连接，该函数将返回少于 <span class="parameter" style="color:#3A95FF">length</span> 字节的数据。          </td>         </tr>         <tr>          <td><strong><span>MSG_DONTWAIT</span></strong></td>          <td>           如果指定了该 flag，函数将不会造成阻塞，即使在全局设置中指定了阻塞设置。          </td>         </tr>        </tbody>             </table>     </dd>           </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.socket-recv-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   <span class="function"><strong style="color:#CC7832">socket_recv()</strong></span> 返回一个数字，表示接收到的字节数。如果发生了错误，则返回 <strong><span>false</span></strong>   错误码可使用 <span class="function">{@link socket_last_error()}</span> 接收。也可使用函数 <span class="function">{@link socket_strerror()}</span>    来取得关于错误的文字描述。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.socket-recv-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>  <td>8.0.0</td>  <td>   现在 <span class="parameter" style="color:#3A95FF">socket</span> 是 <span class="classname"><a href="https://www.php.net/manual/zh/class.socket.php" class="classname">Socket</a></span> 实例，   之前是 <span class="type" style="color:#EAB766">resource</span>。  </td> </tr>    </tbody>     </table> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.socket-recv-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">socket_recv()</strong></span> 范例</strong></p>    <div class="example-contents"><p>     该范例简单地使用 <span class="function"><strong style="color:#CC7832">socket_recv()</strong></span> 重写了 <a href="https://www.php.net/manual/zh/sockets.examples.php" class="xref">示例</a> 中的     第一个例子。    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />error_reporting</span><span style="color: #007700">(</span><span style="color: #9876AA">E_ALL</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #DD0000">"&lt;h2&gt;TCP/IP Connection&lt;/h2&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 获取 WWW 服务的端口。 <br /></span><span style="color: #9876AA">$service_port </span><span style="color: #007700">= </span><span style="color: #9876AA">getservbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www'</span><span style="color: #007700">, </span><span style="color: #DD0000">'tcp'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 获取目标主机的 IP 地址。 <br /></span><span style="color: #9876AA">$address </span><span style="color: #007700">= </span><span style="color: #9876AA">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www.example.com'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 创建 TCP/IP 套接字。 <br /></span><span style="color: #9876AA">$socket </span><span style="color: #007700">= </span><span style="color: #9876AA">socket_create</span><span style="color: #007700">(</span><span style="color: #9876AA">AF_INET</span><span style="color: #007700">, </span><span style="color: #9876AA">SOCK_STREAM</span><span style="color: #007700">, </span><span style="color: #9876AA">SOL_TCP</span><span style="color: #007700">);<br />if (</span><span style="color: #9876AA">$socket </span><span style="color: #007700">=== </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"socket_create() failed: reason: " </span><span style="color: #007700">. </span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">()) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />} else {<br />    echo </span><span style="color: #DD0000">"OK.\n"</span><span style="color: #007700">;<br />}<br /><br />echo </span><span style="color: #DD0000">"Attempting to connect to '</span><span style="color: #9876AA">$address</span><span style="color: #DD0000">' on port '</span><span style="color: #9876AA">$service_port</span><span style="color: #DD0000">'..."</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">socket_connect</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">$address</span><span style="color: #007700">, </span><span style="color: #9876AA">$service_port</span><span style="color: #007700">);<br />if (</span><span style="color: #9876AA">$result </span><span style="color: #007700">=== </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"socket_connect() failed.\nReason: (</span><span style="color: #9876AA">$result</span><span style="color: #DD0000">) " </span><span style="color: #007700">. </span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">)) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />} else {<br />    echo </span><span style="color: #DD0000">"OK.\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #9876AA">$in </span><span style="color: #007700">= </span><span style="color: #DD0000">"HEAD / HTTP/1.1\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$in </span><span style="color: #007700">.= </span><span style="color: #DD0000">"Host: www.example.com\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$in </span><span style="color: #007700">.= </span><span style="color: #DD0000">"Connection: Close\r\n\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$out </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br /><br />echo </span><span style="color: #DD0000">"Sending HTTP HEAD request..."</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">socket_write</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">$in</span><span style="color: #007700">, </span><span style="color: #9876AA">strlen</span><span style="color: #007700">(</span><span style="color: #9876AA">$in</span><span style="color: #007700">));<br />echo </span><span style="color: #DD0000">"OK.\n"</span><span style="color: #007700">;<br /><br />echo </span><span style="color: #DD0000">"Reading response:\n\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$buf </span><span style="color: #007700">= </span><span style="color: #DD0000">'This is my buffer.'</span><span style="color: #007700">;<br />if (</span><span style="color: #9876AA">false </span><span style="color: #007700">!== (</span><span style="color: #9876AA">$bytes </span><span style="color: #007700">= </span><span style="color: #9876AA">socket_recv</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">$buf</span><span style="color: #007700">, </span><span style="color: #9876AA">2048</span><span style="color: #007700">, </span><span style="color: #9876AA">MSG_WAITALL</span><span style="color: #007700">))) {<br />    echo </span><span style="color: #DD0000">"Read </span><span style="color: #9876AA">$bytes</span><span style="color: #DD0000"> bytes from socket_recv(). Closing socket..."</span><span style="color: #007700">;<br />} else {<br />    echo </span><span style="color: #DD0000">"socket_recv() failed; reason: " </span><span style="color: #007700">. </span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">)) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #9876AA">socket_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #9876AA">$buf </span><span style="color: #007700">. </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo </span><span style="color: #DD0000">"OK.\n\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>     上面的示例将产生如下内容：    </p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>&lt;h2&gt;TCP/IP Connection&lt;/h2&gt;<br>OK.<br>Attempting to connect to &#039;208.77.188.166&#039; on port &#039;80&#039;...OK.<br>Sending HTTP HEAD request...OK.<br>Reading response:<br><br>Read 123 bytes from socket_recv(). Closing socket...HTTP/1.1 200 OK<br>Date: Mon, 14 Sep 2009 08:56:36 GMT<br>Server: Apache/2.2.3 (Red Hat)<br>Last-Modified: Tue, 15 Nov 2005 13:24:10 GMT<br>ETag: &quot;b80f4-1b6-80bfd280&quot;<br>Accept-Ranges: bytes<br>Content-Length: 438<br>Connection: close<br>Content-Type: text/html; charset=UTF-8<br><br>OK.<br></span></div>    </div>   </div>  </span> </div>                     </div>
<div id="function.oci-pconnect" class="refentry"> <div class="refnamediv">  <h1 class="refname">oci_pconnect</h1>  <p class="verinfo">(PHP 5, PHP 7, PHP 8, PECL OCI8 &gt;= 1.1.0)</p><p class="refpurpose"><span class="refname">oci_pconnect</span> &mdash; <span class="dc-title">使用持久连接连，连接到 Oracle 数据库</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.oci-pconnect-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>oci_pconnect</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$username</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$password</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$connection_string</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$encoding</span><span class="initializer"> = &quot;&quot;</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$session_mode</span><span class="initializer"> = <strong><span>OCI_DEFAULT</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   创建到 Oracle 服务器的持久连接并登录。  </p>  <p class="para">   持久连接会被缓冲并在请求之间重复使用，可以降低每个页面加载的消耗；一个典型的 PHP 应用程序对于每个 Apache 子进程（或者 PHP FastCGI   进程）会有打开的持久连接到 Oracle 服务器。更多信息见<a href="https://www.php.net/manual/zh/oci8.connection.php" class="link">连接处理和连接池</a>一节。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.oci-pconnect-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">username</span></dt>     <dd>      <p class="para">       Oracle 用户名。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">password</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">username</span> 的密码。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">connection_string</span></dt>     <dd>      <p class="para">包含要连接的<span>Oracle 实例</span>。可以是 <a href="https://www.php.net/manual/zh/https://www.oracle.com/pls/topic/lookup?ctx=dblatest&id=GUID-E5358DEA-D619-4B7B-A799-3D2F802500F1" class="link external">&raquo;&nbsp;Easy Connect 串</a>，或是<var class="filename">tnsnames.ora</var> 文件中的连接名，或是本地 Oracle 实例名。</p><p class="para"> 如果不指定或者为 <strong><span>null</span></strong>，PHP 使用环境变量来确定连接的 <span>Oracle 实例</span>，诸如 <strong><span>TWO_TASK</span></strong>（Linux 下）或  <strong><span>LOCAL</span></strong>（Windows 下）与 <strong><span>ORACLE_SID</span></strong> 等。</p><p class="para"> 要使用 Easy Connect 命名方法，PHP 必须与 Oracle 10<em>g</em> 或更高版本的客户端库进行链接。Oracle 10<em>g</em> 的 Easy Connect 串格式：<em>[//]host_name[:port][/service_name]</em>。Oracle 11<em>g</em> 则为：<em>[//]host_name[:port][/service_name][:server_type][/instance_name]</em>。 在 Oracle 19c 加入类更多选项，例如 timeout 和 keep-alive 设置。 请参考 Oracle 文档。 服务名可在数据库服务器机器上运行 Oracle 实用程序 <span>lsnrctl status</span> 找到。</p><p class="para"> <var class="filename">tnsnames.ora</var> 文件可在 Oracle Net 查找路径中，此路径包括 <var class="filename">/your/path/to/instantclient/network/admin</var>、<var class="filename">$ORACLE_HOME/network/admin</var> 、<var class="filename">/etc</var>。 另一种方法是设置 <span>TNS_ADMIN</span> 以便通过 <var class="filename">$TNS_ADMIN/tnsnames.ora</var> 来读取。表确认 web 守护进程可读取此文件。</p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">encoding</span></dt>     <dd>      <p class="para">使用 Oracle客户端库来确定字符集。字符集不需要与数据库的字符集相匹配。如果不匹配，Oracle会尽可能地将数据从数据库字符集进行转换。因为依赖于字符集，可能不能给出可用的结果。转换也增加一些时间开销。</p><p class="para"> 如果不指定，Oracle 客户端用 <strong><span>NLS_LANG</span></strong> 环境变量来决定字符集。</p><p class="para"> 传递此参数可减少连接时间。</p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">session_mode</span></dt>     <dd>      <p class="para">此参数在 PHP 5（PECL OCI81.1）版本开始可用，并收受下列值：<strong><span>OCI_DEFAULT</span></strong>，<strong><span>OCI_SYSOPER</span></strong>和 <strong><span>OCI_SYSDBA</span></strong>。如为<strong><span>OCI_SYSOPER</span></strong> 或 <strong><span>OCI_SYSDBA</span></strong>其中之一，此函数将会使用外部的证书建立有特权的连接。有特权的连接默认是禁用的。需要将<a href="https://www.php.net/manual/zh/oci8.configuration.php#ini.oci8.privileged-connect" class="link">oci8.privileged_connect</a>设为 <span>On</span> 来启用。</p><p class="para"> PHP 5.3（PECL OCI8 1.3.4）引进了 <strong><span>OCI_CRED_EXT</span></strong> 模式值。使用外部或操作系统认证必需在 Oracle 数据库中进行配置。<strong><span>OCI_CRED_EXT</span></strong> 标志只可用于用户为 &quot;/&quot;，密码为空的情况。<a href="https://www.php.net/manual/zh/oci8.configuration.php#ini.oci8.privileged-connect" class="link">oci8.privileged_connect</a> 可为 <span>On</span> 或 <span>Off</span>。</p><p class="para"> <strong><span>OCI_CRED_EXT</span></strong> 可与 <strong><span>OCI_SYSOPER</span></strong> 或 <strong><span>OCI_SYSDBA</span></strong> 模式组合使用。</p><p class="para"> <strong><span>OCI_CRED_EXT</span></strong> 由于安全的原因不支持 Windows 系统。</p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.oci-pconnect-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   返回连接标识符或错误时为 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.oci-pconnect-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="xmlwriter-write-attribute.example.intermix">    <p><strong>示例 #1 基础 <span class="function"><strong style="color:#CC7832">oci_pconnect()</strong></span> 示例，使用 Easy Connect 语法</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #FF8000">// Connects to the XE service (i.e. database) on the "localhost" machine<br /></span><span style="color: #9876AA">$conn </span><span style="color: #007700">= </span><span style="color: #9876AA">oci_pconnect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #9876AA">$e </span><span style="color: #007700">= </span><span style="color: #9876AA">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #9876AA">trigger_error</span><span style="color: #007700">(</span><span style="color: #9876AA">htmlentities</span><span style="color: #007700">(</span><span style="color: #9876AA">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">], </span><span style="color: #9876AA">ENT_QUOTES</span><span style="color: #007700">), </span><span style="color: #9876AA">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #9876AA">$stid </span><span style="color: #007700">= </span><span style="color: #9876AA">oci_parse</span><span style="color: #007700">(</span><span style="color: #9876AA">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'SELECT * FROM employees'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">oci_execute</span><span style="color: #007700">(</span><span style="color: #9876AA">$stid</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #DD0000">"&lt;table border='1'&gt;\n"</span><span style="color: #007700">;<br />while (</span><span style="color: #9876AA">$row </span><span style="color: #007700">= </span><span style="color: #9876AA">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #9876AA">$stid</span><span style="color: #007700">, </span><span style="color: #9876AA">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #9876AA">OCI_RETURN_NULLS</span><span style="color: #007700">)) {<br />    echo </span><span style="color: #DD0000">"&lt;tr&gt;\n"</span><span style="color: #007700">;<br />    foreach (</span><span style="color: #9876AA">$row </span><span style="color: #007700">as </span><span style="color: #9876AA">$item</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"    &lt;td&gt;" </span><span style="color: #007700">. (</span><span style="color: #9876AA">$item </span><span style="color: #007700">!== </span><span style="color: #9876AA">null </span><span style="color: #007700">? </span><span style="color: #9876AA">htmlentities</span><span style="color: #007700">(</span><span style="color: #9876AA">$item</span><span style="color: #007700">, </span><span style="color: #9876AA">ENT_QUOTES</span><span style="color: #007700">) : </span><span style="color: #DD0000">"&amp;nbsp;"</span><span style="color: #007700">) . </span><span style="color: #DD0000">"&lt;/td&gt;\n"</span><span style="color: #007700">;<br />    }<br />    echo </span><span style="color: #DD0000">"&lt;/tr&gt;\n"</span><span style="color: #007700">;<br />}<br />echo </span><span style="color: #DD0000">"&lt;/table&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">    有关参数使用的更多示例，请参见 <span class="function">{@link oci_connect()}</span>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.oci-pconnect-notes">  <h3 class="title">注释</h3>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <span class="simpara">    每个 PHP 进程的持久 Oracle 连接的生命周期和最大数目可以通过以下配置选项来调整：<a href="https://www.php.net/manual/zh/oci8.configuration.php#ini.oci8.persistent-timeout" class="link">oci8.persistent_timeout</a>，<a href="https://www.php.net/manual/zh/oci8.configuration.php#ini.oci8.ping-interval" class="link">oci8.ping_interval</a>    和 <a href="https://www.php.net/manual/zh/oci8.configuration.php#ini.oci8.max-persistent" class="link">oci8.max_persistent</a>。   </span>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.oci-pconnect-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link oci_connect()} - 建立一个到 Oracle 服务器的连接</span></li>    <li class="member"><span class="function">{@link oci_new_connect()} - 使用唯一连接，连接到 Oracle 服务器</span></li>   </ul>  </span> </div></div>
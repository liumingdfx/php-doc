<div id="function.mcrypt-module-open" class="refentry"> <div class="refnamediv">  <h1 class="refname">mcrypt_module_open</h1>  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5, PHP 7 &lt; 7.2.0, PECL mcrypt &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">mcrypt_module_open</span> &mdash; <span class="dc-title">打开算法和模式对应的模块</span></p> </div> <div id="function.mcrypt-module-open-refsynopsisdiv">  <div class="warning"><strong class="warning">警告</strong><p class="simpara">本函数已自 PHP 7.1.0 起<em>废弃</em>并将自PHP 7.2.0 起<em>移除</em>。强烈建议不要使用本函数。</p></div> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.mcrypt-module-open-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>mcrypt_module_open</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$algorithm</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$algorithm_directory</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$mode</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$mode_directory</span></span><br>): <span class="type" style="color:#EAB766">resource</span></div>  <p class="para rdfs-comment">   本函数打开指定算法和模式对应的模块。   算法名称可以是字符串，例如 <span>&quot;twofish&quot;</span>，   也可以是 <strong><span>MCRYPT_ciphername</span></strong> 常量。   调用 <span class="function">{@link mcrypt_module_close()}</span> 函数可以关闭模块。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.mcrypt-module-open-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">algorithm</span></dt>     <dd>      <p class="para"><strong><span>MCRYPT_ciphername</span></strong> 常量中的一个，或者是字符串值的算法名称。</p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">algorithm_directory</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">algorithm_directory</span> 参数指示加密模块的位置。       如果你提供此参数，则使用你指定的值。       如果将此参数设置为空字符串（<span>&quot;&quot;</span>），将使用       <var class="filename">php.ini</var> 中的 <span>mcrypt.algorithms_dir</span> 。       如果不指定此参数，则使用 libmcrypt 的编译路径       （通常是 <var class="filename">/usr/local/lib/libmcrypt</var>）。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">mode</span></dt>     <dd>      <p class="para"><strong><span>MCRYPT_MODE_modename</span></strong> 常量中的一个，或以下字符串中的一个：&quot;ecb&quot;，&quot;cbc&quot;，&quot;cfb&quot;，&quot;ofb&quot;，&quot;nofb&quot; 和 &quot;stream&quot;。</p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">mode_directory</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">algorithm_directory</span> 参数指示加密模式的位置。       如果你提供此参数，则使用你指定的值。       如果将此参数设置为空字符串（<span>&quot;&quot;</span>），将使用       <var class="filename">php.ini</var> 中的 <span>mcrypt.modes_dir</span> 。       如果不指定此参数，则使用 libmcrypt 的编译路径       （通常是 <var class="filename">/usr/local/lib/libmcrypt</var>）。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.mcrypt-module-open-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功则返回加密描述符，如果发生错误则返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.mcrypt-module-open-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="example-2750">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">mcrypt_module_open()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />    $td </span><span style="color: #007700">= </span><span style="color: #9876AA">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #9876AA">MCRYPT_DES</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">,<br />        </span><span style="color: #9876AA">MCRYPT_MODE_ECB</span><span style="color: #007700">, </span><span style="color: #DD0000">'/usr/lib/mcrypt-modes'</span><span style="color: #007700">);<br /><br />    </span><span style="color: #9876AA">$td </span><span style="color: #007700">= </span><span style="color: #9876AA">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'rijndael-256'</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #DD0000">'ofb'</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">   示例中的第一行从默认目录打开 <span>DES</span> 加密算法，   从 <var class="filename">/usr/lib/mcrypt-modes</var> 目录打开   <span>ECB</span> 模式。   第二个示例中，使用字符串形式表示算法和模式，   这种形式仅适用于 libmcrypt 2.4.x 或 2.5.x 版本。  </p>  <p class="para">   <div class="example" id="example-2753">    <p><strong>示例 #2 在加密中使用 <span class="function"><strong style="color:#CC7832">mcrypt_module_open()</strong></span></strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />    </span><span style="color: #FF8000">// 打开加密算法和模式 <br />    </span><span style="color: #9876AA">$td </span><span style="color: #007700">= </span><span style="color: #9876AA">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'rijndael-256'</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #DD0000">'ofb'</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 创建初始向量，并且检测密钥长度。 <br />     * Windows 平台请使用 MCRYPT_RAND。 <br />    </span><span style="color: #9876AA">$iv </span><span style="color: #007700">= </span><span style="color: #9876AA">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #9876AA">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">), </span><span style="color: #9876AA">MCRYPT_DEV_RANDOM</span><span style="color: #007700">);<br />    </span><span style="color: #9876AA">$ks </span><span style="color: #007700">= </span><span style="color: #9876AA">mcrypt_enc_get_key_size</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 创建密钥 <br />    </span><span style="color: #9876AA">$key </span><span style="color: #007700">= </span><span style="color: #9876AA">substr</span><span style="color: #007700">(</span><span style="color: #9876AA">md5</span><span style="color: #007700">(</span><span style="color: #DD0000">'very secret key'</span><span style="color: #007700">), </span><span style="color: #9876AA">0</span><span style="color: #007700">, </span><span style="color: #9876AA">$ks</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 初始化加密 <br />    </span><span style="color: #9876AA">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">, </span><span style="color: #9876AA">$key</span><span style="color: #007700">, </span><span style="color: #9876AA">$iv</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 加密数据 <br />    </span><span style="color: #9876AA">$encrypted </span><span style="color: #007700">= </span><span style="color: #9876AA">mcrypt_generic</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">, </span><span style="color: #DD0000">'This is very important data'</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 结束加密，执行清理工作 <br />    </span><span style="color: #9876AA">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 初始化解密模块 <br />    </span><span style="color: #9876AA">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">, </span><span style="color: #9876AA">$key</span><span style="color: #007700">, </span><span style="color: #9876AA">$iv</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 解密数据 <br />    </span><span style="color: #9876AA">$decrypted </span><span style="color: #007700">= </span><span style="color: #9876AA">mdecrypt_generic</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">, </span><span style="color: #9876AA">$encrypted</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 结束解密，执行清理工作，并且关闭模块 <br />    </span><span style="color: #9876AA">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">);<br />    </span><span style="color: #9876AA">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #9876AA">$td</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// 显示文本 <br />    </span><span style="color: #007700">echo </span><span style="color: #9876AA">trim</span><span style="color: #007700">(</span><span style="color: #9876AA">$decrypted</span><span style="color: #007700">) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.mcrypt-module-open-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link mcrypt_module_close()} - 关闭加密模块</span></li>    <li class="member"><span class="function">{@link mcrypt_generic()} - 加密数据</span></li>    <li class="member"><span class="function">{@link mdecrypt_generic()} - 解密数据</span></li>    <li class="member"><span class="function">{@link mcrypt_generic_init()} - 初始化加密所需的缓冲区</span></li>    <li class="member"><span class="function">{@link mcrypt_generic_deinit()} - 对加密模块进行清理工作</span></li>   </ul>  </span> </div></div>
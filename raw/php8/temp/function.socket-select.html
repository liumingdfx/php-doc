<div id="function.socket-select" class="refentry"> <div class="refnamediv">  <h1 class="refname">socket_select</h1>  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">socket_select</span> &mdash; <span class="dc-title">从给定套接字数组运行带指定超时时间的 select() 系统调用</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.socket-select-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>socket_select</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$read</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$write</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">&$except</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">int</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$seconds</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$microseconds</span><span class="initializer"> = 0</span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">int</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 接受套接字数组并等待其状态改变。如果拥有 BSD 套接字背景，会认识到这些套接字数组事实上被称为文件描述符集合。观察三个独立套接字数组。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.socket-select-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">read</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">read</span> 数组中列出要检查是否可读的套接字（更准确地说，查看读取是否会阻塞-特别是套接字在 EOF 时也可以是就绪状态，此时 <span class="function">{@link socket_read()}</span>        将会返回长度为 0 的字符串。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">write</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">write</span> 数组中列出要检查的写入是否阻塞的套接字。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">except</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">except</span> 数组中列出要检查的是否异常的套接字。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">seconds</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">seconds</span> 和 <span class="parameter" style="color:#3A95FF">microseconds</span>        构成 <span>timeout</span> 参数。<span>timeout</span>        是 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 返回前的运行时间上限。<span class="parameter" style="color:#3A95FF">seconds</span>        可以是 0，使 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 立即返回。这在轮询时很有用。如果 <span class="parameter" style="color:#3A95FF">seconds</span>        是 <strong><span>null</span></strong>（不会超时），<span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 会无限期阻塞。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">microseconds</span></dt>     <dd>      <p class="para">      </p>     </dd>       </dl>  </span>  <div class="warning"><strong class="warning">警告</strong>   <p class="para">    函数退出时，数组中状态发生变更的套接字将会被修改。   </p>  </div>  <p class="para">   你不需要将每个数组都传递到 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span>    中。可以将它忽略或者使用空数组和 <strong><span>null</span></strong> 代替。不要忘记这些数组是<em>引用</em>传递的，在 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span>    返回时会被修改。  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    由于当前 Zend 引擎的限制，无法使用像 <strong><span>null</span></strong> 这样的常数修饰符直接作为参数传递给期望获取引用参数的方法。而是使用临时变量或表达式：    <div class="example" id="">     <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 使用 <strong><span>null</span></strong> </strong></p>     <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$e </span><span style="color: #007700">= </span><span style="color: #9876AA">NULL</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">socket_select</span><span style="color: #007700">(</span><span style="color: #9876AA">$r</span><span style="color: #007700">, </span><span style="color: #9876AA">$w</span><span style="color: #007700">, </span><span style="color: #9876AA">$e</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>     </div>    </div>   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.socket-select-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span>    返回数组中被修改的套接字个数，如果超时则可能返回 0。失败时时返回 <strong><span>false</span></strong>。可以使用 <span class="function">{@link socket_last_error()}</span>    检索错误码。   </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    确保使用 <span>===</span> 运算符来检查错误。因为 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span>     可能返回 0，使用 <span>==</span> 将被计算为 <strong><span>true</span></strong>：    <div class="example" id="">     <p><strong>示例 #2 理解 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 的返回值</strong></p>     <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$e </span><span style="color: #007700">= </span><span style="color: #9876AA">NULL</span><span style="color: #007700">;<br />if (</span><span style="color: #9876AA">false </span><span style="color: #007700">=== </span><span style="color: #9876AA">socket_select</span><span style="color: #007700">(</span><span style="color: #9876AA">$r</span><span style="color: #007700">, </span><span style="color: #9876AA">$w</span><span style="color: #007700">, </span><span style="color: #9876AA">$e</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">)) {<br />    echo </span><span style="color: #DD0000">"socket_select() failed, reason: " </span><span style="color: #007700">.<br />        </span><span style="color: #9876AA">socket_strerror</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_last_error</span><span style="color: #007700">()) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>     </div>    </div>   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.socket-select-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #3 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// Prepare the read array <br /></span><span style="color: #9876AA">$read   </span><span style="color: #007700">= array(</span><span style="color: #9876AA">$socket1</span><span style="color: #007700">, </span><span style="color: #9876AA">$socket2</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$write  </span><span style="color: #007700">= </span><span style="color: #9876AA">NULL</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$except </span><span style="color: #007700">= </span><span style="color: #9876AA">NULL</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$num_changed_sockets </span><span style="color: #007700">= </span><span style="color: #9876AA">socket_select</span><span style="color: #007700">(</span><span style="color: #9876AA">$read</span><span style="color: #007700">, </span><span style="color: #9876AA">$write</span><span style="color: #007700">, </span><span style="color: #9876AA">$except</span><span style="color: #007700">, </span><span style="color: #9876AA">0</span><span style="color: #007700">);<br /><br />if (</span><span style="color: #9876AA">$num_changed_sockets </span><span style="color: #007700">=== </span><span style="color: #9876AA">false</span><span style="color: #007700">) {<br />    </span><span style="color: #FF8000">// Error handling <br /></span><span style="color: #007700">} else if (</span><span style="color: #9876AA">$num_changed_sockets </span><span style="color: #007700">&gt; </span><span style="color: #9876AA">0</span><span style="color: #007700">) {<br />    </span><span style="color: #FF8000">// At least at one of the sockets something interesting happened <br /></span><span style="color: #007700">}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.socket-select-notes">  <h3 class="title">注释</h3>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    请注意，处理某些实现的套接字时需要特别小心。一些基本规则：    <ul class="itemizedlist">     <li class="listitem">      <span class="simpara">       始终使用不带超时时间的 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span>，如果没有可用数据，程序不会做任何事。依赖超时的代码通常不可移植并且很难调试。      </span>     </li>     <li class="listitem">      <span class="simpara">       不打算在 <span class="function"><strong style="color:#CC7832">socket_select()</strong></span> 调用后检查值的套接字不要添加到集合中。<span class="function"><strong style="color:#CC7832">socket_select()</strong></span>        返回后，必须检查所有数组中的套接字。任何可写套接字需要处理写事件，任何可读套接字需要处理读事件。      </span>     </li>     <li class="listitem">      <span class="simpara">       在处理数组中返回套接字的读或写操作时，可能并不会读取或写入请求的所有数据。需要做好仅仅读取或写入单个字节的准备。      </span>     </li>     <li class="listitem">      <span class="simpara">       在大多数套接字实现中，仅在套接字收到带外数据时，<span class="parameter" style="color:#3A95FF">except</span> 中的套接字可以捕获异常。      </span>     </li>    </ul>   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.socket-select-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link socket_read()} - 从套接字中读取最大长度的数据</span></li>    <li class="member"><span class="function">{@link socket_write()} - 向套接字写数据</span></li>    <li class="member"><span class="function">{@link socket_last_error()} - 返回套接字上的最后一个错误</span></li>    <li class="member"><span class="function">{@link socket_strerror()} - 返回描述套接字错误的字符串</span></li>   </ul>  </span> </div></div>
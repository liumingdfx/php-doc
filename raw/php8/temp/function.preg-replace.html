<div id="function.preg-replace" class="refentry"> <div class="refnamediv">  <h1 class="refname">preg_replace</h1>  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">preg_replace</span> &mdash; <span class="dc-title">执行一个正则表达式的搜索和替换</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.preg-replace-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>preg_replace</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766">array</span></span> <span class="parameter" style="color:#3A95FF">$pattern</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766">array</span></span> <span class="parameter" style="color:#3A95FF">$replacement</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766">array</span></span> <span class="parameter" style="color:#3A95FF">$subject</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$limit</span><span class="initializer"> = -1</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">&$count</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">null</span></span></div>  <p class="para rdfs-comment">    搜索 <span class="parameter" style="color:#3A95FF">subject</span> 中匹配 <span class="parameter" style="color:#3A95FF">pattern</span> 的部分，以    <span class="parameter" style="color:#3A95FF">replacement</span> 进行替换。  </p>  <p class="para">   匹配一个精确的字符串，而不是一个模式，   可以使用 <span class="function">{@link str_replace()}</span> 或   <span class="function">{@link str_ireplace()}</span> 代替这个函数。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.preg-replace-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">pattern</span></dt>     <dd>      <p class="para">      要搜索的模式。可以是一个字符串或字符串数组。      </p>      <p class="para">       可以使用一些 <a href="https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php" class="link">PCRE 修饰符</a>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">replacement</span></dt>     <dd>      <p class="para">        用于替换的字符串或字符串数组。如果这个参数是一个字符串，并且 <span class="parameter" style="color:#3A95FF">pattern</span>        是一个数组，那么所有的模式都使用这个字符串进行替换。如果 <span class="parameter" style="color:#3A95FF">pattern</span> 和 <span class="parameter" style="color:#3A95FF">replacement</span>        都是数组，每个 <span class="parameter" style="color:#3A95FF">pattern</span> 使用 <span class="parameter" style="color:#3A95FF">replacement</span> 中对应的元素进行替换。如果        <span class="parameter" style="color:#3A95FF">replacement</span> 中的元素比 <span class="parameter" style="color:#3A95FF">pattern</span> 中的少，多出来的        <span class="parameter" style="color:#3A95FF">pattern</span> 使用空字符串进行替换。      </p>      <p class="para">        <span class="parameter" style="color:#3A95FF">replacement</span> 中可以包含后向引用 <span>\\<span class="replaceable">n</span></span>        或 <span>$<span class="replaceable">n</span></span>，语法上首选后者。 每个这样的引用将被匹配到的第        <span class="replaceable">n</span> 个捕获子组捕获到的文本替换。 <span class="replaceable">n</span> 可以是0-99，<span>\\0</span> 和 <span>$0</span>        代表完整的模式匹配文本。捕获子组的序号计数方式为：代表捕获子组的左括号从左到右， 从1开始数。如果要在        <span class="parameter" style="color:#3A95FF">replacement</span> 中使用反斜线，必须使用 4 个(<span>&quot;\\\\&quot;</span>，译注：因为这首先是 PHP        的字符串，经过转义后，是两个，再经过正则表达式引擎后才被认为是一个原文反斜线)。      </p>      <p class="para">        当在替换模式下工作并且后向引用后面紧跟着需要是另外一个数字 (比如：在一个匹配模式后紧接着增加一个原文数字)，不能使用        <span>\\1</span> 这样的语法来描述后向引用。比如，<span>\\11</span>将会使<span class="function"><strong style="color:#CC7832">preg_replace()</strong></span>        不能理解你希望的是一个 <span>\\1</span> 后向引用紧跟一个原文 <span>1</span>，还是一个        <span>\\11</span> 后向引用后面不跟任何东西。 这种情况下解决方案是使用 <span>${1}1</span>。这创建了一个独立的        <span>$1</span> 后向引用, 一个独立的原文 <span>1</span>。      </p>      <p class="para">        当使用被弃用的 <span>e</span> 修饰符时, 这个函数会转义一些字符 (即：<span>&#039;</span>、<span>&quot;</span>、        <span>\</span> 和 NULL) 然后进行后向引用替换。当这些完成后请确保后向引用解析完后没有单引号或双引号引起的语法错误 (比如：        <span>&#039;strlen(\&#039;$1\&#039;)+strlen(&quot;$2&quot;)&#039;</span>)。确保符合 PHP 的        <a href="https://www.php.net/manual/zh/language.types.string.php" class="link">字符串语法</a>，并且符合 eval 语法。因为在完成替换后，引擎会将结果字符串作为 PHP 代码使用        eval 方式进行评估并将返回值作为最终参与替换的字符串。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">subject</span></dt>     <dd>      <p class="para">        要进行搜索和替换的字符串或字符串数组。      </p>      <p class="para">        如果 <span class="parameter" style="color:#3A95FF">subject</span> 是一个数组，搜索和替换回在        <span class="parameter" style="color:#3A95FF">subject</span> 的每一个元素上进行, 并且返回值也会是一个数组。      </p>      <p class="para">       如果 <span class="parameter" style="color:#3A95FF">subject</span> 是关联数组，则键会保留在返回值中。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">limit</span></dt>     <dd>      <p class="para">        每个模式在每个 <span class="parameter" style="color:#3A95FF">subject</span> 上进行替换的最大次数。默认是        <span>-1</span>(无限)。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">count</span></dt>     <dd>      <p class="para">        如果指定，将会被填充为完成的替换次数。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.preg-replace-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">    如果 <span class="parameter" style="color:#3A95FF">subject</span> 是一个数组，<span class="function"><strong style="color:#CC7832">preg_replace()</strong></span>    返回一个数组，其他情况下返回一个字符串。  </p>  <p class="para">  如果匹配被查找到，替换后的 <span class="parameter" style="color:#3A95FF">subject</span> 被返回，其他情况下返回没有改变的  <span class="parameter" style="color:#3A95FF">subject</span>。如果发生错误，返回 <strong><span>null</span></strong> 。  </p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-function.preg-replace-errors">  <h3 class="title">错误／异常</h3>  <p class="para">   &quot;\e&quot; 会并忽略，并产生   <strong><span>E_WARNING</span></strong> 错误。  </p>  <p class="para">如果传递的正则表达式无法正常解析，会发出 <strong><span>E_WARNING</span></strong>。 </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.preg-replace-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 使用后向引用紧跟数值原文</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$string </span><span style="color: #007700">= </span><span style="color: #DD0000">'April 15, 2003'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$pattern </span><span style="color: #007700">= </span><span style="color: #DD0000">'/(\w+) (\d+), (\d+)/i'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$replacement </span><span style="color: #007700">= </span><span style="color: #DD0000">'${1}1,$3'</span><span style="color: #007700">;<br />echo </span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(</span><span style="color: #9876AA">$pattern</span><span style="color: #007700">, </span><span style="color: #9876AA">$replacement</span><span style="color: #007700">, </span><span style="color: #9876AA">$string</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>April1,2003<br></span></div>    </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 <span class="function"><strong style="color:#CC7832">preg_replace()</strong></span> 中使用基于索引的数组</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$string </span><span style="color: #007700">= </span><span style="color: #DD0000">'The quick brown fox jumps over the lazy dog.'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$patterns </span><span style="color: #007700">= array();<br /></span><span style="color: #9876AA">$patterns</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">] = </span><span style="color: #DD0000">'/quick/'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$patterns</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">] = </span><span style="color: #DD0000">'/brown/'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$patterns</span><span style="color: #007700">[</span><span style="color: #9876AA">2</span><span style="color: #007700">] = </span><span style="color: #DD0000">'/fox/'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$replacements </span><span style="color: #007700">= array();<br /></span><span style="color: #9876AA">$replacements</span><span style="color: #007700">[</span><span style="color: #9876AA">2</span><span style="color: #007700">] = </span><span style="color: #DD0000">'bear'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$replacements</span><span style="color: #007700">[</span><span style="color: #9876AA">1</span><span style="color: #007700">] = </span><span style="color: #DD0000">'black'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$replacements</span><span style="color: #007700">[</span><span style="color: #9876AA">0</span><span style="color: #007700">] = </span><span style="color: #DD0000">'slow'</span><span style="color: #007700">;<br />echo </span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(</span><span style="color: #9876AA">$patterns</span><span style="color: #007700">, </span><span style="color: #9876AA">$replacements</span><span style="color: #007700">, </span><span style="color: #9876AA">$string</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>The bear black slow jumps over the lazy dog.<br></span></div>    </div>    <div class="example-contents"><p>    对模式和替换内容按 key 进行排序我们可以得到期望的结果。    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />ksort</span><span style="color: #007700">(</span><span style="color: #9876AA">$patterns</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">ksort</span><span style="color: #007700">(</span><span style="color: #9876AA">$replacements</span><span style="color: #007700">);<br />echo </span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(</span><span style="color: #9876AA">$patterns</span><span style="color: #007700">, </span><span style="color: #9876AA">$replacements</span><span style="color: #007700">, </span><span style="color: #9876AA">$string</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>The slow black bear jumps over the lazy dog.<br></span></div>    </div>   </div>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #3 替换一些值</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$patterns </span><span style="color: #007700">= array (</span><span style="color: #DD0000">'/(19|20)(\d{2})-(\d{1,2})-(\d{1,2})/'</span><span style="color: #007700">,<br />                   </span><span style="color: #DD0000">'/^\s*{(\w+)}\s*=/'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$replace </span><span style="color: #007700">= array (</span><span style="color: #DD0000">'\3/\4/\1\2'</span><span style="color: #007700">, </span><span style="color: #DD0000">'$\1 ='</span><span style="color: #007700">);<br />echo </span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(</span><span style="color: #9876AA">$patterns</span><span style="color: #007700">, </span><span style="color: #9876AA">$replace</span><span style="color: #007700">, </span><span style="color: #DD0000">'{startDate} = 1999-5-27'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>$startDate = 5/27/1999<br></span></div>    </div>   </div>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #4 剥离空白字符</strong></p>    <div class="example-contents"><p>     这个例子剥离多余的空白字符    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$str </span><span style="color: #007700">= </span><span style="color: #DD0000">'foo   o'</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$str </span><span style="color: #007700">= </span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'/\s\s+/'</span><span style="color: #007700">, </span><span style="color: #DD0000">' '</span><span style="color: #007700">, </span><span style="color: #9876AA">$str</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// 将会改变为'foo o'<br /></span><span style="color: #007700">echo </span><span style="color: #9876AA">$str</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #5 使用参数 <span class="parameter" style="color:#3A95FF">count</span></strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$count </span><span style="color: #007700">= </span><span style="color: #9876AA">0</span><span style="color: #007700">;<br /><br />echo </span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'/\d/'</span><span style="color: #007700">, </span><span style="color: #DD0000">'/\s/'</span><span style="color: #007700">), </span><span style="color: #DD0000">'*'</span><span style="color: #007700">, </span><span style="color: #DD0000">'xp 4 to'</span><span style="color: #007700">, -</span><span style="color: #9876AA">1 </span><span style="color: #007700">, </span><span style="color: #9876AA">$count</span><span style="color: #007700">);<br />echo </span><span style="color: #9876AA">$count</span><span style="color: #007700">; </span><span style="color: #FF8000">//3<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>xp***to<br>3<br></span></div>         </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.preg-replace-notes">  <h3 class="title">注释</h3>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">   当使用数组形式的<span class="parameter" style="color:#3A95FF">pattern</span>和<span class="parameter" style="color:#3A95FF">replacement</span>时,    将会按照key在数组中出现的顺序进行处理. 这<em>不一定</em>和数组的索引顺序一致.   如果你期望使用索引对等方式用<span class="parameter" style="color:#3A95FF">replacement</span>对<span class="parameter" style="color:#3A95FF">pattern</span>   进行替换, 你可以在调用<span class="function"><strong style="color:#CC7832">preg_replace()</strong></span>之前对两个数组各进行一次<span class="function">{@link ksort()}</span>排序.   </p>  </p></blockquote>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    当 <span class="parameter" style="color:#3A95FF">pattern</span> 和 <span class="parameter" style="color:#3A95FF">replacement</span>    都是数组时，匹配规则将按顺序执行。也就是说第二个 <span class="parameter" style="color:#3A95FF">pattern</span>/<span class="parameter" style="color:#3A95FF">replacement</span>    将作用于第一个 <span class="parameter" style="color:#3A95FF">pattern</span>/<span class="parameter" style="color:#3A95FF">replacement</span>    生成的字符串，而不是原始字符串。    If you want to simulate replacements operating in parallel,    such as swapping two values, replace one pattern by an intermediary placeholder, then in a    later pair replace that intermediary placeholder with the desired replacement.   </p>   <div class="example" id="">    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$p </span><span style="color: #007700">= array(</span><span style="color: #DD0000">'/a/'</span><span style="color: #007700">, </span><span style="color: #DD0000">'/b/'</span><span style="color: #007700">, </span><span style="color: #DD0000">'/c/'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$r </span><span style="color: #007700">= array(</span><span style="color: #DD0000">'b'</span><span style="color: #007700">, </span><span style="color: #DD0000">'c'</span><span style="color: #007700">, </span><span style="color: #DD0000">'d'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">print_r</span><span style="color: #007700">(</span><span style="color: #9876AA">preg_replace</span><span style="color: #007700">(</span><span style="color: #9876AA">$p</span><span style="color: #007700">, </span><span style="color: #9876AA">$r</span><span style="color: #007700">, </span><span style="color: #DD0000">'a'</span><span style="color: #007700">));<br /></span><span style="color: #FF8000">// 打印 d<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.preg-replace-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><a href="https://www.php.net/manual/zh/pcre.pattern.php" class="link">PCRE 模式</a></li>    <li class="member"><span class="function">{@link preg_quote()} - 转义正则表达式字符</span></li>    <li class="member"><span class="function">{@link preg_filter()} - 执行一个正则表达式搜索和替换</span></li>    <li class="member"><span class="function">{@link preg_match()} - 执行匹配正则表达式</span></li>    <li class="member"><span class="function">{@link preg_replace_callback()} - 执行一个正则表达式搜索并且使用一个回调进行替换</span></li>    <li class="member"><span class="function">{@link preg_split()} - 通过一个正则表达式分隔字符串</span></li>    <li class="member"><span class="function">{@link preg_last_error()} - 返回最后一个PCRE正则执行产生的错误代码</span></li>    <li class="member"><span class="function">{@link str_replace()} - 子字符串替换</span></li>   </ul>  </span> </div></div>
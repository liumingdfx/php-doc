<div id="function.setcookie" class="refentry"> <div class="refnamediv">  <h1 class="refname">setcookie</h1>  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">setcookie</span> &mdash; <span class="dc-title">发送 Cookie</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.setcookie-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>setcookie</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$name</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$value</span><span class="initializer"> = &quot;&quot;</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$expires_or_options</span><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$path</span><span class="initializer"> = &quot;&quot;</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$domain</span><span class="initializer"> = &quot;&quot;</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">bool</span> <span class="parameter" style="color:#3A95FF">$secure</span><span class="initializer"> = <strong><span>false</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">bool</span> <span class="parameter" style="color:#3A95FF">$httponly</span><span class="initializer"> = <strong><span>false</span></strong></span></span><br>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">自 PHP 7.3.0 起可用的替代签名（不支持命名参数）：</p>  <div class="methodsynopsis dc-description"><span class="methodname" style="color:#CC7832"><strong>setcookie</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$name</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$value</span><span class="initializer"> = &quot;&quot;</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">$options</span><span class="initializer"> = []</span></span>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 定义了   Cookie，会和剩下的消息头一起发送给客户端。和其他消息头一样，必须在脚本产生任意输出<em>之前</em>发送   Cookie（由于协议的限制）。请在产生任何输出之前（包括 <span>&lt;html&gt;</span> 和 <span>&lt;head&gt;</span> 或者空格）调用本函数。  </p>  <p class="para">   一旦设置 Cookie 后，下次打开页面时可以使用 <var class="varname"><a href="https://www.php.net/manual/zh/reserved.variables.cookies.php" class="classname">$_COOKIE</a></var>   读取。Cookie 值同样也存在于 <var class="varname"><a href="https://www.php.net/manual/zh/reserved.variables.request.php" class="classname">$_REQUEST</a></var>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.setcookie-parameters">  <h3 class="title">参数</h3>  <span>   <a href="http://www.faqs.org/rfcs/rfc6265" class="link external">&raquo;&nbsp;RFC 6265</a> 提供了 <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 每个参数的参考标准。   <dl>         <dt><span class="parameter" style="color:#3A95FF">name</span></dt>     <dd>      <p class="para">       Cookie 名称。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">value</span></dt>     <dd>      <p class="para">       Cookie 值。这个值储存于用户的电脑里，请勿储存敏感信息。比如       <span class="parameter" style="color:#3A95FF">name</span> 是 <span>&#039;cookiename&#039;</span>，可通过       <var class="varname"><a href="https://www.php.net/manual/zh/reserved.variables.cookies.php" class="classname">$_COOKIE['cookiename']</a></var> 获取它的值。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">expires_or_options</span></dt>     <dd>      <p class="para">       Cookie 的过期时间。这是 Unix 时间戳，即纪元以来的秒数。一种设置此值的方式是将       cookie 过期前的秒数与调用 <span class="function">{@link time()}</span>       的结果相加。例如，<span>time()+60*60*24*30</span>       就是设置 Cookie 30 天后过期。还有一种选择就是使用 <span class="function">{@link mktime()}</span>       函数。如果设置为 <span>0</span> 或者忽略，Cookie 会在会话结束时过期（关掉浏览器时）。      </p>      <p class="para">       <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:         <p class="para">         可能会注意到，<span class="parameter" style="color:#3A95FF">expires_or_options</span> 使用 Unix 时间戳而非 <span>Wdy, DD-Mon-YYYY         HH:MM:SS GMT</span> 这样的日期格式，是因为 PHP 内部作了转换。        </p>       </p></blockquote>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">path</span></dt>     <dd>      <p class="para">       Cookie 有效的服务器路径。设置成 <span>&#039;/&#039;</span> 时，Cookie 对整个域名       <span class="parameter" style="color:#3A95FF">domain</span> 有效。如果设置成 <span>&#039;/foo/&#039;</span>，Cookie       仅仅对 <span class="parameter" style="color:#3A95FF">domain</span> 中 <span>/foo/</span>       目录及其子目录有效（比如 <span>/foo/bar/</span>）。默认值是设置 Cookie 时的当前目录。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">domain</span></dt>     <dd>      <p class="para">       Cookie 的有效域名/子域名。设置成子域名（例如 <span>&#039;www.example.com&#039;</span>），会使       Cookie 对这个子域名和它的三级域名有效（例如 w2.www.example.com）。要让 Cookie       对整个域名有效（包括它的全部子域名），只要设置成域名就可以了（这个例子里是 <span>&#039;example.com&#039;</span>）。      </p>      <p class="para">       旧版浏览器仍然在使用废弃的 <a href="http://www.faqs.org/rfcs/rfc2109" class="link external">&raquo;&nbsp;RFC 2109</a>，需要一个前置的点       <span>.</span> 来匹配所有子域名。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">secure</span></dt>     <dd>      <p class="para">       设置这个 Cookie 是否仅仅通过安全的 HTTPS 连接传给客户端。设置成 <strong><span>true</span></strong> 时，只有安全连接存在时才会设置       Cookie。如果是在服务器端处理这个需求，程序员需要仅仅在安全连接上发送此类 Cookie（通过       <var class="varname"><a href="https://www.php.net/manual/zh/reserved.variables.server.php" class="classname">$_SERVER["HTTPS"]</a></var> 判断）。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">httponly</span></dt>     <dd>      <p class="para">       设置成 <strong><span>true</span></strong>，Cookie 仅可通过 HTTP 协议访问。这意思就是 Cookie 无法通过类似 JavaScript       这样的脚本语言访问。要有效减少 XSS 攻击时的身份窃取行为，可建议用此设置（虽然不是所有浏览器都支持），不过这个说法经常有争议。       <strong><span>true</span></strong> 或 <strong><span>false</span></strong>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">options</span></dt>     <dd>      <p class="para">       关联 <span class="type" style="color:#EAB766">array</span>，可能会存在以下键       <span>expires</span>、<span>path</span>、<span>domain</span>、<span>secure</span>、<span>httponly</span> 和       <span>samesite</span>。如果存在其它的键，会生成 <strong><span>E_WARNING</span></strong>       级别的错误。这些值的含义跟同名参数的描述相同。<span>samesite</span> 元素的值应该是       <span>None</span>、<span>Lax</span> 或       <span>Strict</span>。如果没有指定任何允许的选项，它们的默认值与显式参数的默认值相同。如果省略       <span>samesite</span> 元素，则不设置 SameSite cookie 属性。      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.setcookie-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   如果在调用本函数以前就产生了输出，<span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 会失败并返回 <strong><span>false</span></strong>。如果   <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 成功运行，返回 <strong><span>true</span></strong>。当然，它的意思并非用户是否已接受 Cookie。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.setcookie-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>8.2.0</td>       <td>        Cookie 的日期格式现在为 <span>&#039;D, d M Y H:i:s \G\M\T&#039;</span>；        以前是 <span>&#039;D, d-M-Y H:i:s T&#039;</span>。       </td>      </tr>      <tr>       <td>7.3.0</td>       <td>        新增对替代签名 <span class="parameter" style="color:#3A95FF">options</span> 数组的支持。此签名还支持 SameSite cookie 属性的设置。       </td>      </tr>     </tbody>       </table>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.setcookie-examples">  <h3 class="title">示例</h3>  <span>   发送 cookie 的几个例子：   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 发送例子</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$value </span><span style="color: #007700">= </span><span style="color: #DD0000">'something from somewhere'</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">, </span><span style="color: #9876AA">$value</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">, </span><span style="color: #9876AA">$value</span><span style="color: #007700">, </span><span style="color: #9876AA">time</span><span style="color: #007700">()+</span><span style="color: #9876AA">3600</span><span style="color: #007700">);  </span><span style="color: #FF8000">// 1 小时过期  <br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">, </span><span style="color: #9876AA">$value</span><span style="color: #007700">, </span><span style="color: #9876AA">time</span><span style="color: #007700">()+</span><span style="color: #9876AA">3600</span><span style="color: #007700">, </span><span style="color: #DD0000">"/~rasmus/"</span><span style="color: #007700">, </span><span style="color: #DD0000">"example.com"</span><span style="color: #007700">, </span><span style="color: #9876AA">1</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">   注意：在发送 Cookie 时，值的部分会被自动 urlencode 编码。收到 Cookie 时，会自动解码，并赋值到可变的   Cookie 名称上。如果不想被编码，可以使用 <span class="function">{@link setrawcookie()}</span>   代替。在脚本里查看我们的测试 Cookie 的内容，使用下面的一个例子：  </p>  <p class="para">   <div class="informalexample">    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// 打印一个单独的 Cookie<br /></span><span style="color: #007700">echo </span><span style="color: #9876AA">$_COOKIE</span><span style="color: #007700">[</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">//  debug/test 查看所有 Cookie 的另一种方式<br /></span><span style="color: #9876AA">print_r</span><span style="color: #007700">(</span><span style="color: #9876AA">$_COOKIE</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 删除例子</strong></p>    <div class="example-contents"><p>     要删除一个 Cookie，应该设置过期时间为过去，以触发浏览器的删除机制。下面的例子展示了如何删除上个例子里的 Cookie：    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// 设置过期时间为一个小时前<br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">, </span><span style="color: #DD0000">""</span><span style="color: #007700">, </span><span style="color: #9876AA">time</span><span style="color: #007700">() - </span><span style="color: #9876AA">3600</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">, </span><span style="color: #DD0000">""</span><span style="color: #007700">, </span><span style="color: #9876AA">time</span><span style="color: #007700">() - </span><span style="color: #9876AA">3600</span><span style="color: #007700">, </span><span style="color: #DD0000">"/~rasmus/"</span><span style="color: #007700">, </span><span style="color: #DD0000">"example.com"</span><span style="color: #007700">, </span><span style="color: #9876AA">1</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p>  <p class="para">   <div class="example" id="">    <p><strong>示例 #3 <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 和数组</strong></p>    <div class="example-contents"><p>     通过带 array 标记的 Cookie 名称，也可以把 Cookie 设置成数组。如果有数组元素，可以把它放进 Cookie     里；脚本接收到时，Cookie 名称里的值会是一个数组：    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">// 设置 Cookie<br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"cookie[three]"</span><span style="color: #007700">, </span><span style="color: #DD0000">"cookiethree"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"cookie[two]"</span><span style="color: #007700">, </span><span style="color: #DD0000">"cookietwo"</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"cookie[one]"</span><span style="color: #007700">, </span><span style="color: #DD0000">"cookieone"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 网页刷新后，打印出以下内容<br /></span><span style="color: #007700">if (isset(</span><span style="color: #9876AA">$_COOKIE</span><span style="color: #007700">[</span><span style="color: #DD0000">'cookie'</span><span style="color: #007700">])) {<br />    foreach (</span><span style="color: #9876AA">$_COOKIE</span><span style="color: #007700">[</span><span style="color: #DD0000">'cookie'</span><span style="color: #007700">] as </span><span style="color: #9876AA">$name </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">$value</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$name </span><span style="color: #007700">= </span><span style="color: #9876AA">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #9876AA">$name</span><span style="color: #007700">);<br />        </span><span style="color: #9876AA">$value </span><span style="color: #007700">= </span><span style="color: #9876AA">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #9876AA">$value</span><span style="color: #007700">);<br />        echo </span><span style="color: #DD0000">"</span><span style="color: #9876AA">$name</span><span style="color: #DD0000"> : </span><span style="color: #9876AA">$value</span><span style="color: #DD0000"> &lt;br /&gt;\n"</span><span style="color: #007700">;<br />    }<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例会输出：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>three : cookiethree<br>two : cookietwo<br>one : cookieone<br></span></div>    </div>   </div>   <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:     <span class="simpara">     使用 <span>[</span> 和 <span>]</span> 分隔符作为 cookie 名称的一部分不符合     RFC 6265 第 4 节。但根据 RFC 6265 第 5 节应该由 user agent 支持。    </span>   </p></blockquote>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.setcookie-notes">  <h3 class="title">注释</h3>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    要在调用本函数前输出内容，可以使用输出缓冲，让输出的内容在服务器里缓冲起来，直至真正发送给浏览器。可在脚本里调用    <span class="function">{@link ob_start()}</span> 和 <span class="function">{@link ob_end_flush()}</span>，或设置    <span>output_buffering</span> <var class="filename">php.ini</var> 或服务器配置文件里的配置指令。   </p>  </p></blockquote>  <p class="para">   注意避坑：   <ul class="itemizedlist">    <li class="listitem">     <span class="simpara">      在页面（Cookie 可见的页面）下次刷新前，Cookie 不会生效。      测试 Cookie 是否已经成功设置，需要在下次页面加载时、Cookie 过期前检测。      过期时间是通过 <span class="parameter" style="color:#3A95FF">expires_or_options</span> 参数设置的。      直接调用 <span>print_r($_COOKIE);</span> 调试检测 Cookie 是个很好的方式。     </span>    </li>    <li class="listitem">     <span class="simpara">      为同一个参数再次设置 Cookie 前，必须先把它删掉。      如果参数的值是空 string，并且其他参数和上次调用 setcookie 仍旧一样，      则指定的名称会被远程客户端删除。      内部的实现是：将值设置成 <span>&#039;deleted&#039;</span>，且过去的过期时间。     </span>    </li>    <li class="listitem">     <span class="simpara">      因为设置值成 <strong><span>false</span></strong> 会导致 Cookie 被删除，所以要避免使用布尔值。      代替方式：<em>0</em> 是 <strong><span>false</span></strong>，<em>1</em> 是 <strong><span>true</span></strong>。     </span>    </li>    <li class="listitem">     <span class="simpara">      Cookie 名称可以设置成数组名称，PHP 脚本里会是数组，      但用户系统里储存的是单独分开的 Cookie。       可以考虑使用 <span class="function">{@link explode()}</span> 为一个 Cookie 设置多个名称和值。      不建议将 <span class="function">{@link serialize()}</span> 用于此处，因为它会导致安全漏洞。     </span>    </li>   </ul>  </p>  <p class="simpara">   多次调用 <span class="function"><strong style="color:#CC7832">setcookie()</strong></span> 会按调用顺序执行。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.setcookie-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link header()} - 发送原生 HTTP 头</span></li>    <li class="member"><span class="function">{@link setrawcookie()} - 发送未经 URL 编码的 cookie</span></li>    <li class="member"><a href="https://www.php.net/manual/zh/features.cookies.php" class="link">Cookie 章节</a></li>    <li class="member"><a href="http://www.faqs.org/rfcs/rfc6265" class="link external">&raquo;&nbsp;RFC 6265</a></li>    <li class="member"><a href="http://www.faqs.org/rfcs/rfc2109" class="link external">&raquo;&nbsp;RFC 2109</a></li>   </ul>  </span> </div></div>
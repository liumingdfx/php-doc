<div id="gearmanclient.dostatus" class="refentry"> <div class="refnamediv">  <h1 class="refname">GearmanClient::doStatus</h1>  <p class="verinfo">(PECL gearman &gt;= 0.5.0)</p><p class="refpurpose"><span class="refname">GearmanClient::doStatus</span> &mdash; <span class="dc-title">Get the status for the running task</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-gearmanclient.dostatus-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>GearmanClient::doStatus</strong></span>(): <span class="type" style="color:#EAB766">array</span></div>  <p class="para rdfs-comment">   Returns the status for the running task.  This should be used between repeated   <span class="methodname" style="color:#CC7832">{@link GearmanClient::doNormal()}</span> calls.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-gearmanclient.dostatus-parameters">  <h3 class="title">参数</h3>  <span>此函数没有参数。</span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-gearmanclient.dostatus-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   An array representing the percentage completion given as a fraction, with the   first element the numerator and the second element the denomintor.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-gearmanclient.dostatus-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 Get the status of a long running job</strong></p>    <div class="example-contents"><p>     The worker in this example has an artificial delay added during processing of the     string to be reversed.  After each delay it calls <span class="methodname" style="color:#CC7832">{@link GearmanJob::status()}</span>     which the client then picks up.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">"Starting\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Create our client object.<br /></span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">= new </span><span style="color: #9876AA">GearmanClient</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Add default server (localhost).<br /></span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">addServer</span><span style="color: #007700">();<br /><br />echo </span><span style="color: #DD0000">"Sending job\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Send reverse job<br /></span><span style="color: #007700">do<br />{<br />  </span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">doNormal</span><span style="color: #007700">(</span><span style="color: #DD0000">"reverse"</span><span style="color: #007700">, </span><span style="color: #DD0000">"Hello!"</span><span style="color: #007700">);<br /><br />  </span><span style="color: #FF8000"># Check for various return packets and errors.<br />  </span><span style="color: #007700">switch(</span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">())<br />  {<br />    case </span><span style="color: #9876AA">GEARMAN_WORK_DATA</span><span style="color: #007700">:<br />      break;<br />    case </span><span style="color: #9876AA">GEARMAN_WORK_STATUS</span><span style="color: #007700">:<br />      </span><span style="color: #FF8000"># get the current job status<br />      </span><span style="color: #007700">list(</span><span style="color: #9876AA">$numerator</span><span style="color: #007700">, </span><span style="color: #9876AA">$denominator</span><span style="color: #007700">)= </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">doStatus</span><span style="color: #007700">();<br />      echo </span><span style="color: #DD0000">"Status: </span><span style="color: #9876AA">$numerator</span><span style="color: #DD0000">/</span><span style="color: #9876AA">$denominator</span><span style="color: #DD0000"> complete\n"</span><span style="color: #007700">;<br />      break;<br />    case </span><span style="color: #9876AA">GEARMAN_WORK_FAIL</span><span style="color: #007700">:<br />      echo </span><span style="color: #DD0000">"Failed\n"</span><span style="color: #007700">;<br />      exit;<br />    case </span><span style="color: #9876AA">GEARMAN_SUCCESS</span><span style="color: #007700">:<br />      break;<br />    default:<br />      echo </span><span style="color: #DD0000">"RET: " </span><span style="color: #007700">. </span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />      exit;<br />  }<br />}<br />while(</span><span style="color: #9876AA">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">returnCode</span><span style="color: #007700">() != </span><span style="color: #9876AA">GEARMAN_SUCCESS</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #DD0000">"Success: </span><span style="color: #9876AA">$result</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>以上示例的输出类似于：</p></div>    <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>Starting<br>Sending job<br>Status: 1/6 complete<br>Status: 2/6 complete<br>Status: 3/6 complete<br>Status: 4/6 complete<br>Status: 5/6 complete<br>Status: 6/6 complete<br>Success: !olleH<br></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-gearmanclient.dostatus-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanClient::doNormal()} - Run a single task and return a result</span></li>    <li class="member"><span class="methodname" style="color:#CC7832">{@link GearmanJob::status()} - Send status (deprecated)</span></li>   </ul>  </span> </div></div>
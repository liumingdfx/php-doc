<div id="function.fsockopen" class="refentry"> <div class="refnamediv">  <h1 class="refname">fsockopen</h1>  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">fsockopen</span> &mdash; <span class="dc-title">打开 Internet 或者 Unix 套接字连接</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.fsockopen-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>fsockopen</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$hostname</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$port</span><span class="initializer"> = -1</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">&$error_code</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">&$error_message</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">float</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$timeout</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   初始化套接字连接到指定 <span class="parameter" style="color:#3A95FF">hostname</span> 资源。  </p>  <p class="para">   如<a href="https://www.php.net/manual/zh/transports.php" class="xref">所支持的套接字传输器列表</a>所述，PHP 支持 Internet 和 Unix 域中的目标。也可以通过   <span class="function">{@link stream_get_transports()}</span> 获取支持的传输器列表。  </p>  <p class="para">   默认情况下将以阻塞模式开启套接字连接。可以通过 <span class="function">{@link stream_set_blocking()}</span> 将它转换到非阻塞模式。  </p>  <p class="para">   <span class="function">{@link stream_socket_client()}</span> 与之非常相似，而且提供了更加丰富的参数设置，包括非阻塞连接和提供流上下文的能力。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.fsockopen-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">hostname</span></dt>     <dd>      <p class="para">       如果安装了 <a href="https://www.php.net/manual/zh/openssl.installation.php" class="link">OpenSSL</a>，那么可以在主机名地址前面添加 <span>ssl://</span>       或者是 <span>tls://</span>，从而可以使用基于 TCP/IP 协议的 SSL 或者 TLS 的客户端连接到远程主机。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">port</span></dt>     <dd>      <p class="para">       端口号。可以省略该参数或传 -1，则表示传输器不使用端口，例如 <span>unix://</span>。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_code</span></dt>     <dd>      <p class="para">       如果提供该参数，则会保存调用系统级别 <span>connect()</span> 发生的系统级错误号。      </p>      <p class="para">       如果 <span class="parameter" style="color:#3A95FF">error_code</span> 的返回值为 <span>0</span>，且函数的返回值为       <strong><span>false</span></strong>，则表明错误发生在 <span>connect()</span>       调用之前。这很可能是由于初始化套接字的问题。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_message</span></dt>     <dd>      <p class="para">       错误信息将以字符串的信息返回。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">timeout</span></dt>     <dd>      <p class="para">       设置连接的时限，单位为秒。当为 <strong><span>null</span></strong> 时，使用 <a href="https://www.php.net/manual/zh/filesystem.configuration.php#ini.default-socket-timeout" class="link">default_socket_timeout</a> <var class="filename">php.ini</var> 设置。      </p>      <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:        <p class="para">        如果需要对为套接字读/写数据数据操作设置超时，请使用        <span class="function">{@link stream_set_timeout()}</span>，<span class="function"><strong style="color:#CC7832">fsockopen()</strong></span> 的        <span class="parameter" style="color:#3A95FF">timeout</span> 参数仅仅在连接套接字时适用。       </p>      </p></blockquote>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.fsockopen-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   <span class="function"><strong style="color:#CC7832">fsockopen()</strong></span> 返回文件指针，可以跟其他文件函数（比如   <span class="function">{@link fgets()}</span>、<span class="function">{@link fgetss()}</span>、<span class="function">{@link fwrite()}</span>、<span class="function">{@link fclose()}</span>   和 <span class="function">{@link feof()}</span>）一起使用。如果调用失败，将返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-function.fsockopen-errors">  <h3 class="title">错误／异常</h3>  <p class="para">   如果 <span class="parameter" style="color:#3A95FF">hostname</span> 不是有效域，则抛出 <strong><span>E_WARNING</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.fsockopen-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>      <td>8.0.0</td>      <td>       <span class="parameter" style="color:#3A95FF">timeout</span> 现在可以为 null。      </td>     </tr>    </tbody>     </table> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.fsockopen-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">fsockopen()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"www.example.com"</span><span style="color: #007700">, </span><span style="color: #9876AA">80</span><span style="color: #007700">, </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">$errstr</span><span style="color: #007700">, </span><span style="color: #9876AA">30</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$fp</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"</span><span style="color: #9876AA">$errstr</span><span style="color: #DD0000"> (</span><span style="color: #9876AA">$errno</span><span style="color: #DD0000">)&lt;br /&gt;\n"</span><span style="color: #007700">;<br />} else {<br />    </span><span style="color: #9876AA">$out </span><span style="color: #007700">= </span><span style="color: #DD0000">"GET / HTTP/1.1\r\n"</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">$out </span><span style="color: #007700">.= </span><span style="color: #DD0000">"Host: www.example.com\r\n"</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">$out </span><span style="color: #007700">.= </span><span style="color: #DD0000">"Connection: Close\r\n\r\n"</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #9876AA">$out</span><span style="color: #007700">);<br />    while (!</span><span style="color: #9876AA">feof</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">)) {<br />        echo </span><span style="color: #9876AA">fgets</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #9876AA">128</span><span style="color: #007700">);<br />    }<br />    </span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span>  <p class="para">   <div class="example" id="">    <p><strong>示例 #2 使用 UDP 连接</strong></p>    <div class="example-contents"><p>     下面这个例子展示了怎么样在自己的机器上通过 UDP 服务“daytime”（端口号 13）中来检索日期和时间。    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"udp://127.0.0.1"</span><span style="color: #007700">, </span><span style="color: #9876AA">13</span><span style="color: #007700">, </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">$errstr</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$fp</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"ERROR: </span><span style="color: #9876AA">$errno</span><span style="color: #DD0000"> - </span><span style="color: #9876AA">$errstr</span><span style="color: #DD0000">&lt;br /&gt;\n"</span><span style="color: #007700">;<br />} else {<br />    </span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">);<br />    echo </span><span style="color: #9876AA">fread</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #9876AA">26</span><span style="color: #007700">);<br />    </span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.fsockopen-notes">  <h3 class="title">注释</h3>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    根据环境的不同，Unix 域或可选的连接超时可能无效。   </p>  </p></blockquote>  <div class="warning"><strong class="warning">警告</strong>   <p class="para">    即使远程主机无法访问，UDP    套接字有时候也能打开且无错误。只有当从套接字读/写数据的时候才会出现错误。这样的原因是    UDP 是“无连接”协议，这意味着在真正发送/接收数据之前，操作系统不会尝试为套接字创建连接。   </p>  </div>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>: <span class="simpara">当指定数值型的 IPv6地址（例如 <span>fe80::1</span>）时必须用方括号将 IP 围起来——例如，<span>tcp://[fe80::1]:80</span>。</span></p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.fsockopen-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link pfsockopen()} - 打开持久的 Internet 或 Unix 套接字连接</span></li>    <li class="member"><span class="function">{@link stream_socket_client()} - Open Internet or Unix domain socket connection</span></li>    <li class="member"><span class="function">{@link stream_set_blocking()} - 为资源流设置阻塞或者阻塞模式</span></li>    <li class="member"><span class="function">{@link stream_set_timeout()} - Set timeout period on a stream</span></li>    <li class="member"><span class="function">{@link fgets()} - 从文件指针中读取一行</span></li>    <li class="member"><span class="function">{@link fgetss()} - 从文件指针中读取一行并过滤掉 HTML 标记</span></li>    <li class="member"><span class="function">{@link fwrite()} - 写入文件（可安全用于二进制文件）</span></li>    <li class="member"><span class="function">{@link fclose()} - 关闭一个已打开的文件指针</span></li>    <li class="member"><span class="function">{@link feof()} - 测试文件指针是否到了文件结束的位置</span></li>    <li class="member"><span class="function">{@link socket_connect()} - 开启一个套接字连接</span></li>    <li class="member"><a href="https://www.php.net/manual/zh/ref.curl.php" class="link">Curl 扩展</a></li>   </ul>  </span> </div></div>
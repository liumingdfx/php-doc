<div id="event.constructing.signal.events" class="chapter"> <h1>Constructing signal events</h1> <p class="para">  Event can also watch for POSIX-style signals. To construct a handler for a  signal, use  <span class="methodname" style="color:#CC7832">{@link Event::__construct()}</span>  constructor with  <strong><span>Event::SIGNAL</span></strong>  flag, or  <span class="methodname" style="color:#CC7832">{@link Event::signal()}</span>  factory method. </p> <div class="example" id="">  <p><strong>示例 #1 Handling <span>SIGTERM</span> signal</strong></p>  <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /></span><span style="color: #FF8000">//<br />Launch it in a terminal window:<br /><br />$ php examples/signal.php<br /><br />In another terminal window find out the pid and send SIGTERM, e.g.:<br /><br />$ ps aux | grep examp<br />ruslan    3976  0.2  0.0 139896 11256 pts/1    S+   10:25   0:00 php examples/signal.php<br />ruslan    3978  0.0  0.0   9572   864 pts/2    S+   10:26   0:00 grep --color=auto examp<br />$ kill -TERM 3976<br /><br />At the first terminal window you should catch the following:<br /><br />Caught signal 15<br /><br /></span><span style="color: #007700">class </span><span style="color: #9876AA">MyEventSignal </span><span style="color: #007700">{<br />    private </span><span style="color: #9876AA">$base</span><span style="color: #007700">, </span><span style="color: #9876AA">$ev</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #9876AA">__construct</span><span style="color: #007700">(</span><span style="color: #9876AA">$base</span><span style="color: #007700">) {<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base </span><span style="color: #007700">= </span><span style="color: #9876AA">$base</span><span style="color: #007700">;<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev </span><span style="color: #007700">= </span><span style="color: #9876AA">Event</span><span style="color: #007700">::</span><span style="color: #9876AA">signal</span><span style="color: #007700">(</span><span style="color: #9876AA">$base</span><span style="color: #007700">, </span><span style="color: #9876AA">SIGTERM</span><span style="color: #007700">, array(</span><span style="color: #9876AA">$this</span><span style="color: #007700">, </span><span style="color: #DD0000">'eventSighandler'</span><span style="color: #007700">));<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">ev</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">add</span><span style="color: #007700">();<br />    }<br /><br />    public function </span><span style="color: #9876AA">eventSighandler</span><span style="color: #007700">(</span><span style="color: #9876AA">$no</span><span style="color: #007700">, </span><span style="color: #9876AA">$c</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">"Caught signal </span><span style="color: #9876AA">$no</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />        </span><span style="color: #9876AA">$this</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">exit</span><span style="color: #007700">();<br />    }<br />}<br /><br /></span><span style="color: #9876AA">$base </span><span style="color: #007700">= new </span><span style="color: #9876AA">EventBase</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">$c    </span><span style="color: #007700">= new </span><span style="color: #9876AA">MyEventSignal</span><span style="color: #007700">(</span><span style="color: #9876AA">$base</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$base</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">loop</span><span style="color: #007700">();<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>  </div> </div> <p class="para">  Note that signal callbacks are run in the event loop after the signal  occurs, so it is safe for them to call functions that you are not supposed  to call from a regular POSIX signal handler. </p> <p class="para"/> <p class="para">  See also  <a href="http://www.wangafu.net/~nickm/libevent-book/Ref4_event.html#_constructing_signal_events" class="link external">&raquo;&nbsp;Fast portable non-blocking network programming with Libevent, Constructing Signal Events</a>  . </p></div>
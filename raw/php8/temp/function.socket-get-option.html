<div id="function.socket-get-option" class="refentry"> <div class="refnamediv">  <h1 class="refname">socket_get_option</h1>  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">socket_get_option</span> &mdash; <span class="dc-title">获取套接字的套接字选项</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.socket-get-option-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>socket_get_option</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.socket.php" class="type Socket" style="color:#EAB766">Socket</a></span> <span class="parameter" style="color:#3A95FF">$socket</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$level</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$option</span></span>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">int</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">socket_get_option()</strong></span> 函数检索指定 <span class="parameter" style="color:#3A95FF">socket</span>    中由 <span class="parameter" style="color:#3A95FF">option</span> 参数指定的选项值。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.socket-get-option-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">socket</span></dt>     <dd>      <p class="para">       由 <span class="function">{@link socket_create()}</span> 或 <span class="function">{@link socket_accept()}</span>        创建的 <span class="classname"><a href="https://www.php.net/manual/zh/class.socket.php" class="classname">Socket</a></span> 实例。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">level</span></dt>     <dd>      <p class="para">       <span class="parameter" style="color:#3A95FF">level</span> 参数定义选项所在的协议级别。例如，在 socket 级别检索选项，将使用 <strong><span>SOL_SOCKET</span></strong>        作为 <span class="parameter" style="color:#3A95FF">level</span> 参数值。在其它级别，例如 TCP，可以使用该级别指定的协议号。协议号可以通过 <span class="function">{@link getprotobyname()}</span>        获取。      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">option</span></dt>     <dd>      <table class="doctable table">       <caption><strong>套接字可用选项</strong></caption>               <thead>         <tr>          <th>选项</th>          <th>描述</th>          <th>类型</th>         </tr>        </thead>        <tbody class="tbody">         <tr>          <td><strong><span>SO_DEBUG</span></strong></td>          <td>           是否记录调试信息。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_BROADCAST</span></strong></td>          <td>           是否支持传输广播消息。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_REUSEADDR</span></strong></td>          <td>           是否可以复用本地地址。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_REUSEPORT</span></strong></td>          <td>           是否可以复用本地端口。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_KEEPALIVE</span></strong></td>          <td>           是否通过定期传输消息来为连接保活。如果连接的套接字对消息未响应，连接将断开，并且正在写入套接字的进程会收到 SIGPIPE 信号。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_LINGER</span></strong></td>          <td>           <p class="para">            <span class="parameter" style="color:#3A95FF">socket</span> 执行 <span class="function">{@link socket_close()}</span>             时是否滞留残留数据。默认情况下，当关闭 socket 时，将尝试发送所有还未发送的数据。在面向连接的套接字中，<span class="function">{@link socket_close()}</span>             会等待对端确认接收数据。           </p>           <p class="para">            如果 <var class="varname">l_onoff</var> 不为零，且 <var class="varname">l_linger</var>             为零，对于面向连接的套接字，将丢弃所有未发送的数据，并发送给对端一个 RST（reset）报文。           </p>           <p class="para">            另外，如果 <var class="varname">l_onoff</var> 不为零，且 <var class="varname">l_linger</var>             不为零，<span class="function">{@link socket_close()}</span> 将阻塞，直到数据被发送完或者超过 <var class="varname">l_linger</var>             指定的时间。如果 socket 设置为非阻塞，<span class="function">{@link socket_close()}</span> 将执行失败并返回错误。           </p>          </td>          <td>           <span class="type" style="color:#EAB766">array</span>。数组包含两个键：           <var class="varname">l_onoff</var> 和 <var class="varname">l_linger</var>。          </td>         </tr>         <tr>          <td><strong><span>SO_OOBINLINE</span></strong></td>          <td>           <span class="parameter" style="color:#3A95FF">socket</span> 是否保留带外数据在正常的数据输入队列中。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_SNDBUF</span></strong></td>          <td>           发送缓冲区大小。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>                   </tr>         <tr>          <td><strong><span>SO_RCVBUF</span></strong></td>          <td>           接收缓冲区大小。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>                  </tr>         <tr>          <td><strong><span>SO_ERROR</span></strong></td>          <td>           获取错误状态信息并复位。          </td>          <td>           <span class="type" style="color:#EAB766">int</span> (不能被 <span class="function">{@link socket_set_option()}</span> 设置)          </td>         </tr>         <tr>          <td><strong><span>SO_TYPE</span></strong></td>          <td>           <span class="parameter" style="color:#3A95FF">socket</span> 类型（例如 <strong><span>SOCK_STREAM</span></strong>）。          </td>          <td>           <span class="type" style="color:#EAB766">int</span> (不能被 <span class="function">{@link socket_set_option()}</span> 设置）          </td>         </tr>         <tr>          <td><strong><span>SO_DONTROUTE</span></strong></td>          <td>           发出的消息是否绕过标准路由机制。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_RCVLOWAT</span></strong></td>          <td>           <span class="parameter" style="color:#3A95FF">socket</span> 写入操作要处理的最小字节数。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_RCVTIMEO</span></strong></td>          <td>           接收超时时间。          </td>          <td>           <span class="type" style="color:#EAB766">array</span>。数组包含两个键：<var class="varname">sec</var>            是超时时间的秒部分，<var class="varname">usec</var> 是微秒部分。          </td>         </tr>         <tr>          <td><strong><span>SO_SNDTIMEO</span></strong></td>          <td>           指定输出功能阻塞的超时时长，因为流量控制会阻止数据发送。          </td>          <td>           <span class="type" style="color:#EAB766">array</span>。数组包含两个键：<var class="varname">sec</var>            是超时时间的秒部分，<var class="varname">usec</var> 是微秒部分。          </td>         </tr>         <tr>          <td><strong><span>SO_SNDLOWAT</span></strong></td>          <td>           <span class="parameter" style="color:#3A95FF">socket</span> 输出操作要处理的最小字节数。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_NODELAY</span></strong></td>          <td>           是否禁用 TCP Nagle 算法。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>MCAST_JOIN_GROUP</span></strong></td>          <td>           加入多播组。          </td>          <td>           <span class="type" style="color:#EAB766">array</span> 包含 <span>&quot;group&quot;</span> 键，指定 <span class="type" style="color:#EAB766">string</span>            类型的 IPv4 或 IPv6 多播地址；另一个键 <span>&quot;interface&quot;</span>            指定（<span class="type" style="color:#EAB766">int</span> 类型）接口编号或是 <span>string</span>            类型的接口名称，比如 <span>&quot;eth0&quot;</span>。可以指定 <span>0</span>            来使用路由规则选择接口。（仅在 <span class="function">{@link socket_set_option()}</span> 中使用）          </td>         </tr>         <tr>          <td><strong><span>MCAST_LEAVE_GROUP</span></strong></td>          <td>           离开多播组。          </td>          <td>           <span class="type" style="color:#EAB766">array</span>。详情见 <strong><span>MCAST_JOIN_GROUP</span></strong>。（仅在 <span class="function">{@link socket_set_option()}</span> 中使用）          </td>         </tr>         <tr>          <td><strong><span>MCAST_BLOCK_SOURCE</span></strong></td>          <td>           在已加入的多播组上阻塞接收来自指定源的数据包。          </td>          <td>           <span class="type" style="color:#EAB766">array</span> 与 <strong><span>MCAST_JOIN_GROUP</span></strong>            有相同的键，额外增加 <span class="type" style="color:#EAB766">string</span>            类型的 <span>source</span> 键，指定要阻塞的 IPv4 或 IPv6 源地址。（仅在 <span class="function">{@link socket_set_option()}</span> 中使用）          </td>         </tr>         <tr>          <td><strong><span>MCAST_UNBLOCK_SOURCE</span></strong></td>          <td>           在已加入的多播组取消阻塞（继续接收）接收来自指定源的数据包。          </td>          <td>           <span class="type" style="color:#EAB766">array</span> 与 <strong><span>MCAST_BLOCK_SOURCE</span></strong> 格式相同。（仅在 <span class="function">{@link socket_set_option()}</span> 中使用）          </td>         </tr>         <tr>          <td><strong><span>MCAST_JOIN_SOURCE_GROUP</span></strong></td>          <td>           接收源地址与指定多播组匹配的数据包。          </td>          <td>           <span class="type" style="color:#EAB766">array</span> 与 <strong><span>MCAST_BLOCK_SOURCE</span></strong> 格式相同。（仅在 <span class="function">{@link socket_set_option()}</span> 中使用）          </td>         </tr>         <tr>          <td><strong><span>MCAST_LEAVE_SOURCE_GROUP</span></strong></td>          <td>           停止接收源地址与指定多播组匹配的数据包。          </td>          <td>           <span class="type" style="color:#EAB766">array</span> 与 <strong><span>MCAST_BLOCK_SOURCE</span></strong> 格式相同。（仅在 <span class="function">{@link socket_set_option()}</span> 中使用）          </td>         </tr>         <tr>          <td><strong><span>IP_MULTICAST_IF</span></strong></td>          <td>           IPv4 多播数据包的输出接口。          </td>          <td>           使用 <span class="type" style="color:#EAB766">int</span> 类型指定接口编号或使用 <span class="type" style="color:#EAB766">string</span>            类型指定接口名，例如 <span>eth0</span>。<span class="type" style="color:#EAB766"><span class="type 0" style="color:#EAB766">0</span></span>            表示选择接口时使用路由表。<span class="function">{@link socket_set_option()}</span>            函数返回接口索引。注意，不像 C API，此选项无需提供 IP 地址。这样就消除了 <strong><span>IP_MULTICAST_IF</span></strong>            和 <strong><span>IPV6_MULTICAST_IF</span></strong> 之间的接口差异。          </td>         </tr>         <tr>          <td><strong><span>IPV6_MULTICAST_IF</span></strong></td>          <td>           IPv6 多播数据包的输出接口。          </td>          <td>           与 <strong><span>IP_MULTICAST_IF</span></strong> 相同。          </td>         </tr>         <tr>          <td><strong><span>IP_MULTICAST_LOOP</span></strong></td>          <td>           在已加入的多播组开启或禁用 IPv4 报文的组播环回策略。类 Unix 中作用于发送路径，Windows 中作用于接收路径。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>（<span>0</span> 或 <span>1</span>）。<span class="function"><strong style="color:#CC7832">socket_get_option()</strong></span>           可以接受任何值，并按照常规 PHP 规则转换为布尔值。          </td>         </tr>         <tr>          <td><strong><span>IPV6_MULTICAST_LOOP</span></strong></td>          <td>           与 <strong><span>IP_MULTICAST_LOOP</span></strong> 类似，但用于 IPv6。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>。详情见 <strong><span>IP_MULTICAST_LOOP</span></strong>。          </td>         </tr>         <tr>          <td><strong><span>IP_MULTICAST_TTL</span></strong></td>          <td>           传出 IPv4 多播数据包的生存时间。这个值需要在 0（数据不传出）到 255 之间。默认值是 1（仅到达本地网络）。          </td>          <td>           <span class="type" style="color:#EAB766">int</span> 0 到 255 之间。          </td>         </tr>         <tr>          <td><strong><span>IPV6_MULTICAST_HOPS</span></strong></td>          <td>           与 <strong><span>IP_MULTICAST_TTL</span></strong> 类似，但用于 IPv6 数据包。-1 也可以被接受，表示使用默认路由。          </td>          <td>           <span class="type" style="color:#EAB766">int</span> -1 到 255 之间。          </td>         </tr>         <tr>          <td><strong><span>SO_MARK</span></strong></td>          <td>           在套接字上设置标识符，用于过滤 Linux 中的数据包。           </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_ACCEPTFILTER</span></strong></td>          <td>           在（FreeBSD 或 NetBSD）监听套接字上添加接受过滤器。FreeBSD 中，需要预先加载接受过滤器内核模块（例如 accf_http）。          </td>          <td>           <span class="type" style="color:#EAB766">string</span> 过滤器名称（最大长度 15）。          </td>         </tr>         <tr>          <td><strong><span>SO_USER_COOKIE</span></strong></td>          <td>           在套接字上设置标识符，用于过滤 FreeBSD 中的数据包。           </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_RTABLE</span></strong></td>          <td>           在套接字上设置标识符，用于过滤 OpenBSD 中的数据包。           </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_DONTTRUNC</span></strong></td>          <td>           保留未读数据。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_WANTMORE</span></strong></td>          <td>           当准备好更多数据时给出提示。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_DEFER_ACCEPT</span></strong></td>          <td>           在数据准备好之前不通知监听套接字。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_INCOMING_CPU</span></strong></td>          <td>           获取或设置套接字的 CPU 亲和性。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_MEMINFO</span></strong></td>          <td>           获取套接字的内存信息。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_BPF_EXTENSIONS</span></strong></td>          <td>           为套接字附加内核支持的 BPF 扩展。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SO_SETFIB</span></strong></td>          <td>           为套接字设置路由表（FIB）。（仅 FreeBSD）          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>SOL_FILTER</span></strong></td>          <td>           过滤套接字的属性。（仅 Solaris/Illumos）          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_KEEPCNT</span></strong></td>          <td>           设置 TCP 在断开连接前的最大保活探测次数。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_KEEPIDLE</span></strong></td>          <td>           设置连接需要保持空闲的时间。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_KEEPINTVL</span></strong></td>          <td>           设置各个保活探针的间隔时间。          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_KEEPALIVE</span></strong></td>          <td>           设置连接需要保持空闲的时间。（仅 macOS）          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>         <tr>          <td><strong><span>TCP_NOTSENT_LOWAT</span></strong></td>          <td>           设置套接字流数据队列中未发送数据的数量限制。（仅 Linux）          </td>          <td>           <span class="type" style="color:#EAB766">int</span>          </td>         </tr>        </tbody>             </table>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.socket-get-option-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   返回给定选项的值， 或者在失败时返回 <strong><span>false</span></strong>。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.socket-get-option-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>  <td>8.0.0</td>  <td>   现在 <span class="parameter" style="color:#3A95FF">socket</span> 是 <span class="classname"><a href="https://www.php.net/manual/zh/class.socket.php" class="classname">Socket</a></span> 实例，   之前是 <span class="type" style="color:#EAB766">resource</span>。  </td> </tr>    </tbody>     </table> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.socket-get-option-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">socket_get_option()</strong></span> 示例</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$socket </span><span style="color: #007700">= </span><span style="color: #9876AA">socket_create_listen</span><span style="color: #007700">(</span><span style="color: #9876AA">1223</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$linger </span><span style="color: #007700">= array(</span><span style="color: #DD0000">'l_linger' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'l_onoff' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">socket_set_option</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">SOL_SOCKET</span><span style="color: #007700">, </span><span style="color: #9876AA">SO_LINGER</span><span style="color: #007700">, </span><span style="color: #9876AA">$linger</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">var_dump</span><span style="color: #007700">(</span><span style="color: #9876AA">socket_get_option</span><span style="color: #007700">(</span><span style="color: #9876AA">$socket</span><span style="color: #007700">, </span><span style="color: #9876AA">SOL_SOCKET</span><span style="color: #007700">, </span><span style="color: #9876AA">SO_REUSEADDR</span><span style="color: #007700">));<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.socket-get-option-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link socket_create_listen()} - 在端口上打开一个套接字以接受连接</span></li>    <li class="member"><span class="function">{@link socket_set_option()} - 为套接字设置套接字选项</span></li>   </ul>  </span> </div></div>
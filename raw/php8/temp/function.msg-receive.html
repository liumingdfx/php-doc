<div id="function.msg-receive" class="refentry"> <div class="refnamediv">  <h1 class="refname">msg_receive</h1>  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">msg_receive</span> &mdash; <span class="dc-title">Receive a message from a message queue</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.msg-receive-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>msg_receive</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.sysvmessagequeue.php" class="type SysvMessageQueue" style="color:#EAB766">SysvMessageQueue</a></span> <span class="parameter" style="color:#3A95FF">$queue</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$desired_message_type</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">&$received_message_type</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$max_message_size</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed" class="type mixed" style="color:#EAB766">mixed</a></span> <span class="parameter" style="color:#3A95FF">&$message</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">bool</span> <span class="parameter" style="color:#3A95FF">$unserialize</span><span class="initializer"> = <strong><span>true</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$flags</span><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">&$error_code</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766">bool</span></div>  <p class="para rdfs-comment">   <span class="function"><strong style="color:#CC7832">msg_receive()</strong></span> will receive the first message from the   specified <span class="parameter" style="color:#3A95FF">queue</span> of the type specified by   <span class="parameter" style="color:#3A95FF">desired_message_type</span>.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.msg-receive-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">queue</span></dt>     <dd>      <p class="para">       The message queue.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">desired_message_type</span></dt>     <dd>      <p class="para">       If <span class="parameter" style="color:#3A95FF">desired_message_type</span> is 0, the message from the front       of the queue is returned. If <span class="parameter" style="color:#3A95FF">desired_message_type</span> is       greater than 0, then the first message of that type is returned.       If <span class="parameter" style="color:#3A95FF">desired_message_type</span> is less than 0, the first       message on the queue with a type less than or equal to the       absolute value of <span class="parameter" style="color:#3A95FF">desired_message_type</span> will be read.       If no messages match the criteria, your script will wait until a suitable       message arrives on the queue.  You can prevent the script from blocking       by specifying <strong><span>MSG_IPC_NOWAIT</span></strong> in the       <span class="parameter" style="color:#3A95FF">flags</span> parameter.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">received_message_type</span></dt>     <dd>      <p class="para">       The type of the message that was received will be stored in this       parameter.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">max_message_size</span></dt>     <dd>      <p class="para">       The maximum size of message to be accepted is specified by the       <span class="parameter" style="color:#3A95FF">max_message_size</span>; if the message in the queue is larger       than this size the function will fail (unless you set       <span class="parameter" style="color:#3A95FF">flags</span> as described below).      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">message</span></dt>     <dd>      <p class="para">       The received message will be stored in <span class="parameter" style="color:#3A95FF">message</span>,       unless there were errors receiving the message.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">unserialize</span></dt>     <dd>      <p class="para">       If set to       <strong><span>true</span></strong>, the message is treated as though it was serialized using the       same mechanism as the session module. The message will be unserialized       and then returned to your script. This allows you to easily receive       arrays or complex object structures from other PHP scripts, or if you       are using the WDDX serializer, from any WDDX compatible source.      </p>      <p class="para">       If <span class="parameter" style="color:#3A95FF">unserialize</span> is <strong><span>false</span></strong>, the message will be       returned as a binary-safe string.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">flags</span></dt>     <dd>      <p class="para">       The optional <span class="parameter" style="color:#3A95FF">flags</span> allows you to pass flags to the       low-level msgrcv system call.  It defaults to 0, but you may specify one       or more of the following values (by adding or ORing them together).       <table class="doctable table">        <caption><strong>Flag values for msg_receive</strong></caption>                 <tbody class="tbody">          <tr>           <td><strong><span>MSG_IPC_NOWAIT</span></strong></td>           <td>If there are no messages of the            <span class="parameter" style="color:#3A95FF">desired_message_type</span>, return immediately and do not            wait.  The function will fail and return an integer value            corresponding to <strong><span>MSG_ENOMSG</span></strong>.           </td>          </tr>          <tr>           <td><strong><span>MSG_EXCEPT</span></strong></td>           <td>Using this flag in combination with a            <span class="parameter" style="color:#3A95FF">desired_message_type</span> greater than 0 will cause the            function to receive the first message that is not equal to            <span class="parameter" style="color:#3A95FF">desired_message_type</span>.</td>          </tr>          <tr>           <td><strong><span>MSG_NOERROR</span></strong></td>           <td>            If the message is longer than <span class="parameter" style="color:#3A95FF">max_message_size</span>,            setting this flag will truncate the message to            <span class="parameter" style="color:#3A95FF">max_message_size</span> and will not signal an error.           </td>          </tr>         </tbody>               </table>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_code</span></dt>     <dd>      <p class="para">       If the function fails, the optional <span class="parameter" style="color:#3A95FF">error_code</span>       will be set to the value of the system errno variable.      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.msg-receive-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   成功时返回 <strong><span>true</span></strong>， 或者在失败时返回 <strong><span>false</span></strong>。  </p>  <p class="para">   Upon successful completion the message queue data structure is updated as   follows: <span>msg_lrpid</span> is set to the process-ID of the   calling process, <span>msg_qnum</span> is decremented by 1 and   <span>msg_rtime</span> is set to the current time.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.msg-receive-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>8.0.0</td>       <td>        <span class="parameter" style="color:#3A95FF">queue</span> expects a <span class="classname"><a href="https://www.php.net/manual/zh/class.sysvmessagequeue.php" class="classname">SysvMessageQueue</a></span>        instance now; previously, a <span class="type" style="color:#EAB766">resource</span> was expected.       </td>      </tr>     </tbody>       </table>  </span> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.msg-receive-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link msg_remove_queue()} - Destroy a message queue</span></li>    <li class="member"><span class="function">{@link msg_send()} - Send a message to a message queue</span></li>    <li class="member"><span class="function">{@link msg_stat_queue()} - Returns information from the message queue data structure</span></li>    <li class="member"><span class="function">{@link msg_set_queue()} - Set information in the message queue data structure</span></li>   </ul>  </span> </div>  </div>
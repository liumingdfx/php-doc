<div id="class.mongodb-driver-cursor" class="reference"> <h1 class="title">The MongoDB\Driver\Cursor class</h1>  <div class="partintro"><p class="verinfo">(mongodb &gt;=1.0.0)</p>  <div class="section" id="mongodb-driver-cursor.intro">   <h2 class="title">简介</h2>   <p class="para">    The <span class="classname"><strong class="classname">MongoDB\Driver\Cursor</strong></span> class encapsulates    the results of a MongoDB command or query and may be returned by    <span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeCommand()}</span> or    <span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeQuery()}</span>, respectively.   </p>  </div>  <div class="section" id="mongodb-driver-cursor.synopsis">   <h2 class="title">类摘要</h2>   <div class="classsynopsis">    <span class="ooclass"><strong class="classname"></strong></span>    <div class="classsynopsisinfo">     <span class="modifier">final</span>     <span class="ooclass">      <span class="modifier">class</span> <strong class="classname">MongoDB\Driver\Cursor</strong>     </span>     <span class="oointerface"><span class="modifier">implements</span>        <a href="https://www.php.net/manual/zh/class.mongodb-driver-cursorinterface.php" class="interfacename">MongoDB\Driver\CursorInterface</a></span><span class="oointerface">,  <a href="https://www.php.net/manual/zh/class.iterator.php" class="interfacename">Iterator</a></span> {</div>        <div class="classsynopsisinfo classsynopsisinfo_comment">// 方法 </div>    <div class="methodsynopsis dc-description">   <span class="modifier">final</span> <span class="modifier">private</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.construct.php" class="methodname" style="color:#CC7832">__construct</a></span>()</div><div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.current.php" class="methodname" style="color:#CC7832">current</a></span>(): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span>|<span class="type" style="color:#EAB766">null</span></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.getid.php" class="methodname" style="color:#CC7832">getId</a></span>(): <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.mongodb-driver-cursorid.php" class="type MongoDB\Driver\CursorId" style="color:#EAB766">MongoDB\Driver\CursorId</a></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.getserver.php" class="methodname" style="color:#CC7832">getServer</a></span>(): <span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/class.mongodb-driver-server.php" class="type MongoDB\Driver\Server" style="color:#EAB766">MongoDB\Driver\Server</a></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.isdead.php" class="methodname" style="color:#CC7832">isDead</a></span>(): <span class="type" style="color:#EAB766">bool</span></div><div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.key.php" class="methodname" style="color:#CC7832">key</a></span>(): <span class="type" style="color:#EAB766">int</span></div><div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.next.php" class="methodname" style="color:#CC7832">next</a></span>(): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div><div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.rewind.php" class="methodname" style="color:#CC7832">rewind</a></span>(): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.settypemap.php" class="methodname" style="color:#CC7832">setTypeMap</a></span>(<span class="methodparam"><span class="type" style="color:#EAB766">array</span> <span class="parameter" style="color:#3A95FF">$typemap</span></span>): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div><div class="methodsynopsis dc-description"><span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.toarray.php" class="methodname" style="color:#CC7832">toArray</a></span>(): <span class="type" style="color:#EAB766">array</span></div><div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><a href="https://www.php.net/manual/zh/mongodb-driver-cursor.valid.php" class="methodname" style="color:#CC7832">valid</a></span>(): <span class="type" style="color:#EAB766">bool</span></div>   }</div>  </div>  <div class="section">   <h2 class="title">更新日志</h2>   <p class="para">    <table class="doctable informaltable">           <thead>       <tr>        <th>版本</th>        <th>说明</th>       </tr>      </thead>      <tbody class="tbody">       <tr>        <td>PECL mongodb 1.9.0</td>        <td>         Implements <span class="interfacename"><a href="https://www.php.net/manual/zh/class.iterator.php" class="interfacename">Iterator</a></span>.        </td>       </tr>       <tr>        <td>PECL mongodb 1.6.0</td>        <td>         Implements <span class="interfacename"><a href="https://www.php.net/manual/zh/class.mongodb-driver-cursorinterface.php" class="interfacename">MongoDB\Driver\CursorInterface</a></span>,         which extends <span class="interfacename"><a href="https://www.php.net/manual/zh/class.traversable.php" class="interfacename">Traversable</a></span>.        </td>       </tr>      </tbody>         </table>   </p>  </div>  <div class="section" id="mongodb-driver-cursor.examples">   <h2 class="title">示例</h2>   <div class="example" id="example-4028">    <p><strong>示例 #1 Reading a result set</strong></p>    <div class="example-contents"><p>     <span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeCommand()}</span> and     <span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeQuery()}</span> both return     their result(s) as a <span class="classname"><strong class="classname">MongoDB\Driver\Cursor</strong></span> object.     This object can be used to iterate over the result set of the command or     query.    </p></div>    <div class="example-contents"><p>     Because <span class="classname"><strong class="classname">MongoDB\Driver\Cursor</strong></span> implements the     <span class="interfacename"><a href="https://www.php.net/manual/zh/class.traversable.php" class="interfacename">Traversable</a></span> interface, you can simply     iterate over the result set with     <a href="https://www.php.net/manual/zh/control-structures.foreach.php" class="link"><span>foreach</span></a>.    </p></div>   <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />$manager </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Manager</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// Insert some documents so that our query returns information <br /></span><span style="color: #9876AA">$bulkWrite </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\BulkWrite</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$bulkWrite</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">insert</span><span style="color: #007700">([</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Ceres'</span><span style="color: #007700">, </span><span style="color: #DD0000">'size' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">946</span><span style="color: #007700">, </span><span style="color: #DD0000">'distance' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2.766</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">$bulkWrite</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">insert</span><span style="color: #007700">([</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Vesta'</span><span style="color: #007700">, </span><span style="color: #DD0000">'size' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">525</span><span style="color: #007700">, </span><span style="color: #DD0000">'distance' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2.362</span><span style="color: #007700">]);<br /></span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeBulkWrite</span><span style="color: #007700">(</span><span style="color: #DD0000">"test.asteroids"</span><span style="color: #007700">, </span><span style="color: #9876AA">$bulkWrite</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Query for all the items in the collection <br /></span><span style="color: #9876AA">$query </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Query</span><span style="color: #007700">( [] );<br /><br /></span><span style="color: #FF8000">// Query the "asteroids" collection of the "test" database <br /></span><span style="color: #9876AA">$cursor </span><span style="color: #007700">= </span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeQuery</span><span style="color: #007700">(</span><span style="color: #DD0000">"test.asteroids"</span><span style="color: #007700">, </span><span style="color: #9876AA">$query</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// $cursor now contains an object that wraps around the result set. Use<br /> * foreach() to iterate over all the result <br /></span><span style="color: #007700">foreach(</span><span style="color: #9876AA">$cursor </span><span style="color: #007700">as </span><span style="color: #9876AA">$document</span><span style="color: #007700">) {<br />    </span><span style="color: #9876AA">print_r</span><span style="color: #007700">(</span><span style="color: #9876AA">$document</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>   </div>   <div class="example-contents"><p>以上示例的输出类似于：</p></div>   <div class="example-contents screen" style="color:AFB1B3;background:black;padding-left:5px;"><div class="cdata"><span>stdClass Object<br>(<br>    [_id] =&gt; MongoDB\BSON\ObjectId Object<br>        (<br>            [oid] =&gt; 5a4cff2f122d3321565d8cc2<br>        )<br><br>    [name] =&gt; Ceres<br>    [size] =&gt; 946<br>    [distance] =&gt; 2.766<br>)<br>stdClass Object<br>(<br>    [_id] =&gt; MongoDB\BSON\ObjectId Object<br>        (<br>            [oid] =&gt; 5a4cff2f122d3321565d8cc3<br>        )<br><br>    [name] =&gt; Vesta<br>    [size] =&gt; 525<br>    [distance] =&gt; 2.362<br>}<br></span></div>    </div>   </div>   <div class="example" id="example-4031">    <p><strong>示例 #2 Reading a result set for a tailable cursor</strong></p>    <div class="example-contents"><p>     <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/core/tailable-cursors" class="link external">&raquo;&nbsp;Tailable cursors</a>     are a special type of MongoDB cursor that allows the client to read some     results and then wait until more documents become available. These cursors     are primarily used with     <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/core/capped-collections" class="link external">&raquo;&nbsp;Capped Collections</a>     and <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/changeStreams" class="link external">&raquo;&nbsp;Change Streams</a>.    </p></div>    <div class="example-contents"><p>     While normal cursors can be iterated once with <span>foreach</span>,     that approach will not work with tailable cursors. When     <span>foreach</span> is used with a tailable cursor, the loop will     stop upon reaching the end of the initial result set. Attempting to     continue iteration on the cursor with a second     <span>foreach</span> would throw an exception, since PHP attempts to     rewind the cursor. Similar to result objects in other database drivers,     cursors in MongoDB only support forward iteration, which means they cannot     be rewound.    </p></div>    <div class="example-contents"><p>     In order to continuously read from a tailable cursor, the Cursor object     must be wrapped with an <span class="classname"><a href="https://www.php.net/manual/zh/class.iteratoriterator.php" class="classname">IteratorIterator</a></span>. This     allows the application to directly control the cursor&#039;s iteration, avoid     inadvertently rewinding the cursor, and decide when to wait for new results     or stop iteration entirely.    </p></div>    <div class="example-contents"><p>     In order to demonstrate a tailable cursor in action, two scripts will be     used: a &quot;producer&quot; and a &quot;consumer&quot;. The producer script will create a new     capped collection using the     <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/reference/command/create" class="link external">&raquo;&nbsp;create</a> command     and proceed to insert a new document into that collection each second.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />$manager </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Manager</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeCommand</span><span style="color: #007700">(</span><span style="color: #DD0000">'test'</span><span style="color: #007700">, new </span><span style="color: #9876AA">MongoDB\Driver\Command</span><span style="color: #007700">([<br />    </span><span style="color: #DD0000">'create' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'asteroids'</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">'capped' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">'size' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">1048576</span><span style="color: #007700">,<br />]));<br /><br />while (</span><span style="color: #9876AA">true</span><span style="color: #007700">) {<br />    </span><span style="color: #9876AA">$bulkWrite </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\BulkWrite</span><span style="color: #007700">;<br />    </span><span style="color: #9876AA">$bulkWrite</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">insert</span><span style="color: #007700">([</span><span style="color: #DD0000">'createdAt' </span><span style="color: #007700">=&gt; new </span><span style="color: #9876AA">MongoDB\BSON\UTCDateTime</span><span style="color: #007700">]);<br />    </span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeBulkWrite</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.asteroids'</span><span style="color: #007700">, </span><span style="color: #9876AA">$bulkWrite</span><span style="color: #007700">);<br /><br />    </span><span style="color: #9876AA">sleep</span><span style="color: #007700">(</span><span style="color: #9876AA">1</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>     With the producer script still running, a second consumer script may be     executed to read the inserted documents using a tailable cursor, indicated     by the <span>tailable</span> and <span>awaitData</span> options     to <span class="function">{@link MongoDB\Driver\Query::__construct()}</span>.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />$manager </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Manager</span><span style="color: #007700">;<br /><br /></span><span style="color: #9876AA">$query </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Query</span><span style="color: #007700">([], [<br />    </span><span style="color: #DD0000">'tailable' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">'awaitData' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">true</span><span style="color: #007700">,<br />]);<br /><br /></span><span style="color: #9876AA">$cursor </span><span style="color: #007700">= </span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeQuery</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.asteroids'</span><span style="color: #007700">, </span><span style="color: #9876AA">$query</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$iterator </span><span style="color: #007700">= new </span><span style="color: #9876AA">IteratorIterator</span><span style="color: #007700">(</span><span style="color: #9876AA">$cursor</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">$iterator</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">rewind</span><span style="color: #007700">();<br /><br />while (</span><span style="color: #9876AA">true</span><span style="color: #007700">) {<br />    if (</span><span style="color: #9876AA">$iterator</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">valid</span><span style="color: #007700">()) {<br />        </span><span style="color: #9876AA">$document </span><span style="color: #007700">= </span><span style="color: #9876AA">$iterator</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">current</span><span style="color: #007700">();<br />        </span><span style="color: #9876AA">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Consumed document created at: %s\n"</span><span style="color: #007700">, </span><span style="color: #9876AA">$document</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">createdAt</span><span style="color: #007700">);<br />    }<br /><br />    </span><span style="color: #9876AA">$iterator</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">next</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>    <div class="example-contents"><p>     The consumer script will start by quickly printing all available documents     in the capped collection (as if <span>foreach</span> had been used);     however, it will not terminate upon reaching the end of the initial result     set. Since the cursor is tailable, calling     <span class="function">{@link IteratorIterator::next()}</span> will block and wait for     additional results. <span class="function">{@link IteratorIterator::valid()}</span> is also     used to check if there is actually data available to read at each step.    </p></div>    <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:      <span class="simpara">      This example uses the <span>awaitData</span> query option to      instruct the server to block for a short period (e.g. one second) at the      end of the result set before returning a response to the driver. This is      used to prevent the driver from aggressively polling the server when there      are no results available. The <span>maxAwaitTimeMS</span> option may      be used in conjunction with <span>tailable</span> and      <span>awaitData</span> to specify the amount of time that the server      should block when it reaches the end of the result set.     </span>    </p></blockquote>   </div>  </div>  <div class="section">   <h2 class="title">错误／异常</h2>   <p class="simpara">    When iterating over the cursor object, BSON data is converted into PHP    variables. This iteration can cause the following Exceptions:   </p>   <ul class="simplelist">    <li class="member">     Throws     <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-invalidargumentexception.php" class="classname">MongoDB\Driver\Exception\InvalidArgumentException</a></span> if     a class in the type map cannot be instantiated or does not implement     <span class="interfacename"><a href="https://www.php.net/manual/zh/class.mongodb-bson-unserializable.php" class="interfacename">MongoDB\BSON\Unserializable</a></span>.    </li>    <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-unexpectedvalueexception.php" class="classname">MongoDB\Driver\Exception\UnexpectedValueException</a></span> if the input did not contain exactly one BSON document. Possible reasons include, but are not limited to, invalid BSON, extra data (after reading one BSON document), or an unexpected <a href="https://www.php.net/manual/zh/https://github.com/mongodb/mongo-c-driver/tree/master/src/libbson" class="link external">&raquo;&nbsp;libbson</a> error.</li>   </ul>  </div> </div>          <h2>目录</h2><ul class="chunklist chunklist_reference"><li>{@link MongoDB\Driver\Cursor::__construct} — Create a new Cursor (not used)</li><li>{@link MongoDB\Driver\Cursor::current} — Returns the current element</li><li>{@link MongoDB\Driver\Cursor::getId} — Returns the ID for this cursor</li><li>{@link MongoDB\Driver\Cursor::getServer} — Returns the server associated with this cursor</li><li>{@link MongoDB\Driver\Cursor::isDead} — Checks if the cursor is exhausted or may have additional results</li><li>{@link MongoDB\Driver\Cursor::key} — Returns the current result's index within the cursor</li><li>{@link MongoDB\Driver\Cursor::next} — Advances the cursor to the next result</li><li>{@link MongoDB\Driver\Cursor::rewind} — Rewind the cursor to the first result</li><li>{@link MongoDB\Driver\Cursor::setTypeMap} — Sets a type map to use for BSON unserialization</li><li>{@link MongoDB\Driver\Cursor::toArray} — Returns an array containing all results for this cursor</li><li>{@link MongoDB\Driver\Cursor::valid} — Checks if the current position in the cursor is valid</li></ul></div>
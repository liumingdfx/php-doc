<div id="function.stream-socket-client" class="refentry"> <div class="refnamediv">  <h1 class="refname">stream_socket_client</h1>  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">stream_socket_client</span> &mdash; <span class="dc-title">Open Internet or Unix domain socket connection</span></p> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-function.stream-socket-client-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="methodname" style="color:#CC7832"><strong>stream_socket_client</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">$address</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">&$error_code</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">string</span> <span class="parameter" style="color:#3A95FF">&$error_message</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">float</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$timeout</span><span class="initializer"> = <strong><span>null</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">int</span> <span class="parameter" style="color:#3A95FF">$flags</span><span class="initializer"> = <strong><span>STREAM_CLIENT_CONNECT</span></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$context</span><span class="initializer"> = <strong><span>null</span></strong></span></span><br>): <span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">resource</span>|<span class="type" style="color:#EAB766"><span class="type false" style="color:#EAB766">false</span></span></span></div>  <p class="para rdfs-comment">   Initiates a stream or datagram connection to the destination specified   by <span class="parameter" style="color:#3A95FF">address</span>.  The type of socket created   is determined by the transport specified using standard URL formatting:   <span>transport://target</span>.  For Internet Domain sockets   (AF_INET) such as TCP and UDP, the <span>target</span> portion   of the <span class="parameter" style="color:#3A95FF">address</span> parameter should consist of   a hostname or IP address followed by a colon and a port number.  For Unix   domain sockets, the <span>target</span> portion should point   to the socket file on the filesystem.  </p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    The stream will by default be opened in blocking mode.  You can    switch it to non-blocking mode by using    <span class="function">{@link stream_set_blocking()}</span>.   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-function.stream-socket-client-parameters">  <h3 class="title">参数</h3>  <span>   <dl>         <dt><span class="parameter" style="color:#3A95FF">address</span></dt>     <dd>      <p class="para">       Address to the socket to connect to.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_code</span></dt>     <dd>      <p class="para">       Will be set to the system level error number if connection fails.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">error_message</span></dt>     <dd>      <p class="para">       Will be set to the system level error message if the connection fails.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">timeout</span></dt>     <dd>      <p class="para">       Number of seconds until the <span>connect()</span> system call       should timeout. By default, <a href="https://www.php.net/manual/zh/filesystem.configuration.php#ini.default-socket-timeout" class="link">default_socket_timeout</a>       is used.       <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:         <span class="simpara">         This parameter only applies when not making asynchronous         connection attempts.        </span>       </p></blockquote>       <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:         <p class="para">         To set a timeout for reading/writing data over the socket, use the         <span class="function">{@link stream_set_timeout()}</span>, as the         <span class="parameter" style="color:#3A95FF">timeout</span> only applies while making connecting         the socket.        </p>       </p></blockquote>      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">flags</span></dt>     <dd>      <p class="para">       Bitmask field which may be set to any combination of connection flags.       Currently the select of connection flags is limited to       <strong><span>STREAM_CLIENT_CONNECT</span></strong> (default),       <strong><span>STREAM_CLIENT_ASYNC_CONNECT</span></strong> and       <strong><span>STREAM_CLIENT_PERSISTENT</span></strong>.      </p>     </dd>             <dt><span class="parameter" style="color:#3A95FF">context</span></dt>     <dd>      <p class="para">       A valid context resource created with <span class="function">{@link stream_context_create()}</span>.      </p>     </dd>       </dl>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-function.stream-socket-client-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   On success a stream resource is returned which may   be used together with the other file functions (such as   <span class="function">{@link fgets()}</span>, <span class="function">{@link fgetss()}</span>,   <span class="function">{@link fwrite()}</span>, <span class="function">{@link fclose()}</span>, and   <span class="function">{@link feof()}</span>), <strong><span>false</span></strong> on failure.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-function.stream-socket-client-errors">  <h3 class="title">错误／异常</h3>  <p class="para">   On failure the <span class="parameter" style="color:#3A95FF">error_code</span> and   <span class="parameter" style="color:#3A95FF">error_message</span> arguments will be populated with the actual   system level error that occurred in the system-level   <span>connect()</span> call. If the value returned in   <span class="parameter" style="color:#3A95FF">error_code</span> is <span>0</span> and the   function returned <strong><span>false</span></strong>, it is an indication that the error   occurred before the <span>connect()</span> call. This is   most likely due to a problem initializing the socket. Note that   the <span class="parameter" style="color:#3A95FF">error_code</span> and   <span class="parameter" style="color:#3A95FF">error_message</span> arguments will always be passed by   reference.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-function.stream-socket-client-changelog">  <h3 class="title">更新日志</h3>  <table class="doctable informaltable">       <thead>     <tr>      <th>版本</th>      <th>说明</th>     </tr>    </thead>    <tbody class="tbody">     <tr>      <td>8.0.0</td>      <td>       <span class="parameter" style="color:#3A95FF">timeout</span> and <span class="parameter" style="color:#3A95FF">context</span> are now nullable.      </td>     </tr>    </tbody>     </table> </div>  <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-function.stream-socket-client-examples">  <h3 class="title">示例</h3>  <span>   <div class="example" id="">    <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">stream_socket_client()</strong></span> example</strong></p>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_socket_client</span><span style="color: #007700">(</span><span style="color: #DD0000">"tcp://www.example.com:80"</span><span style="color: #007700">, </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">$errstr</span><span style="color: #007700">, </span><span style="color: #9876AA">30</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$fp</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"</span><span style="color: #9876AA">$errstr</span><span style="color: #DD0000"> (</span><span style="color: #9876AA">$errno</span><span style="color: #DD0000">)&lt;br /&gt;\n"</span><span style="color: #007700">;<br />} else {<br />    </span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"GET / HTTP/1.0\r\nHost: www.example.com\r\nAccept: /\r\n\r\n"</span><span style="color: #007700">);<br />    while (!</span><span style="color: #9876AA">feof</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">)) {<br />        echo </span><span style="color: #9876AA">fgets</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #9876AA">1024</span><span style="color: #007700">);<br />    }<br />    </span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>   <div class="example" id="">    <p><strong>示例 #2 Using UDP connection</strong></p>    <div class="example-contents"><p>     Retrieving the day and time from the UDP service &quot;daytime&quot; (port 13)     on localhost.    </p></div>    <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br />$fp </span><span style="color: #007700">= </span><span style="color: #9876AA">stream_socket_client</span><span style="color: #007700">(</span><span style="color: #DD0000">"udp://127.0.0.1:13"</span><span style="color: #007700">, </span><span style="color: #9876AA">$errno</span><span style="color: #007700">, </span><span style="color: #9876AA">$errstr</span><span style="color: #007700">);<br />if (!</span><span style="color: #9876AA">$fp</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"ERROR: </span><span style="color: #9876AA">$errno</span><span style="color: #DD0000"> - </span><span style="color: #9876AA">$errstr</span><span style="color: #DD0000">&lt;br /&gt;\n"</span><span style="color: #007700">;<br />} else {<br />    </span><span style="color: #9876AA">fwrite</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">);<br />    echo </span><span style="color: #9876AA">fread</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">, </span><span style="color: #9876AA">26</span><span style="color: #007700">);<br />    </span><span style="color: #9876AA">fclose</span><span style="color: #007700">(</span><span style="color: #9876AA">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>    </div>   </div>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 notes" id="refsect1-function.stream-socket-client-notes">  <h3 class="title">注释</h3>  <div class="warning"><strong class="warning">警告</strong>   <p class="simpara">     UDP sockets will sometimes appear to have opened without an error,     even if the remote host is unreachable.  The error will only     become apparent when you read or write data to/from the socket.     The reason for this is because UDP is a &quot;connectionless&quot; protocol,     which means that the operating system does not try to establish     a link for the socket until it actually needs to send or receive data.   </p>  </div>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>: <span class="simpara">当指定数值型的 IPv6地址（例如 <span>fe80::1</span>）时必须用方括号将 IP 围起来——例如，<span>tcp://[fe80::1]:80</span>。</span></p></blockquote>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">    Depending on the environment, the Unix domain or the optional    connect timeout may not be available.  A list of available    transports can be retrieved using <span class="function">{@link stream_get_transports()}</span>.    See <a href="https://www.php.net/manual/zh/transports.php" class="xref">所支持的套接字传输器列表</a> for a list of built in transports.   </p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-function.stream-socket-client-seealso">  <h3 class="title">参见</h3>  <span>   <ul class="simplelist">    <li class="member"><span class="function">{@link stream_socket_server()} - 创建 Internet 或 Unix 域服务器套接字</span></li>    <li class="member"><span class="function">{@link stream_set_blocking()} - 为资源流设置阻塞或者阻塞模式</span></li>    <li class="member"><span class="function">{@link stream_set_timeout()} - Set timeout period on a stream</span></li>    <li class="member"><span class="function">{@link stream_select()} - Runs the equivalent of the select() system call on the given   arrays of streams with a timeout specified by seconds and microseconds</span></li>    <li class="member"><span class="function">{@link fgets()} - 从文件指针中读取一行</span></li>    <li class="member"><span class="function">{@link fgetss()} - 从文件指针中读取一行并过滤掉 HTML 标记</span></li>    <li class="member"><span class="function">{@link fwrite()} - 写入文件（可安全用于二进制文件）</span></li>    <li class="member"><span class="function">{@link fclose()} - 关闭一个已打开的文件指针</span></li>    <li class="member"><span class="function">{@link feof()} - 测试文件指针是否到了文件结束的位置</span></li>    <li class="member"><a href="https://www.php.net/manual/zh/ref.curl.php" class="xref">cURL 函数</a></li>   </ul>  </span> </div></div>
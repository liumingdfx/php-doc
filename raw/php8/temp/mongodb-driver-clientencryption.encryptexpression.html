<div id="mongodb-driver-clientencryption.encryptexpression" class="refentry"> <div class="refnamediv">  <h1 class="refname">MongoDB\Driver\ClientEncryption::encryptExpression</h1>  <p class="verinfo">(mongodb &gt;=1.16.0)</p><p class="refpurpose"><span class="refname">MongoDB\Driver\ClientEncryption::encryptExpression</span> &mdash; <span class="dc-title">Encrypts a match or aggregate expression</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-mongodb-driver-clientencryption.encryptexpression-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>MongoDB\Driver\ClientEncryption::encryptExpression</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span> <span class="parameter" style="color:#3A95FF">$expr</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$options</span><span class="initializer"> = <strong><span>null</span></strong></span></span>): <span class="type" style="color:#EAB766">object</span></div>  <p class="para rdfs-comment">   Encrypts a match or aggregate expression to query a range index.  </p>  <p class="para">To query with a range encrypted payload, the <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-manager.php" class="classname">MongoDB\Driver\Manager</a></span> must be configured with the <span>&quot;autoEncryption&quot;</span> driver option. The <span>&quot;bypassQueryAnalysis&quot;</span> auto encryption option may be <strong><span>true</span></strong>. The <span>&quot;bypassAutoEncryption&quot;</span> auto encryption option must be <strong><span>false</span></strong>.</p>  <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:    <p class="para">The range algorithm is experimental only. It is not intended for public use.</p>   <p class="para">The PHP driver does not yet support range queries for decimal128 BSON field types.</p>  </p></blockquote> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-mongodb-driver-clientencryption.encryptexpression-parameters">  <h3 class="title">参数</h3>  <dl>       <dt><span class="parameter" style="color:#3A95FF">expr</span></dt>    <dd>     <span>      The match or aggregate expression to be encrypted. Expressions must use at      least one of the <span>$gt</span>, <span>$gte</span>,      <span>$lt</span>, or <span>$lte</span> operators. A top-level      <span>$and</span> operator is required, even if only a single      comparison operator is used.     </span>     <p class="para">      An example of a supported match expression (applies to queries and the      <span>$match</span> aggregation stage) is as follows:     </p>     <div class="example-contents"><div class="textcode"><span>[<br>    &#039;$and&#039; =&gt; [<br>        [ &#039;&lt;field&gt;&#039; =&gt; [ &#039;$gt&#039;  =&gt; &#039;&lt;value1&gt;&#039; ] ],<br>        [ &#039;&lt;field&gt;&#039; =&gt; [ &#039;$lte&#039; =&gt; &#039;&lt;value2&gt;&#039; ] ],<br>    ],<br>]</span></div>     </div>     <p class="para">      An example of a supported aggregate expression is as follows:     </p>     <div class="example-contents"><div class="textcode"><span>[<br>    &#039;$and&#039; =&gt; [<br>        [ &#039;$gte&#039; =&gt; [ &#039;&lt;fieldPath&gt;&#039;, &#039;&lt;value1&gt;&#039; ] ],<br>        [ &#039;$lt&#039;  =&gt; [ &#039;&lt;fieldPath&gt;&#039;, &#039;&lt;value2&gt;&#039; ] ],<br>    ],<br>]</span></div>     </div>    </dd>             <dt><span class="parameter" style="color:#3A95FF">options</span></dt>    <dd>     <p class="para">      <table class="doctable table">       <caption><strong>Encryption options</strong></caption>               <thead>         <tr>          <th>Option</th>          <th>Type</th>          <th>Description</th>         </tr>        </thead>        <tbody class="tbody">         <tr>          <td>algorithm</td>          <td><span class="type" style="color:#EAB766">string</span></td>          <td>           <p class="para">            The encryption algorithm to be used. This option is required.            Specify one of the following            <a href="https://www.php.net/manual/zh/class.mongodb-driver-clientencryption.php#mongodb-driver-clientencryption.constants" class="link">ClientEncryption constants</a>:           </p>           <ul class="simplelist">            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::AEAD_AES_256_CBC_HMAC_SHA_512_DETERMINISTIC</span></strong></li>            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::AEAD_AES_256_CBC_HMAC_SHA_512_RANDOM</span></strong></li>            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_INDEXED</span></strong></li>            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_UNINDEXED</span></strong></li>            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_RANGE_PREVIEW</span></strong></li>           </ul>          </td>         </tr>         <tr>          <td>contentionFactor</td>          <td><span class="type" style="color:#EAB766">int</span></td>          <td>           <p class="para">            The contention factor for evaluating queries with indexed, encrypted            payloads.           </p>           <p class="para">            This option only applies and may only be specified when            <span>algorithm</span> is            <strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_INDEXED</span></strong>            or            <strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_RANGE_PREVIEW</span></strong>.           </p>          </td>         </tr>         <tr>          <td>keyAltName</td>          <td><span class="type" style="color:#EAB766">string</span></td>          <td>           <p class="para">            Identifies a key vault collection document by            <span>keyAltName</span>. This option is mutually exclusive            with <span>keyId</span> and exactly one is required.           </p>          </td>         </tr>         <tr>          <td>keyId</td>          <td><span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-bson-binary.php" class="classname">MongoDB\BSON\Binary</a></span></td>          <td>           <p class="para">            Identifies a data key by <span>_id</span>. The value is a UUID            (binary subtype 4). This option is mutually exclusive with            <span>keyAltName</span> and exactly one is required.           </p>          </td>         </tr>         <tr>          <td>queryType</td>          <td><span class="type" style="color:#EAB766">int</span></td>          <td>           <p class="para">            The query type for evaluating queries with indexed, encrypted            payloads. Specify one of the following            <a href="https://www.php.net/manual/zh/class.mongodb-driver-clientencryption.php#mongodb-driver-clientencryption.constants" class="link">ClientEncryption constants</a>:           </p>           <ul class="simplelist">            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::QUERY_TYPE_EQUALITY</span></strong></li>            <li class="member"><strong><span>MongoDB\Driver\ClientEncryption::QUERY_TYPE_RANGE_PREVIEW</span></strong></li>           </ul>           <p class="para">This option only applies and may only be specified when            <span>algorithm</span> is            <strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_INDEXED</span></strong>            or <strong><span>MongoDB\Driver\ClientEncryption::ALGORITHM_RANGE_PREVIEW</span></strong>.           </p>          </td>         </tr>         <tr>          <td>rangeOpts</td>          <td><span class="type" style="color:#EAB766">array</span></td>          <td>           <p class="para">            Index options for a queryable encryption field supporting            &quot;rangePreview&quot; queries. The options below must match the values set            in the <span>encryptedFields</span> of the target collection.            For double and decimal128 BSON field types, <span>min</span>,            <span>max</span>, and <span>precision</span> must all be            set, or all be unset.           </p>           <p class="para">            <table class="doctable table">             <caption><strong>Range index options</strong></caption>                           <thead>               <tr>                <th>Option</th>                <th>Type</th>                <th>Description</th>               </tr>              </thead>              <tbody class="tbody">               <tr>                <td>min</td>                <td><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed" class="type mixed" style="color:#EAB766">mixed</a></span></td>                <td>Required if <span>precision</span> is set.</td>               </tr>               <tr>                <td>max</td>                <td><span class="type" style="color:#EAB766"><a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed" class="type mixed" style="color:#EAB766">mixed</a></span></td>                <td>Required if <span>precision</span> is set.</td>               </tr>               <tr>                <td>sparsity</td>                <td><span class="type" style="color:#EAB766">int</span></td>                <td>Required.</td>               </tr>               <tr>                <td>precision</td>                <td><span class="type" style="color:#EAB766">int</span></td>                <td>Optional. May only be set for double or decimal128 BSON field types.</td>               </tr>              </tbody>                         </table>           </p>          </td>         </tr>        </tbody>             </table>     </p>    </dd>     </dl> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-mongodb-driver-clientencryption.encryptexpression-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   Returns the encrypted expression as an object.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-mongodb-driver-clientencryption.encryptexpression-errors">  <h3 class="title">错误／异常</h3>  <ul class="simplelist">   <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-invalidargumentexception.php" class="classname">MongoDB\Driver\Exception\InvalidArgumentException</a></span> on argument parsing errors.</li>   <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-encryptionexception.php" class="classname">MongoDB\Driver\Exception\EncryptionException</a></span> if an error occurs while encrypting the expression</li>  </ul> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-mongodb-driver-clientencryption.encryptexpression-seealso">  <h3 class="title">参见</h3>  <ul class="simplelist">   <li class="member"><span class="function">{@link MongoDB\Driver\Manager::__construct()} - Create new MongoDB Manager</span></li>  </ul> </div></div>
<div id="mongodb-driver-bulkwrite.update" class="refentry"> <div class="refnamediv">  <h1 class="refname">MongoDB\Driver\BulkWrite::update</h1>  <p class="verinfo">(mongodb &gt;=1.0.0)</p><p class="refpurpose"><span class="refname">MongoDB\Driver\BulkWrite::update</span> &mdash; <span class="dc-title">Add an update operation to the bulk</span></p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 description" id="refsect1-mongodb-driver-bulkwrite.update-description">  <h3 class="title">说明</h3>  <div class="methodsynopsis dc-description">   <span class="modifier">public</span> <span class="methodname" style="color:#CC7832"><strong>MongoDB\Driver\BulkWrite::update</strong></span>(<span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span> <span class="parameter" style="color:#3A95FF">$filter</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span> <span class="parameter" style="color:#3A95FF">$newObj</span></span>, <span class="methodparam"><span class="type" style="color:#EAB766">?</span><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span><span class="type" style="color:#EAB766"></span></span> <span class="parameter" style="color:#3A95FF">$updateOptions</span><span class="initializer"> = <strong><span>null</span></strong></span></span>): <span class="type" style="color:#EAB766"><span class="type void" style="color:#EAB766">void</span></span></div>  <p class="para rdfs-comment">   Adds an update operation to the   <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-bulkwrite.php" class="classname">MongoDB\Driver\BulkWrite</a></span>.  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 parameters" id="refsect1-mongodb-driver-bulkwrite.update-parameters">  <h3 class="title">参数</h3>  <dl>          <dt><span class="parameter" style="color:#3A95FF">filter</span> (<span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span>)</dt>    <dd>     <span>      The <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/tutorial/query-documents/" class="link external">&raquo;&nbsp;query predicate</a>.      An empty predicate will match all documents in the collection.     </span>     <blockquote class="note" style="border:1px gray solid"><p><strong class="note" style="border:1px gray solid">注意</strong>:       <span class="simpara">       When evaluating query criteria, MongoDB compares types and values according to its own <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/reference/bson-type-comparison-order/" class="link external">&raquo;&nbsp;comparison rules for BSON types</a>, which differs from PHP&#039;s <a href="https://www.php.net/manual/zh/types.comparisons.php" class="link">comparison</a> and <a href="https://www.php.net/manual/zh/language.types.type-juggling.php" class="link">type juggling</a> rules. When matching a special BSON type the query criteria should use the respective <a href="https://www.php.net/manual/zh/book.bson.php" class="link">BSON class</a> (e.g. use <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-bson-objectid.php" class="classname">MongoDB\BSON\ObjectId</a></span> to match an <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/reference/bson-types/#objectid" class="link external">&raquo;&nbsp;ObjectId</a>).      </span>     </p></blockquote>    </dd>          <dt><span class="parameter" style="color:#3A95FF">newObj</span> (<span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span>)</dt>    <dd>     <p class="para">      A document containing either update operators (e.g.      <span>$set</span>), a replacement document (i.e.      <em>only</em> <span>field:value</span> expressions), or      an <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/reference/command/update/#update-with-an-aggregation-pipeline" class="link external">&raquo;&nbsp;aggregation pipeline</a>.     </p>    </dd>          <dt><span class="parameter" style="color:#3A95FF">updateOptions</span></dt>    <dd>     <p class="para">      <table class="doctable table">       <caption><strong>updateOptions</strong></caption>               <thead>         <tr>          <th>Option</th>          <th>Type</th>          <th>Description</th>          <th>Default</th>         </tr>        </thead>        <tbody class="tbody">         <tr>          <td>arrayFilters</td>          <td><span class="type" style="color:#EAB766">array</span></td>          <td>           <p class="para">            An array of filter documents that determines which array elements to            modify for an update operation on an array field. See            <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/manual/reference/command/update/#update-command-arrayfilters" class="link external">&raquo;&nbsp;Specify arrayFilters for Array Update Operations</a>            in the MongoDB manual for more information.           </p>           <p class="para">            This option is available in MongoDB 3.6+ and will result in an            exception at execution time if specified for an older server            version.           </p>          </td>         </tr>                  <tr>          <td>collation</td>          <td><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span></td>          <td>           <p class="para">            <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/upcoming/reference/collation/" class="link external">&raquo;&nbsp;Collation</a> allows users to specify language-specific rules for string comparison, such as rules for lettercase and accent marks. When specifying collation, the <span>&quot;locale&quot;</span> field is mandatory; all other collation fields are optional. For descriptions of the fields, see <a href="https://www.php.net/manual/zh/https://www.mongodb.com/docs/upcoming/reference/collation/#collation-document" class="link external">&raquo;&nbsp;Collation Document</a>.           </p>           <p class="para">            If the collation is unspecified but the collection has a default collation, the operation uses the collation specified for the collection. If no collation is specified for the collection or for the operation, MongoDB uses the simple binary comparison used in prior versions for string comparisons.           </p>           <p class="para">            This option is available in MongoDB 3.4+ and will result in an exception at execution time if specified for an older server version.           </p>          </td>         </tr>         <tr>          <td>hint</td>          <td><span class="type" style="color:#EAB766"><span class="type" style="color:#EAB766">string</span>|<span class="type" style="color:#EAB766">array</span>|<span class="type" style="color:#EAB766">object</span></span></td>          <td>           <p class="para">            Index specification. Specify either the index name as a string or            the index key pattern. If specified, then the query system will only            consider plans using the hinted index.           </p>           <p class="para">            This option is available in MongoDB 4.2+ and will result in an            exception at execution time if specified for an older server            version.           </p>          </td>         </tr>         <tr>          <td>multi</td>          <td><span class="type" style="color:#EAB766">bool</span></td>          <td>           Update only the first matching document if <strong><span>false</span></strong>, or all           matching documents <strong><span>true</span></strong>. This option cannot be <strong><span>true</span></strong> if           <span class="parameter" style="color:#3A95FF">newObj</span> is a replacement document.          </td>          <td><strong><span>false</span></strong></td>         </tr>         <tr>          <td>upsert</td>          <td><span class="type" style="color:#EAB766">bool</span></td>          <td>           If <span class="parameter" style="color:#3A95FF">filter</span> does not match an existing document,           insert a <em>single</em> document. The document will be           created from <span class="parameter" style="color:#3A95FF">newObj</span> if it is a replacement           document (i.e. no update operators); otherwise, the operators in           <span class="parameter" style="color:#3A95FF">newObj</span> will be applied to           <span class="parameter" style="color:#3A95FF">filter</span> to create the new document.          </td>          <td><strong><span>false</span></strong></td>         </tr>        </tbody>             </table>     </p>    </dd>     </dl> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 returnvalues" id="refsect1-mongodb-driver-bulkwrite.update-returnvalues">  <h3 class="title">返回值</h3>  <p class="para">   没有返回值。  </p> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 errors" id="refsect1-mongodb-driver-bulkwrite.update-errors">  <h3 class="title">错误／异常</h3>  <ul class="simplelist">   <li class="member">Throws <span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-exception-invalidargumentexception.php" class="classname">MongoDB\Driver\Exception\InvalidArgumentException</a></span> on argument parsing errors.</li>  </ul> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 changelog" id="refsect1-mongodb-driver-bulkwrite.update-changelog">  <h3 class="title">更新日志</h3>  <span>   <table class="doctable informaltable">         <thead>      <tr>       <th>版本</th>       <th>说明</th>      </tr>     </thead>     <tbody class="tbody">      <tr>       <td>PECL mongodb 1.7.0</td>       <td>        Added the <span>&quot;hint&quot;</span> option.       </td>      </tr>      <tr>       <td>PECL mongodb 1.6.0</td>       <td>        The <span class="parameter" style="color:#3A95FF">newObj</span> parameter now accepts an aggregation        pipeline. This feature requires MongoDB 4.2+ and will result in an        exception at execution time if specified for an older server version.       </td>      </tr>      <tr>       <td>PECL mongodb 1.5.0</td>       <td>        Using the <span>&quot;arrayFilters&quot;</span> option will result in an        exception at execution time if unsupported by the server. Previously,        no exception would be thrown and the option may have been ignored.       </td>      </tr>      <tr>       <td>PECL mongodb 1.4.0</td>       <td>        Added the <span>&quot;arrayFilters&quot;</span> option.       </td>      </tr>      <tr>       <td>PECL mongodb 1.2.0</td>       <td>        Added the <span>&quot;collation&quot;</span> option.       </td>      </tr>     </tbody>       </table>  </span> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 examples" id="refsect1-mongodb-driver-bulkwrite.update-examples">  <h3 class="title">示例</h3>  <div class="example" id="example-3959">   <p><strong>示例 #1 <span class="function"><strong style="color:#CC7832">MongoDB\Driver\BulkWrite::update()</strong></span> example</strong></p>   <div class="example-contents"><div class="phpcode" style="border-color:gray;background:#232525"><span><span style="color: #000000"><span style="color: #9876AA">&lt;?php<br /><br />$bulk </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\BulkWrite</span><span style="color: #007700">;<br /></span><span style="color: #9876AA">$bulk</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">update</span><span style="color: #007700">(<br />    [</span><span style="color: #DD0000">'x' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">2</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'$set' </span><span style="color: #007700">=&gt; [</span><span style="color: #DD0000">'y' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">3</span><span style="color: #007700">]],<br />    [</span><span style="color: #DD0000">'multi' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">false</span><span style="color: #007700">, </span><span style="color: #DD0000">'upsert' </span><span style="color: #007700">=&gt; </span><span style="color: #9876AA">false</span><span style="color: #007700">]<br />);<br /><br /></span><span style="color: #9876AA">$manager </span><span style="color: #007700">= new </span><span style="color: #9876AA">MongoDB\Driver\Manager</span><span style="color: #007700">(</span><span style="color: #DD0000">'mongodb://localhost:27017'</span><span style="color: #007700">);<br /></span><span style="color: #9876AA">$result </span><span style="color: #007700">= </span><span style="color: #9876AA">$manager</span><span style="color: #007700">-&gt;</span><span style="color: #9876AA">executeBulkWrite</span><span style="color: #007700">(</span><span style="color: #DD0000">'db.collection'</span><span style="color: #007700">, </span><span style="color: #9876AA">$bulk</span><span style="color: #007700">);<br /><br /></span><span style="color: #9876AA">?&gt;</span></span></span></div>   </div>  </div> </div> <br></br><div style="BORDER-TOP: gray 1px dashed; OVERFLOW: hidden; HEIGHT: 1px"></div><div class="refsect1 seealso" id="refsect1-mongodb-driver-bulkwrite.update-seealso">  <h3 class="title">参见</h3>  <ul class="simplelist">   <li class="member"><span class="methodname" style="color:#CC7832">{@link MongoDB\Driver\Manager::executeBulkWrite()} - Execute one or more write operations</span></li>   <li class="member"><span class="classname"><a href="https://www.php.net/manual/zh/class.mongodb-driver-writeresult.php" class="classname">MongoDB\Driver\WriteResult</a></span></li>  </ul> </div></div>